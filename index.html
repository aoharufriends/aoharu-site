<!DOCTYPE html>
<html lang="ja" prefix="og: http://ogp.me/ns#">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>あおはる⭐︎フレンズ Official</title>
    
    <link rel="icon" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">

    <meta property="og:title" content="あおはる⭐︎フレンズ Official Site">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://aoharu-site.vercel.app/">
    <meta property="og:image" content="https://aoharu-site.vercel.app/ogp.png">
    <meta property="og:description" content="2026年デビュー！4人組VTuberグループ「あおはる⭐︎フレンズ」の公式サイトです。">
    <meta property="og:site_name" content="あおはる⭐︎フレンズ Official">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@aoharu_official">
    
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;900&family=Oswald:wght@500;700&family=Poppins:wght@600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* ベーススタイル */
        :root { --primary: #27C6F5; --text-main: #444444; --text-sub: #888888; --bg-color: #ffffff; --light-bg: #f4f8fa; }
        body { font-family: 'M PLUS Rounded 1c', sans-serif; margin: 0; padding: 0; background-color: var(--bg-color); color: var(--text-main); padding-top: 70px; overflow-x: hidden; display: flex; flex-direction: column; min-height: 100vh; transition: filter 0.5s; }
        .page { display: none !important; animation: fadeInPage 0.4s ease; flex: 1; width: 100%; padding-bottom: 60px; }
        .page.active { display: block !important; }
        @keyframes fadeInPage { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ★ローディング画面★ */
        #loadingScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #e0f7ff; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.5s, visibility 0.5s;
        }
        #loadingScreen.loaded { opacity: 0; visibility: hidden; pointer-events: none; }
        .loading-logo {
            width: 120px; height: auto; margin-bottom: 20px;
            animation: bounce-logo 1s infinite;
        }
        .loading-text {
            font-family: 'Poppins', sans-serif; font-weight: bold; color: var(--primary);
            font-size: 18px; letter-spacing: 2px; animation: blink 1.5s infinite;
        }
        @keyframes bounce-logo { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* ヘッダー */
        header { position: fixed; top: 0; left: 0; width: 100%; height: 70px; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(5px); display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 10px rgba(0,0,0,0.05); z-index: 1000; }
        .logo-img { height: 40px; width: auto; margin-left: 20px; object-fit: contain; cursor: pointer; transition: transform 0.1s; }
        .logo-img:active { transform: scale(0.9); }
        .header-right { display: flex; align-items: center; gap: 15px; margin-right: 20px; }
        .login-btn-header { font-family: 'Poppins', sans-serif; font-weight: bold; font-size: 14px; color: var(--primary); border: 2px solid var(--primary); padding: 5px 15px; border-radius: 20px; cursor: pointer; background: white; transition: all 0.2s; }
        .login-btn-header:hover { background: var(--primary); color: white; }
        .logged-in-user { font-weight: bold; color: var(--text-main); font-size: 14px; background: #e0f7ff; padding: 5px 15px; border-radius: 20px; }
        .menu-btn { width: 40px; height: 40px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; cursor: pointer; box-shadow: 0 4px 10px rgba(39, 198, 245, 0.4); }

        /* ナビゲーション */
        .breadcrumb-nav { position: fixed; top: 70px; left: 0; width: 100%; padding: 10px 20px; background: rgba(255, 255, 255, 0.95); z-index: 900; display: none; align-items: center; font-size: 14px; font-family: 'Poppins', sans-serif; border-bottom: 1px solid #eee; box-sizing: border-box; }
        .bc-item { color: var(--text-sub); text-decoration: none; display: flex; align-items: center; font-weight: bold; transition: color 0.2s; } .bc-item:hover { color: var(--primary); } .bc-icon { font-size: 16px; margin-bottom: 2px; } .bc-sep { margin: 0 10px; color: #ccc; font-size: 10px; } .bc-current { color: var(--primary); font-weight: bold; }
        .side-menu { position: fixed; top: 0; right: -100%; width: 80%; max-width: 300px; height: 100%; background: white; z-index: 2000; transition: 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); box-shadow: -5px 0 20px rgba(0,0,0,0.1); display: flex; flex-direction: column; padding-top: 80px; } .side-menu.open { right: 0; }
        .menu-link { padding: 15px 30px; font-family: 'Poppins', sans-serif; font-size: 18px; color: var(--text-main); text-decoration: none; border-bottom: 1px solid #f0f0f0; display: block; }
        .menu-close { position: absolute; top: 20px; right: 20px; font-size: 30px; color: #ccc; cursor: pointer; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); z-index: 1500; opacity: 0; visibility: hidden; transition: 0.3s; } .overlay.open { opacity: 1; visibility: visible; }

        /* 共通コンポーネント */
        .hero-section { width: 100%; background-color: #e0f7ff; position: relative; margin-bottom: 40px; padding: 0; } .hero-section::after { content: ""; position: absolute; bottom: 0; left: 0; width: 100%; height: 30px; background: white; clip-path: polygon(0 100%, 100% 0, 100% 100%); } .hero-logo-img { width: 100%; max-width: 1300px; height: auto; display: block; margin: 0 auto; filter: drop-shadow(0 5px 15px rgba(39, 198, 245, 0.3)); }
        .container { padding: 0 20px 40px; max-width: 1000px; margin: 0 auto; }
        .page-header { text-align: center; margin: 40px 0 60px; } .page-title-en { font-family: 'Oswald', sans-serif; font-size: 48px; color: var(--primary); letter-spacing: 2px; line-height: 1; margin-bottom: 10px; } .page-title-jp { font-size: 14px; color: var(--text-sub); font-weight: bold; letter-spacing: 1px; }
        .section-title { text-align: center; margin-bottom: 30px; margin-top: 40px; } .en-title { font-family: 'Poppins', sans-serif; font-size: 28px; font-weight: bold; color: var(--primary); letter-spacing: 2px; } .ja-title { display: block; font-size: 12px; color: var(--text-sub); margin-top: 5px; font-weight: bold; }
        .more-btn { background: transparent; border: 1px solid #ccc; padding: 10px 30px; border-radius: 30px; cursor: pointer; color: var(--text-main); font-family: 'Poppins', sans-serif; font-size: 14px; margin-top: 20px; transition: all 0.3s ease; outline: none; } .more-btn:hover { background: var(--primary); color: white; border-color: var(--primary); }

        /* ★★★ おみくじエリア（派手カワ・リニューアル版） ★★★ */
        .omikuji-area { 
            text-align: center; margin-bottom: 60px; 
            background: linear-gradient(135deg, #fff5f8 0%, #f0faff 100%);
            padding: 30px 20px; border-radius: 25px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); 
            border: 4px solid white; outline: 4px dashed #ff9a9e;
            position: relative; overflow: hidden;
            max-width: 600px; margin-left: auto; margin-right: auto;
        }
        .omikuji-area::before {
            content: ""; position: absolute; inset: 0; opacity: 0.1;
            background-image: radial-gradient(#ff9a9e 20%, transparent 20%), radial-gradient(#27C6F5 20%, transparent 20%);
            background-size: 30px 30px; background-position: 0 0, 15px 15px;
            pointer-events: none;
        }
        .omi-deco { position: absolute; font-size: 24px; animation: float-deco 3s ease-in-out infinite; z-index: 1; }
        .d-1 { top: 10px; left: 10px; color: #FFD700; animation-delay: 0s; }
        .d-2 { bottom: 10px; right: 10px; color: #27C6F5; animation-delay: 1.5s; font-size: 30px; }
        @keyframes float-deco { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-10px) rotate(20deg); } }
        .omi-visual-box {
            font-size: 60px; color: #ff4757; margin: 10px 0 20px;
            text-shadow: 0 5px 0 rgba(0,0,0,0.1);
            animation: omi-bounce 2s infinite; display: inline-block;
        }
        @keyframes omi-bounce { 0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-20px); } 60% { transform: translateY(-10px); } }
        .omi-title-ribbon {
            background: #ff4757; color: white; display: inline-block;
            padding: 5px 20px; border-radius: 20px; font-weight: bold; font-size: 14px;
            box-shadow: 0 4px 0 #cc1e2b; margin-bottom: 10px; position: relative; z-index: 2;
        }
        .omi-main-text {
            font-family: 'M PLUS Rounded 1c', sans-serif; font-weight: 900;
            font-size: 28px; color: #444; margin: 0 0 20px; letter-spacing: 2px;
            position: relative; z-index: 2;
            background: linear-gradient(to right, #ff4757, #ff9a9e);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .omikuji-btn { 
            background: linear-gradient(to bottom, #FFD700, #FFA500); 
            color: #fff; font-weight: 900; padding: 18px 50px; 
            border-radius: 50px; border: 4px solid #fff; 
            font-size: 22px; cursor: pointer; 
            box-shadow: 0 8px 0 #d35400, 0 15px 20px rgba(0,0,0,0.2); 
            transition: transform 0.1s, box-shadow 0.1s; 
            font-family: 'M PLUS Rounded 1c', sans-serif; letter-spacing: 2px;
            position: relative; z-index: 5; text-shadow: 1px 1px 0 rgba(0,0,0,0.2);
        }
        .omikuji-btn:hover { transform: translateY(4px); box-shadow: 0 4px 0 #d35400, 0 8px 10px rgba(0,0,0,0.2); }
        .omikuji-btn:active { transform: translateY(8px); box-shadow: 0 0 0 #d35400, inset 0 2px 5px rgba(0,0,0,0.2); }
        .omikuji-btn::after {
            content: "FREE!"; position: absolute; top: -15px; right: -20px;
            background: #27C6F5; color: white; font-size: 12px; padding: 5px 10px;
            border-radius: 50%; transform: rotate(20deg); border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); animation: pulse-red 1s infinite;
        }

        /* ★スマホ用調整（おみくじをコンパクトに）★ */
        @media (max-width: 768px) {
            .omikuji-area {
                padding: 20px 10px; /* パディングを減らす */
                margin-bottom: 40px;
            }
            .omi-main-text {
                font-size: 22px; /* 文字サイズを小さく */
                margin-bottom: 15px;
            }
            .omi-visual-box {
                font-size: 40px; /* アイコンを小さく */
                margin: 5px 0 15px;
            }
            .omikuji-btn {
                padding: 12px 30px; /* ボタンを小さく */
                font-size: 16px;
            }
            .omikuji-btn::after {
                font-size: 10px; /* バッジも小さく */
                padding: 3px 6px;
                top: -10px;
                right: -10px;
            }
        }
        
        /* 派手カワおみくじアニメーション */
        .omi-anim-container { position: relative; width: 100%; height: 300px; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .omi-box-container { position: relative; width: 140px; height: 200px; perspective: 1000px; z-index: 10; }
        .omi-box {
            width: 100%; height: 100%; 
            background: linear-gradient(135deg, #FF512F, #DD2476, #FF512F); background-size: 200% 200%;
            border: 6px solid #fff; box-shadow: 0 15px 35px rgba(221, 36, 118, 0.6);
            color: white; font-weight: 900; display: flex; align-items: center; justify-content: center;
            font-size: 36px; writing-mode: vertical-rl; border-radius: 20px; position: relative; z-index: 5;
            text-shadow: 3px 3px 0 rgba(0,0,0,0.3); font-family: 'M PLUS Rounded 1c', sans-serif;
            animation: gradient-shift 3s ease infinite;
        }
        @keyframes gradient-shift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .omi-box.shaking { animation: omi-shake-crazy 0.25s infinite cubic-bezier(.36,.07,.19,.97) alternate; }
        @keyframes omi-shake-crazy {
            0% { transform: translate(0, 0) rotate(0) scale(1); }
            25% { transform: translate(-10px, 5px) rotate(-10deg) scale(1.05, 0.95); }
            50% { transform: translate(0, -5px) rotate(0) scale(0.95, 1.05); }
            75% { transform: translate(10px, 5px) rotate(10deg) scale(1.05, 0.95); }
            100% { transform: translate(0, 0) rotate(0) scale(1); }
        }
        .omi-box.pre-burst { animation: pre-burst-pop 0.5s forwards cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        @keyframes pre-burst-pop { 0% { transform: scale(1); } 50% { transform: scale(0.8) translateY(20px); } 100% { transform: scale(1.3) translateY(-10px); } }
        .omi-slip {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 24px; height: 120px; background: #fff; border: 4px solid #DD2476;
            z-index: 2; transition: top 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); border-radius: 8px;
            box-shadow: 0 0 15px rgba(255, 255, 255, 1);
        }
        .omi-slip.coming-out { top: -70%; }
        .confetti { position: absolute; pointer-events: none; z-index: 1; opacity: 0; }
        .confetti i { font-size: 20px; }
        .burst .confetti { animation: confetti-explosion 1s ease-out forwards; }
        @keyframes confetti-explosion { 0% { opacity: 1; transform: translate(0, 0) scale(0.5) rotate(0deg); } 100% { opacity: 0; transform: translate(var(--tx), var(--ty)) scale(1.5) rotate(var(--r)); } }
        .shockwave { position: absolute; top: 50%; left: 50%; width: 10px; height: 10px; border-radius: 50%; background: rgba(255, 255, 255, 0.8); z-index: 0; opacity: 0; pointer-events: none; }
        .burst .shockwave { animation: shockwave-anim 0.6s ease-out forwards; }
        @keyframes shockwave-anim { 0% { opacity: 1; transform: translate(-50%, -50%) scale(1); } 100% { opacity: 0; transform: translate(-50%, -50%) scale(50); box-shadow: 0 0 50px rgba(255,255,255,0.5); } }
        #omikujiAnimModal.flash-effect::after { content: ""; position: absolute; inset: 0; background: white; z-index: 100; animation: flash-anim 0.5s ease-out forwards; pointer-events: none; }
        @keyframes flash-anim { 0% { opacity: 1; } 100% { opacity: 0; } }

        /* おみくじ結果表示 & ボタン */
        .omi-rank { font-size: 48px; font-weight: 900; color: #ff4757; margin-bottom: 10px; text-shadow: 2px 2px 0 rgba(0,0,0,0.1); font-family: 'M PLUS Rounded 1c', sans-serif; }
        .omi-msg { font-size: 16px; color: #555; margin-bottom: 20px; font-weight: bold; line-height: 1.5; }
        .omi-item { font-size: 14px; color: #fff; background: var(--primary); display: inline-block; padding: 8px 20px; border-radius: 20px; font-weight: bold; box-shadow: 0 5px 10px rgba(39, 198, 245, 0.3); }
        .omi-chara-img { width: 180px; height: 180px; border-radius: 50%; object-fit: cover; object-position: top center; border: 6px solid var(--primary); margin-bottom: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .omi-action-btns { margin-top: 25px; display: flex; justify-content: center; gap: 15px; }
        .sns-share-btn, .save-img-btn { border: none; padding: 10px 20px; border-radius: 30px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px; transition: transform 0.2s; color: white; font-family: 'Poppins', sans-serif; }
        .sns-share-btn { background: #000; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .save-img-btn { background: linear-gradient(135deg, #27C6F5, #2ecc71); box-shadow: 0 4px 10px rgba(39, 198, 245, 0.3); }
        .sns-share-btn:hover, .save-img-btn:hover { transform: translateY(-3px); }

        /* スクロールエリア */
        .scroll-wrapper { position: relative; display: flex; align-items: center; } .scroll-grid { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; gap: 15px; padding-bottom: 10px; scrollbar-width: none; flex-grow: 1; margin: 0 10px; } .scroll-grid::-webkit-scrollbar { display: none; } .scroll-btn { width: 30px; height: 30px; border-radius: 50%; background: rgba(255, 255, 255, 0.8); color: var(--primary); border: 1px solid #eee; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; cursor: pointer; z-index: 10; transition: all 0.2s; flex-shrink: 0; } .scroll-btn:hover { background: var(--primary); color: white; box-shadow: 0 4px 8px rgba(39, 198, 245, 0.3); } .scroll-btn.left { margin-right: -15px; } .scroll-btn.right { margin-left: -15px; }

        /* ★★★ NOW ON AIR (Live Embed) ★★★ */
        #nowOnAirSection { display: none; margin-bottom: 60px; animation: fadeIn 0.5s ease; width: 100%; }
        .noa-title { text-align: center; font-family: 'Poppins', sans-serif; font-weight: 900; font-size: 32px; color: #ff0000; margin-bottom: 20px; letter-spacing: 2px; text-shadow: 0 2px 10px rgba(255,0,0,0.1); display: flex; align-items: center; justify-content: center; gap: 10px; }
        .noa-title::before, .noa-title::after { content: "●"; font-size: 14px; animation: pulse-red 1s infinite; }
        
        .live-hero-wrapper { width: 100%; max-width: 900px; margin: 0 auto; background: #000; border-radius: 16px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.2); position: relative; border: 4px solid #ff0000; }
        .live-iframe-box { position: relative; width: 100%; padding-top: 56.25%; /* 16:9 */ }
        .live-iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        .live-info-bar { padding: 15px; background: white; display: flex; align-items: center; gap: 15px; border-bottom: 2px solid #f0f0f0; }
        .live-info-icon { width: 50px; height: 50px; border-radius: 50%; border: 2px solid #ff0000; object-fit: cover; }
        .live-info-text { flex: 1; }
        .live-status-badge { background: #ff0000; color: white; font-weight: bold; font-size: 12px; padding: 2px 8px; border-radius: 4px; vertical-align: middle; margin-right: 5px; }
        .live-status-badge.upcoming { background: #FF9800; }
        .live-info-name { font-weight: bold; font-size: 14px; color: #555; }
        .live-info-title { font-weight: bold; font-size: 16px; color: #333; display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; }
        
        /* 複数配信がある場合のサブグリッド */
        .sub-live-grid { display: flex; gap: 10px; overflow-x: auto; padding: 15px 0; max-width: 900px; margin: 0 auto; }
        .sub-live-card { min-width: 200px; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); cursor: pointer; transition: 0.2s; border: 2px solid transparent; }
        .sub-live-card:hover { border-color: #ff0000; transform: translateY(-3px); }
        .sub-live-thumb { width: 100%; height: 110px; object-fit: cover; }
        .sub-live-title { font-size: 12px; font-weight: bold; padding: 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        @keyframes pulse-red { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        /* 各種カード */
        .schedule-card { flex: 0 0 160px; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: transform 0.3s; scroll-snap-align: start; text-align: center; border: 1px solid #eee; } .schedule-card:hover { transform: translateY(-3px); border-color: var(--primary); } .sch-thumb-box { background: linear-gradient(135deg, var(--primary), #89CFF0); color: white; padding: 10px 0; display: flex; flex-direction: column; justify-content: center; align-items: center; aspect-ratio: 16 / 9; } .sch-date-big { font-size: 16px; font-weight: bold; font-family: 'Poppins', sans-serif; } .sch-time-big { font-size: 12px; font-family: 'Poppins', sans-serif; background: rgba(0,0,0,0.2); padding: 2px 8px; border-radius: 10px; margin-top: 3px;} .sch-info { padding: 8px; } .sch-title { font-size: 10px; font-weight: bold; margin-bottom: 2px; color: var(--text-main); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.4; text-align: left; } .sch-badge-mini { font-size: 9px; color: var(--primary); border: 1px solid var(--primary); padding: 1px 4px; border-radius: 3px; display: inline-block; margin-bottom: 3px; }
        .video-card { flex: 0 0 200px; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: transform 0.3s; cursor: pointer; scroll-snap-align: start; } .video-card:hover { transform: translateY(-3px); } .video-thumb-box { position: relative; width: 100%; aspect-ratio: 16 / 9; overflow: hidden; } .video-thumb { width: 100%; height: 100%; object-fit: cover; } .play-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 24px; height: 24px; background: rgba(0,0,0,0.6); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; } .video-info { padding: 6px; } .video-title { font-size: 10px; font-weight: bold; margin-bottom: 2px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.3; } .video-date { font-size: 9px; color: #888; }
        .member-video-card { min-width: 250px; scroll-snap-align: start; cursor: pointer; position: relative; background:white; border-radius:12px; overflow:hidden; box-shadow:0 2px 5px rgba(0,0,0,0.05); border:1px solid #eee; } .mv-blur .news-img, .mv-blur .news-title { filter: blur(4px); } .mv-lock-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.4); z-index:10; display:flex; flex-direction:column; align-items:center; justify-content:center; color:white; } .mv-lock-icon { font-size:30px; margin-bottom:10px; } .mv-lock-text { font-family:'Oswald',sans-serif; font-weight:bold; letter-spacing:1px; }

        /* メンバーリスト */
        .member-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 0 auto; width: 100%; }
        .member-card-vertical { position: relative; aspect-ratio: 2 / 3; z-index: 1; border-radius: 8px; overflow: hidden; transition: transform 0.2s, box-shadow 0.2s; cursor: pointer; width: 100%; }
        .member-card-vertical::before { content: ""; position: absolute; inset: 0; background-image: var(--member-bg); background-size: cover; background-position: center; background-color: var(--member-color, #ccc); background-blend-mode: hard-light; z-index: -1; transition: transform 0.3s; }
        .member-img-wrapper { position: absolute; inset: 0; -webkit-mask-image: var(--member-bg); mask-image: var(--member-bg); -webkit-mask-size: cover; mask-size: cover; -webkit-mask-position: center; mask-position: center; }
        .member-img-tachie { position: absolute; left: 50%; transform: translateX(-50%); width: 300%; top: -20%; object-fit: contain; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .member-card-vertical:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 100; overflow: visible; }
        .member-card-vertical:hover::before { transform: scale(1.05); } .member-card-vertical:hover .member-img-wrapper { -webkit-mask-image: none; mask-image: none; } .member-card-vertical:hover .member-img-tachie { width: auto; height: 150%; max-width: none; top: auto; bottom: -10%; }

        /* メンバー詳細 */
        .member-bg-layer { position: fixed; top: 70px; left: 0; width: 50vw; height: calc(100vh - 70px); z-index: -1; background-repeat: no-repeat; background-position: center bottom; background-size: contain; opacity: 0.15; pointer-events: none; padding-bottom: 20px; box-sizing: border-box; }
        .profile-header-bg { 
            background: linear-gradient(135deg, var(--m-color-light) 0%, rgba(255,255,255,0.85) 100%);
            padding-top: 40px; padding-bottom: 60px; position: relative; overflow: hidden; margin-top: 0; 
            min-height: calc(100vh - 70px); 
        }
        .profile-wrapper { display: flex; flex-direction: column; align-items: center; max-width: 1000px; margin: 0 auto; padding: 0 20px; } @media (min-width: 768px) { .profile-wrapper { flex-direction: row; align-items: flex-start; justify-content: space-between; } }
        .profile-visual { width: 100%; max-width: 400px; position: relative; margin-bottom: 30px; display: flex; justify-content: center; } .profile-tachie { width: 100%; height: auto; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.2)); animation: slideUpTachie 0.8s cubic-bezier(0.2, 0.8, 0.2, 1); } @keyframes slideUpTachie { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
        .profile-info { width: 100%; max-width: 550px; }
        .profile-en-name { font-family: 'Poppins', sans-serif; font-size: 40px; font-weight: 900; line-height: 1; color: var(--m-color); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 10px; opacity: 0; animation: fadeInRight 0.5s 0.2s forwards; }
        .profile-jp-name { font-size: 24px; font-weight: bold; color: #333; margin-bottom: 20px; opacity: 0; animation: fadeInRight 0.5s 0.3s forwards; }
        .profile-catch { font-size: 16px; color: #666; margin-bottom: 30px; font-weight: bold; border-left: 4px solid var(--m-color); padding-left: 15px; opacity: 0; animation: fadeInRight 0.5s 0.4s forwards; }
        .profile-data-list { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; opacity: 0; animation: fadeInRight 0.5s 0.5s forwards; }
        .p-data-item { background: rgba(255,255,255,0.7); padding: 10px; border-radius: 8px; border-bottom: 2px solid var(--m-color); } .p-label { font-size: 11px; color: #666; font-weight: bold; display: block; margin-bottom: 5px; } .p-value { font-size: 15px; font-weight: bold; color: #333; }
        .profile-bio { font-size: 15px; line-height: 1.8; color: #333; margin-bottom: 40px; white-space: pre-wrap; font-weight: 500; background: rgba(255,255,255,0.5); padding: 15px; border-radius: 10px; opacity: 0; animation: fadeInRight 0.5s 0.6s forwards; }
        .profile-actions { display: flex; gap: 15px; margin-bottom: 40px; opacity: 0; animation: fadeInUp 0.5s 0.7s forwards; flex-wrap: wrap; }
        .p-btn { flex: 1; padding: 15px; text-align: center; border-radius: 50px; text-decoration: none; font-weight: bold; font-family: 'Poppins', sans-serif; transition: transform 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; white-space: nowrap; cursor: pointer; } .p-btn:hover { transform: translateY(-3px); }
        .p-btn.yt { background: #ff0000; color: white; box-shadow: 0 5px 15px rgba(255,0,0,0.3); } .p-btn.tw { background: #1DA1F2; color: white; box-shadow: 0 5px 15px rgba(29, 161, 242, 0.3); } .p-btn.x { background: #000; color: white; box-shadow: 0 5px 15px rgba(0,0,0,0.3); } .p-btn.voice { background: #FF9800; color: white; box-shadow: 0 5px 15px rgba(255, 152, 0, 0.3); }
        .back-link { display: inline-block; margin-top: 20px; color: #888; text-decoration: none; font-size: 14px; font-weight: bold; cursor: pointer; } .back-link:hover { color: var(--primary); }
        @keyframes fadeInRight { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } } @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* ワンタップ・コピー */
        .copy-tag { cursor: pointer; position: relative; transition: all 0.2s; display: inline-flex; align-items: center; gap: 5px; }
        .copy-tag:hover { transform: scale(1.05); text-decoration: underline; }
        .copy-icon { font-size: 12px; color: #aaa; }
        #copyToast {
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 30px;
            font-size: 14px; font-weight: bold; display: none; z-index: 3000;
            animation: fadeInOut 2s ease forwards;
        }
        @keyframes fadeInOut { 0% { opacity:0; transform: translate(-50%, 20px); } 15% { opacity:1; transform: translate(-50%, 0); } 85% { opacity:1; transform: translate(-50%, 0); } 100% { opacity:0; transform: translate(-50%, -20px); } }

        /* ★隠しモード（フィーバー）★ */
        body.fever-mode {
            animation: rainbow-rush 0.5s infinite linear;
        }
        @keyframes rainbow-rush {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }
        body.fever-mode::before {
            content: ""; position: fixed; inset: 0; z-index: 9998;
            background: radial-gradient(circle, rgba(255,255,255,0.5) 10%, transparent 20%);
            background-size: 50px 50px;
            animation: disco-lights 1s infinite alternate;
            pointer-events: none;
        }
        @keyframes disco-lights { from { background-position: 0 0; } to { background-position: 50px 50px; } }
        .fever-text {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 80px; font-weight: 900; color: white;
            text-shadow: 0 0 20px #FF00DE, 0 0 40px #FF00DE;
            z-index: 9999; pointer-events: none;
            animation: bounce-text 0.5s infinite alternate; font-family: 'Oswald', sans-serif;
        }
        @keyframes bounce-text { from { transform: translate(-50%, -50%) scale(1); } to { transform: translate(-50%, -50%) scale(1.2); } }

        /* ★★★ 【設定1】推しメン選択ボタンの調整 ★★★ */
        .oshi-buttons { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px; }
        .oshi-btn { 
            width: 55px; height: 55px; border-radius: 50%; border: 3px solid transparent; 
            cursor: pointer; background-size: 200%; background-position: center 10%; 
            transition: transform 0.2s; 
        }
        .oshi-btn.selected { border-color: #333; transform: scale(1.1); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

        /* --- ★デジタル会員証メーカー (豪華光る仕様) --- */
        .card-maker-area { margin-top: 60px; padding-top: 40px; border-top: 1px dashed #ddd; }
        .maker-container { background: #fff; border-radius: 20px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); text-align: center; }
        .maker-controls label { display: block; font-size: 12px; font-weight: bold; color: var(--text-sub); margin-bottom: 5px; text-align: left; }
        .maker-controls input { width: 100%; padding: 10px; border: 2px solid #eee; border-radius: 8px; font-size: 16px; margin-bottom: 15px; box-sizing: border-box; font-family: 'M PLUS Rounded 1c', sans-serif; }
        .card-preview-wrapper { display: flex; justify-content: center; margin-bottom: 20px; perspective: 1000px; }
        
        .digital-card { 
            width: 320px; height: 190px; border-radius: 12px; position: relative; overflow: hidden; color: white; text-align: left; font-family: 'Poppins', sans-serif; 
            background: #000; border: 1px solid rgba(255, 255, 255, 0.3); transition: 0.3s;
            /* ★豪華な発光エフェクト★ */
            box-shadow: 0 0 15px var(--card-color), 0 10px 30px rgba(0,0,0,0.5);
        }
        .card-bg { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; opacity: 0.8;
            /* ラジアルグラデーションで高級感 */
            background: radial-gradient(circle at 50% 30%, var(--card-color), #000 75%);
        }
        .card-shine { 
            position: absolute; inset: 0; z-index: 2; pointer-events: none; mix-blend-mode: overlay;
            background: linear-gradient(115deg, transparent 20%, rgba(255,255,255,0.4) 25%, transparent 30%, transparent 70%, rgba(255,255,255,0.2) 75%, transparent 80%);
        }
        /* 走査線テクスチャ */
        .digital-card::after {
            content: ""; position: absolute; inset: 0; z-index: 3; pointer-events: none;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.2) 3px);
        }

        .card-content { position: relative; z-index: 10; padding: 20px; height: 100%; box-sizing: border-box; display: flex; flex-direction: column; justify-content: space-between; }
        .card-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.3); padding-bottom: 5px; }
        .card-logo { font-weight: bold; font-size: 14px; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .card-official { font-size: 8px; background: rgba(255,255,255,0.2); padding: 2px 6px; border-radius: 4px; }
        .card-value { font-size: 14px; font-weight: bold; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .card-value.number { font-family: monospace; font-size: 12px; }
        .card-value.name { font-size: 18px; font-family: 'M PLUS Rounded 1c', sans-serif; }
        
        .card-char-img { 
            position: absolute; 
            bottom: var(--char-bottom, -20px); 
            right: var(--char-right, -50px); 
            width: var(--char-width, 280px);
            height: auto; 
            z-index: 5; 
            mask-image: linear-gradient(to bottom, black 85%, transparent 100%); 
            -webkit-mask-image: linear-gradient(to bottom, black 85%, transparent 100%); 
            filter: drop-shadow(-5px 0 10px rgba(0,0,0,0.3)); 
            pointer-events: none;
        }
        .download-btn { background: linear-gradient(90deg, #333, #555); color: white; border: none; padding: 12px 40px; border-radius: 30px; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

        /* ニュースページ */
        .news-category-bar { display: flex; justify-content: center; gap: 10px; margin-bottom: 30px; }
        .news-cat-btn { padding: 8px 20px; border-radius: 20px; background: #eee; font-size: 13px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .news-cat-btn.active, .news-cat-btn:hover { background: var(--primary); color: white; }
        .news-pickup { margin-bottom: 40px; position: relative; border-radius: 15px; overflow: hidden; aspect-ratio: 16/9; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .news-pickup-img { width: 100%; height: 100%; object-fit: cover; }
        .news-pickup-content { position: absolute; bottom: 0; left: 0; width: 100%; padding: 20px; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); color: white; box-sizing: border-box; }
        .news-pickup-badge { background: #ff4757; padding: 3px 10px; border-radius: 5px; font-size: 12px; font-weight: bold; margin-bottom: 5px; display: inline-block; }
        .news-pickup-title { font-size: 20px; font-weight: bold; }
        .news-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; padding-bottom: 20px; }
        .news-card { background: white; border-radius: 12px; overflow: hidden; border: 1px solid #eee; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; flex-direction: column; } .news-card:hover { border-color: var(--primary); box-shadow: 0 5px 15px rgba(39, 198, 245, 0.25); transform: translateY(-5px); } .scroll-grid .news-card { flex: 0 0 280px; margin-right: 0; height: 100%; } .news-thumb-area { width: 100%; height: 160px; background-color: #f0f0f0; position: relative; overflow: hidden; } .news-img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s; } .news-card:hover .news-img { transform: scale(1.05); } .news-badge { position: absolute; top: 10px; left: 10px; background: var(--primary); color: white; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: bold; z-index: 2; box-shadow: 0 2px 5px rgba(0,0,0,0.2); } .news-content { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; } .news-date { font-size: 12px; color: #888; font-family: 'Poppins', sans-serif; margin-bottom: 5px; } .news-title { font-size: 14px; font-weight: bold; color: #333; line-height: 1.5; margin-bottom: 15px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; flex-grow: 1; } .news-check-btn { background: #eee; color: #666; text-align: center; padding: 8px; border-radius: 6px; font-weight: bold; font-family: 'Poppins', sans-serif; font-size: 12px; transition: all 0.3s; } .news-card:hover .news-check-btn { background: var(--primary); color: white; }

        /* タイムライン（スケジュール） */
        .timeline-container { position: relative; padding: 20px 0; }
        .timeline-container::before { content: ''; position: absolute; top: 0; left: 24px; height: 100%; width: 2px; background: #eee; }
        .timeline-item { display: flex; margin-bottom: 25px; position: relative; }
        .tl-icon-box { width: 50px; display: flex; flex-direction: column; align-items: center; z-index: 1; }
        .tl-icon { width: 40px; height: 40px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-size: 18px; border: 4px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .tl-content { flex: 1; background: white; padding: 15px; border-radius: 12px; border: 1px solid #eee; margin-left: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .tl-date { font-family: 'Poppins', sans-serif; font-weight: bold; color: var(--primary); font-size: 14px; margin-bottom: 5px; }
        .tl-title { font-weight: bold; font-size: 15px; margin-bottom: 5px; }
        .tl-tag { font-size: 11px; background: #eee; padding: 2px 8px; border-radius: 4px; color: #666; }

        /* グッズページ（★修正：正方形＆モーダル） */
        .goods-hero { background: #f9f9f9; border-radius: 15px; padding: 30px; text-align: center; margin-bottom: 40px; }
        .goods-hero h3 { margin: 0 0 10px 0; color: var(--primary); font-family: 'Poppins', sans-serif; }
        .goods-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .goods-item { background: white; padding: 10px; border-radius: 10px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #eee; transition: 0.3s; cursor: pointer; }
        .goods-item:hover { transform: translateY(-5px); border-color: var(--primary); }
        .goods-name { font-size: 13px; font-weight: bold; height: 2.8em; overflow: hidden; line-height: 1.4; }
        .goods-price { font-family: 'Poppins', sans-serif; color: var(--primary); font-weight: bold; margin-top: 5px; }
        /* 画像を正方形に強制 */
        .goods-img { width: 100%; aspect-ratio: 1 / 1; object-fit: cover; border-radius: 8px; margin-bottom: 10px; background-color:#eee; }
        
        /* グッズ詳細モーダル */
        #goodsModal .modal-content { text-align: left; padding: 25px; }
        #goodsModalImg { width: 100%; max-height: 300px; object-fit: contain; border-radius: 8px; margin-bottom: 15px; background: #fff; }
        #goodsModalTitle { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
        #goodsModalPrice { font-size: 20px; font-weight: bold; color: var(--primary); font-family: 'Poppins', sans-serif; margin-bottom: 15px; }
        #goodsModalDesc { font-size: 14px; line-height: 1.6; color: #555; margin-bottom: 20px; white-space: pre-wrap; }
        .buy-btn { display: block; width: 100%; text-align: center; background: var(--primary); color: white; padding: 12px; border-radius: 30px; text-decoration: none; font-weight: bold; transition: 0.2s; box-sizing: border-box; }
        .buy-btn:hover { opacity: 0.9; transform: translateY(-2px); }

        /* RADIOページ */
        .radio-theme-box { background: #333; color: white; padding: 20px; border-radius: 10px; border: 4px solid #8B4513; margin-bottom: 30px; position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .radio-theme-box::before { content: "今週のテーマ"; position: absolute; top: -15px; left: 20px; background: #f1c40f; color: #333; padding: 2px 10px; font-weight: bold; font-size: 12px; border-radius: 4px; transform: rotate(-2deg); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .radio-theme-text { font-size: 18px; font-weight: bold; text-align: center; font-family: 'M PLUS Rounded 1c', sans-serif; letter-spacing: 1px; }
        .letter-form { background: white; padding: 20px; border-radius: 15px; border: 2px solid #eee; box-shadow: 0 5px 15px rgba(0,0,0,0.03); }
        .form-label { display: block; font-weight: bold; font-size: 12px; margin-bottom: 5px; color: var(--text-sub); }
        .form-input, .form-select, .form-textarea { width: 100%; padding: 10px; border: 2px solid #eee; border-radius: 8px; font-family: inherit; margin-bottom: 15px; box-sizing: border-box; }
        .form-input:focus, .form-select:focus, .form-textarea:focus { border-color: var(--primary); outline: none; }
        .radio-btn { width: 100%; background: var(--primary); color: white; padding: 12px; border: none; border-radius: 30px; font-weight: bold; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 10px rgba(39, 198, 245, 0.3); }
        .radio-btn:hover { transform: translateY(-2px); }
        .diary-section { margin-top: 50px; }
        .diary-card { background: white; border-radius: 15px; padding: 15px; margin-bottom: 20px; border: 1px solid #eee; display: flex; gap: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); position: relative; }
        /* ★放課後アイコンサイズ★ */
.diary-icon {
    width: 60px;          /* 丸の大きさ */
    height: 60px;         /* 丸の大きさ */
    border-radius: 50%;
    flex-shrink: 0;
    border: 2px solid #eee;
    
    /* 背景画像として表示するための設定 */
    background-size: 330%; /* ★ここ！100%が標準。150%なら1.5倍ズーム！ */
    background-position: top center; /* 顔の位置合わせ */
    background-repeat: no-repeat;
}
        .diary-content { flex: 1; }
        .diary-name { font-weight: bold; font-size: 13px; margin-bottom: 5px; color: var(--text-sub); }
        .diary-text { font-size: 14px; line-height: 1.6; background: #f9f9f9; padding: 10px; border-radius: 0 10px 10px 10px; display: inline-block; position: relative; }
        .diary-voice-player { margin-top: 10px; background: #eee; padding: 8px 15px; border-radius: 20px; display: flex; align-items: center; gap: 10px; cursor: pointer; width: fit-content; transition: 0.2s; }
        .diary-voice-player:hover { background: #ddd; }
        .diary-date { font-size: 10px; color: #aaa; text-align: right; margin-top: 5px; }

        /* 無限いいねボタン */
        .floating-heart-btn {
            position: fixed; bottom: 30px; right: 20px; width: 60px; height: 60px;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
            border-radius: 50%; box-shadow: 0 5px 15px rgba(255, 105, 180, 0.4);
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 28px; cursor: pointer; z-index: 999;
            transition: transform 0.1s; user-select: none;
        }
        .floating-heart-btn:active { transform: scale(0.9); }
        .like-badge {
            position: absolute; top: -15px; right: -5px;
            background: #ff4757; color: white;
            font-size: 10px; font-weight: bold;
            padding: 3px 8px; border-radius: 10px;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            min-width: 20px; text-align: center;
            transition: transform 0.1s;
        }
        .heart-particle {
            position: fixed; pointer-events: none; animation: floatUp 1.5s ease-out forwards;
            font-size: 20px; z-index: 1000;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-150px) scale(1.5) rotate(20deg); opacity: 0; }
        }

        /* ★お問い合わせフォーム（新規追加）★ */
        .contact-section {
            max-width: 800px; margin: 60px auto; background: #fff; border-radius: 20px; padding: 30px;
            border: 4px solid #eee; box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            /* かわいい水玉背景 */
            background-image: radial-gradient(#e0f7ff 20%, transparent 20%);
            background-size: 20px 20px;
        }
        .contact-title { text-align: center; font-size: 24px; font-weight: bold; color: var(--primary); margin-bottom: 20px; letter-spacing: 2px; font-family: 'Poppins', sans-serif; }
        .contact-form { background: white; padding: 20px; border-radius: 15px; border: 2px solid #eee; }
        .contact-btn { width: 100%; background: linear-gradient(135deg, var(--primary), #89CFF0); color: white; padding: 12px; border: none; border-radius: 30px; font-weight: bold; cursor: pointer; margin-top: 10px; box-shadow: 0 4px 10px rgba(39, 198, 245, 0.3); transition: transform 0.2s; }
        .contact-btn:hover { transform: translateY(-2px); }

        /* フッター */
        .sns-container { text-align: center; margin-bottom: 30px; }
        .sns-links { display: flex; justify-content: center; gap: 20px; margin-top: 20px; }
        .sns-btn { width: 50px; height: 50px; background: #111; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; text-decoration: none; transition: transform 0.2s, box-shadow 0.2s; } .sns-btn.youtube { background: #ff0000; } .sns-btn:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); } .sns-logo-img { width: 30px; height: 30px; object-fit: contain; filter: brightness(0) invert(1); }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s; } .modal.open { display: flex; opacity: 1; } .modal-content { background: white; width: 90%; max-width: 400px; border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); position: relative; transform: translateY(20px); transition: transform 0.3s; text-align: center; } .modal.open .modal-content { transform: translateY(0); } .modal-close-btn { position: absolute; top: 15px; right: 20px; font-size: 28px; color: #aaa; cursor: pointer; } .news-modal-content { max-width: 500px; text-align: left; } .news-modal-content .modal-title { font-size: 18px; font-weight: bold; margin: 15px 0; border-bottom: 2px solid #f0f0f0; padding-bottom: 15px; } .news-modal-content .modal-body { font-size: 15px; line-height: 1.8; color: #444; white-space: pre-wrap; }
        .auth-title { font-size: 20px; font-weight: bold; margin-bottom: 20px; color: var(--text-main); font-family: 'Poppins', sans-serif; } .auth-input { width: 100%; padding: 12px; margin-bottom: 15px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9; font-size: 16px; } .auth-input:focus { border-color: var(--primary); outline: none; background: white; } .auth-btn { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 25px; font-weight: bold; font-size: 16px; cursor: pointer; margin-top: 10px; box-shadow: 0 4px 10px rgba(39, 198, 245, 0.3); } .auth-btn:hover { background: var(--primary-dark); } .auth-link { margin-top: 20px; font-size: 14px; color: #888; } .auth-link a { color: var(--primary); text-decoration: none; font-weight: bold; cursor: pointer; } .auth-link a:hover { text-decoration: underline; } .social-login-area { margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px; } .social-login-label { font-size: 12px; color: #888; margin-bottom: 10px; } .social-login-btn { width: 100%; padding: 10px; border-radius: 25px; font-weight: bold; font-size: 14px; margin-bottom: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; border: 1px solid #ddd; background: white; transition: background 0.2s; } .social-login-btn:hover { background: #f5f5f5; }

        footer { background: linear-gradient(135deg, #27C6F5, #89CFF0); color: white; padding: 50px 20px 30px; margin-top: auto; }
        .footer-container { max-width: 1000px; margin: 0 auto; display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 30px; }
        .footer-left, .footer-right { flex: 1; min-width: 250px; }
        .footer-right { display: flex; flex-direction: column; align-items: flex-end; }
        .footer-menu { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 15px; }
        .footer-menu li a { color: white; text-decoration: none; font-family: 'Oswald', sans-serif; font-weight: 500; font-size: 36px; letter-spacing: 1px; transition: opacity 0.2s; display: flex; align-items: baseline; cursor: pointer; }
        .footer-menu-ja { font-family: 'M PLUS Rounded 1c', sans-serif; font-weight: 400; font-size: 14px; margin-left: 20px; opacity: 0.8; letter-spacing: 0.05em; } .footer-menu li a:hover { opacity: 0.7; }
        .footer-logo { height: 240px; width: auto; margin-bottom: 30px; }
        .footer-sns { display: flex; gap: 15px; }
        .footer-sns-btn { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.2); transition: transform 0.2s, background 0.2s; text-decoration: none; }
        .footer-sns-btn:hover { transform: translateY(-3px); background: rgba(255, 255, 255, 0.4); }
        .footer-sns-icon-img { width: 30px; height: 30px; object-fit: contain; filter: brightness(0) invert(1); }
        .copyright { text-align: center; font-size: 12px; margin-top: 50px; opacity: 0.8; font-family: 'Poppins', sans-serif; }
        @media (max-width: 768px) { .footer-container { flex-direction: column; align-items: center; text-align: center; } .footer-right { align-items: center; margin-top: 40px; } .footer-menu li a { justify-content: center; } .footer-logo { height: 150px; } }

        /* ★ガイドラインページ用スタイル (追加) ★ */
        .guideline-box { background: white; border-radius: 15px; padding: 30px; border: 2px solid #eee; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.03); }
        .g-section { margin-bottom: 40px; }
        .g-head { font-size: 20px; font-weight: 900; color: var(--primary); margin-bottom: 20px; border-bottom: 2px dashed #ddd; padding-bottom: 10px; display: flex; align-items: center; gap: 10px; font-family: 'M PLUS Rounded 1c', sans-serif; }
        .g-head i { font-size: 24px; color: #ff9f43; }
        .g-text { font-size: 14px; line-height: 1.8; color: #555; margin-bottom: 20px; }
        .g-list { list-style: none; padding: 0; margin: 0; background: #f9f9f9; border-radius: 10px; padding: 20px; }
        .g-list li { position: relative; padding-left: 25px; margin-bottom: 12px; font-size: 14px; line-height: 1.6; color: #444; font-weight: bold; }
        .g-list li:last-child { margin-bottom: 0; }
        .g-list li::before { content: "✔"; color: var(--primary); position: absolute; left: 5px; top: 0; font-weight: 900; font-size: 16px; }
        .g-list.ng-list { background: #fff5f5; }
        .g-list.ng-list li::before { content: "✖"; color: #ff4757; }
        .g-tag-box { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
        .g-tag { background: white; border: 1px solid #ddd; padding: 5px 15px; border-radius: 20px; font-size: 12px; color: #666; font-family: 'Poppins', sans-serif; font-weight: bold; display: flex; align-items: center; gap: 5px; }
        .g-tag i { color: var(--primary); }

        /* ★ボイスサンプル用スタイル★ */
        .voice-section { width: 100%; margin-bottom: 30px; opacity: 0; animation: fadeInUp 0.5s 0.6s forwards; }
        .voice-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .voice-card {
            background: rgba(255,255,255,0.8); border: 2px solid var(--m-color); border-radius: 50px;
            padding: 10px 20px; display: flex; align-items: center; justify-content: space-between;
            cursor: pointer; transition: 0.2s; position: relative; overflow: hidden;
        }
        .voice-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); background: white; }
        .voice-card.playing { background: var(--m-color); color: white; }
        .voice-card.playing .voice-icon { color: white; animation: pulse-voice 1s infinite; }
        .voice-card.playing .voice-title { color: white; }
        .voice-icon { font-size: 20px; color: var(--m-color); margin-right: 15px; width: 30px; text-align: center; }
        .voice-title { font-weight: bold; font-size: 14px; color: #555; flex: 1; }
        .voice-time { font-size: 12px; font-weight: bold; opacity: 0.6; }
        @keyframes pulse-voice { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
        
        /* ★★★ 落書き（GRAFFITI）ページ用スタイル ★★★ */
        .board-container {
            background: #2b4a3c; /* 黒板色 */
            border: 10px solid #8B4513; /* 木枠 */
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            margin-bottom: 30px;
            position: relative;
        }
        .board-container::before {
            content: "DRAWING AREA"; position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
            background: #f1c40f; color: #333; padding: 2px 15px; font-weight: bold; border-radius: 4px; font-size: 12px;
        }
        canvas#drawCanvas {
            background: transparent;
            cursor: crosshair;
            display: block;
            margin: 0 auto;
            touch-action: none; /* スマホで描くときにスクロールしないように */
            background-image: radial-gradient(rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .paint-tools {
            display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 15px; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px;
        }
        .color-btn {
            width: 30px; height: 30px; border-radius: 50%; border: 2px solid white; cursor: pointer; transition: transform 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .color-btn:hover, .color-btn.active { transform: scale(1.2); border-color: #f1c40f; }
        .tool-btn {
            padding: 5px 15px; border-radius: 20px; background: white; font-size: 12px; font-weight: bold; cursor: pointer; border: none; font-family: 'Poppins', sans-serif;
        }
        .tool-btn:hover { background: var(--primary); color: white; }
        
        .post-form-area {
            background: white; padding: 20px; border-radius: 15px; border: 2px solid #eee; margin-top: 20px;
        }
        .graffiti-card {
            flex: 0 0 220px; /* 横幅固定 */
            background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 10px rgba(0,0,0,0.1);
            border: 1px solid #eee; display: flex; flex-direction: column;
        }
        .g-img-box { width: 100%; aspect-ratio: 4/3; background: #eee; border-bottom: 1px dashed #ccc; }
        .g-img { width: 100%; height: 100%; object-fit: contain; background: #2b4a3c; }
        .g-info { padding: 10px; }
        .g-title { font-weight: bold; font-size: 14px; margin-bottom: 5px; color: #333; }
        .g-author { font-size: 12px; color: #888; text-align: right; }

    </style>
</head>
<body>
    <div id="loadingScreen">
        <img src="logo.png" class="loading-logo" alt="Loading...">
        <div class="loading-text">LOADING...</div>
    </div>

    <header>
        <img src="logo.png" alt="AOHARU FRIENDS" class="logo-img" onclick="showPage('top')" id="headerLogo">
        <div class="header-right">
            <div id="headerLoginBtn" class="login-btn-header" onclick="openLoginModal()">LOGIN</div>
            <div class="menu-btn" onclick="toggleMenu()"><span style="margin-top:-2px;">☰</span></div>
        </div>
    </header>

    <div id="breadcrumbNav" class="breadcrumb-nav"></div>
    <div id="liveContainer" class="live-container"></div>
    
    <div id="sideMenu" class="side-menu">
        <div class="menu-close" onclick="toggleMenu()">×</div>
        <a href="javascript:void(0)" class="menu-link" onclick="showPage('top')">TOP</a>
        <a href="javascript:void(0)" class="menu-link" onclick="showPage('news')">NEWS</a>
        <a href="javascript:void(0)" class="menu-link" onclick="showPage('member')">MEMBER</a>
        <a href="javascript:void(0)" class="menu-link" onclick="showPage('schedule')">SCHEDULE</a>
        <a href="javascript:void(0)" class="menu-link" onclick="showPage('goods')">GOODS</a>
        <a href="javascript:void(0)" class="menu-link" onclick="showPage('radio')">RADIO</a>
        <a href="javascript:void(0)" class="menu-link" onclick="showPage('guideline')">GUIDELINE</a> <a href="javascript:void(0)" class="menu-link" onclick="openLoginModal(); toggleMenu();" style="color:var(--primary);">LOGIN</a>
        <a href="javascript:void(0)" class="menu-link" onclick="showPage('rakugaki')">GRAFFITI</a>
    </div>
    <div id="overlay" class="overlay" onclick="toggleMenu()"></div>

    <div id="copyToast">コピーしました✨</div>

    <div id="newsModal" class="modal" onclick="closeNewsModal()">
        <div class="modal-content news-modal-content" onclick="event.stopPropagation()">
            <span class="modal-close-btn" onclick="closeNewsModal()">×</span>
            <div><span id="modalDate" class="modal-date"></span><span id="modalTag" class="modal-tag"></span></div>
            <div id="modalTitle" class="modal-title"></div>
            <div id="modalBody" class="modal-body"></div>
        </div>
    </div>

    <div id="goodsModal" class="modal" onclick="closeGoodsModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close-btn" onclick="closeGoodsModal()">×</span>
            <img id="goodsModalImg" src="">
            <div id="goodsModalTitle"></div>
            <div id="goodsModalPrice"></div>
            <div id="goodsModalDesc"></div>
            <a href="#" id="goodsModalLink" class="buy-btn" target="_blank">販売ページへ</a>
        </div>
    </div>

    <div id="loginModal" class="modal" onclick="closeLoginModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close-btn" onclick="closeLoginModal()">×</span>
            <div class="auth-title">LOGIN</div>
            <input type="text" id="loginEmail" class="auth-input" placeholder="メールアドレス">
            <input type="password" id="loginPass" class="auth-input" placeholder="パスワード">
            <button class="auth-btn" id="loginBtn" onclick="loginUser()">ログインする</button>
            <div class="social-login-area">
                <div class="social-login-label">または SNSでログイン</div>
                <div class="social-login-btn" onclick="alert('Googleログインは準備中です')"><i class="fab fa-google"></i> Googleでログイン</div>
                <div class="social-login-btn" onclick="alert('Xログインは準備中です')"><i class="fab fa-x-twitter"></i> Xでログイン</div>
            </div>
            <div class="auth-link">はじめての方はこちら<br><a onclick="switchToRegister()">▶ 新規会員登録（無料）</a></div>
        </div>
    </div>

    <div id="registerModal" class="modal" onclick="closeRegisterModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close-btn" onclick="closeRegisterModal()">×</span>
            <div class="auth-title">REGISTER</div>
            <p style="font-size:12px; color:#888; margin-bottom:15px;">あおはる⭐︎フレンズの会員になって<br>限定コンテンツを楽しもう！</p>
            <input type="text" id="regName" class="auth-input" placeholder="ニックネーム">
            <input type="email" id="regEmail" class="auth-input" placeholder="メールアドレス">
            <input type="password" id="regPass" class="auth-input" placeholder="パスワード">
            <button class="auth-btn" id="regBtn" onclick="registerUser()">会員登録する</button>
            <div class="social-login-area">
                <div class="social-login-label">または SNSで登録</div>
                <div class="social-login-btn" onclick="alert('Google登録は準備中です')"><i class="fab fa-google"></i> Googleで登録</div>
                <div class="social-login-btn" onclick="alert('X登録は準備中です')"><i class="fab fa-x-twitter"></i> Xで登録</div>
            </div>
            <div class="auth-link">すでにアカウントをお持ちの方<br><a onclick="switchToLogin()">▶ ログインはこちら</a></div>
        </div>
    </div>

    <div id="top" class="page active">
        <div class="hero-section">
            <img src="top_logo.png" alt="AOHARU FRIENDS MAIN VISUAL" class="hero-logo-img">
        </div>
        <div class="container">
            <div id="nowOnAirSection">
                <div class="noa-title">NOW ON AIR</div>
                <div id="heroLiveArea"></div>
                <div id="subLiveGrid" class="sub-live-grid"></div>
            </div>

            <div class="section-title" style="margin-top: 0;"><div class="en-title">NEWS</div><span class="ja-title">最新情報</span></div>
            <div class="scroll-wrapper">
                <button class="scroll-btn left" onclick="scrollContent('topNewsList', 'left')">◀</button>
                <div class="scroll-grid" id="topNewsList">読み込み中...</div>
                <button class="scroll-btn right" onclick="scrollContent('topNewsList', 'right')">▶</button>
            </div>
            <div style="text-align:center;"><button onclick="showPage('news')" class="more-btn">MORE VIEW</button></div>

            <div class="section-title"><div class="en-title">SCHEDULE</div><span class="ja-title">配信スケジュール</span></div>
            <div class="scroll-wrapper">
                <button class="scroll-btn left" onclick="scrollContent('topScheduleList', 'left')">◀</button>
                <div class="scroll-grid" id="topScheduleList">読み込み中...</div>
                <button class="scroll-btn right" onclick="scrollContent('topScheduleList', 'right')">▶</button>
            </div>
            
            <div id="memberVideoSection" class="section-title"><div class="en-title">MEMBER ONLY</div><span class="ja-title">会員限定動画※会員登録しないと視聴できません</span></div>
            <div class="scroll-wrapper">
                <button class="scroll-btn left" onclick="scrollContent('memberVideoList', 'left')">◀</button>
                <div class="scroll-grid" id="memberVideoList">読み込み中...</div>
                <button class="scroll-btn right" onclick="scrollContent('memberVideoList', 'right')">▶</button>
            </div>

            <div style="text-align:center;"><button onclick="showPage('schedule')" class="more-btn">MORE VIEW</button></div>

            <div class="section-title"><div class="en-title">MEMBER</div><span class="ja-title">メンバー</span></div>
            <div class="member-grid" id="topMemberList"></div>
            <div style="text-align:center;"><button onclick="showPage('member')" class="more-btn">MORE VIEW</button></div>

            <div class="section-title"><div class="en-title">VIDEOS</div><span class="ja-title">最新動画</span></div>
            <div class="scroll-wrapper">
                <button class="scroll-btn left" onclick="scrollContent('topVideoList', 'left')">◀</button>
                <div class="scroll-grid" id="topVideoList">読み込み中...</div>
                <button class="scroll-btn right" onclick="scrollContent('topVideoList', 'right')">▶</button>
            </div>
            <div style="text-align:center;"><button class="more-btn" onclick="window.open('https://youtube.com', '_blank')">CHANNEL</button></div>

            <div class="sns-container" style="margin-top: 50px;">
                <div class="section-title"><div class="en-title" style="letter-spacing: 5px;">OFFICIAL SNS</div><span class="ja-title">あおはる⭐︎フレンズ公式SNS</span></div>
                <div class="sns-links">
                    <a href="#" id="groupTwitterLink" target="_blank" class="sns-btn"><img src="icon_x.png" alt="X" class="sns-logo-img"></a>
                    <a href="#" id="groupYoutubeLink" target="_blank" class="sns-btn youtube"><img src="icon_youtube.png" alt="YouTube" class="sns-logo-img"></a>
                </div>
            </div>

            <div class="contact-section">
                <div class="contact-title"><i class="fas fa-envelope"></i> CONTACT</div>
                <div class="contact-form">
                    <label class="form-label">お名前</label>
                    <input type="text" class="form-input" id="contactName" placeholder="あおはる 太郎">
                    
                    <label class="form-label">メールアドレス</label>
                    <input type="email" class="form-input" id="contactEmail" placeholder="example@aoharu.com">
                    
                    <label class="form-label">お問い合わせ種別</label>
                    <select class="form-select" id="contactType">
                        <option value="ご意見・ご感想">ご意見・ご感想</option>
                        <option value="お仕事の依頼">お仕事の依頼</option>
                        <option value="不具合報告">不具合報告</option>
                        <option value="その他">その他</option>
                    </select>

                    <label class="form-label">メッセージ</label>
                    <textarea class="form-textarea" id="contactMsg" rows="5" placeholder="お問い合わせ内容を入力してください"></textarea>

                    <button class="contact-btn" onclick="sendContact()">送信する</button>
                </div>
            </div>

        </div>
    </div>

    <div id="news" class="page">
        <div class="page-header">
            <div class="page-title-en">NEWS</div>
            <div class="page-title-jp">最新ニュース</div>
        </div>
        <div class="container">
            <div class="news-category-bar">
                <div class="news-cat-btn active">ALL</div>
                <div class="news-cat-btn">INFO</div>
                <div class="news-cat-btn">VIDEO</div>
                <div class="news-cat-btn">EVENT</div>
            </div>
            <div class="news-pickup">
                <img src="https://placehold.co/800x450/27C6F5/ffffff?text=PICK+UP+NEWS" class="news-pickup-img">
                <div class="news-pickup-content">
                    <div class="news-pickup-badge">CHECK!</div>
                    <div class="news-pickup-title">あおはる⭐︎フレンズ 公式サイトリニューアル記念キャンペーン実施中！</div>
                </div>
            </div>
            <div class="news-list" id="fullNewsList">読み込み中...</div>
        </div>
    </div>

    <div id="member" class="page">
        <div class="page-header">
            <div class="page-title-en">MEMBER</div>
            <div class="page-title-jp">メンバー紹介</div>
        </div>
        <div class="container">
            <div style="text-align:center; margin-bottom:40px; font-size:14px; color:#666;">
                <p>個性豊かな4人が集まったVTuberグループ。<br>ゲーム実況、歌ってみた、雑談など様々なジャンルで活動中！</p>
            </div>
            <div class="member-grid" id="memberGrid"></div>

            <div class="card-maker-area">
                <div class="section-title">
                    <div class="en-title" style="color:#ff4757;">DIGITAL CARD</div>
                    <span class="ja-title">推しメン会員証を作ろう！</span>
                </div>
                <div class="maker-container">
                    <div class="maker-controls">
                        <label>ニックネームを入力</label>
                        <input type="text" id="cardNameInput" placeholder="あおはる 太郎" maxlength="10" oninput="updateCard()">
                        <label>推しメンを選択</label>
                        <div class="oshi-buttons" id="oshiButtons"></div>
                    </div>
                    <div class="card-preview-wrapper">
                        <div id="digitalCard" class="digital-card">
                            <div class="card-bg"></div>
                            <div class="card-shine"></div>
                            <div class="card-content">
                                <div class="card-header">
                                    <span class="card-logo">AOHARU FRIENDS</span>
                                    <span class="card-official">OFFICIAL MEMBER</span>
                                </div>
                                <div class="card-body">
                                    <div style="margin-bottom:4px;"><span class="card-label">No.</span><span class="card-value number" id="cardNo">0000</span></div>
                                    <div style="margin-bottom:4px;"><span class="card-label">NAME</span><span class="card-value name" id="cardNameDisplay">GUEST</span></div>
                                    <div><span class="card-label">OSHI-MEN</span><span class="card-value" id="cardOshiDisplay">-----</span></div>
                                </div>
                                <div class="card-footer"><span id="cardDate">DATE: 2026.01.01</span></div>
                            </div>
                            <img src="" id="cardCharImg" class="card-char-img">
                        </div>
                    </div>
                    <button class="download-btn" onclick="downloadCard()">画像を保存する</button>
                </div>
            </div>
        </div>
    </div>

    <div id="memberDetail" class="page" style="padding:0; min-height: 100vh;"></div>

    <div id="schedule" class="page">
        <div class="page-header">
            <div class="page-title-en">SCHEDULE</div>
            <div class="page-title-jp">配信スケジュール</div>
        </div>
        <div class="container">
            <div class="timeline-container" id="scheduleList">
                </div>
        </div>
    </div>

    <div id="goods" class="page">
        <div class="page-header">
            <div class="page-title-en">GOODS</div>
            <div class="page-title-jp">公式グッズ</div>
        </div>
        <div class="container">
            <div class="goods-hero">
                <h3>NEW ARRIVAL</h3>
                <p>新作グッズが登場！今すぐチェック！</p>
            </div>
            <div class="section-title"><span class="ja-title" style="margin:0;">商品一覧</span></div>
            <div class="goods-grid" id="goodsList"></div>
        </div>
    </div>

    <div id="radio" class="page">
        <div class="page-header">
            <div class="page-title-en" style="color:#ff9f43;">RADIO</div>
            <div class="page-title-jp">お便り＆アフタートーク</div>
        </div>
        <div class="container">
            <div class="radio-theme-box">
                <div class="radio-theme-text" id="radioThemeDisplay">読み込み中...</div>
                <div style="text-align:center; font-size:12px; margin-top:5px; color:#ccc;" id="radioThemeNote"></div>
            </div>

            <div class="letter-form">
                <div class="section-title" style="margin-top:0;"><span class="ja-title">お便りを送る</span></div>
                <label class="form-label">ラジオネーム（必須）</label>
                <input type="text" class="form-input" id="radioName" placeholder="あおはる 太郎">
                
                <label class="form-label">コーナー選択</label>
                <select class="form-select" id="radioCorner">
                    <option value="ふつおた">ふつおた（普通のお便り）</option>
                    <option value="テーマメール">今週のテーマ</option>
                    <option value="無茶振り">メンバーへの無茶振り</option>
                    <option value="お悩み相談">お悩み相談室</option>
                </select>

                <label class="form-label">メッセージ</label>
                <textarea class="form-textarea" id="radioMessage" rows="5" placeholder="ここにメッセージを書いてね！"></textarea>

                <button class="radio-btn" onclick="submitRadio()">送信する</button>
            </div>

            <div class="diary-section">
                <div class="section-title"><span class="ja-title">放送後記＆裏話</span></div>
                <div id="radioDiaryList"></div>
            </div>
        </div>
    </div>

    <div id="guideline" class="page">
        <div class="page-header">
            <div class="page-title-en" style="color:#2ecc71;">GUIDELINE</div>
            <div class="page-title-jp">二次創作・切り抜きガイドライン</div>
        </div>
        <div class="container">
            <div class="guideline-box">
                <div class="g-text">
                    「あおはる⭐︎フレンズ」（以下、当グループ）を応援いただきありがとうございます。<br>
                    ファンの皆様に安心して推し活を楽しんでいただくため、二次創作や動画の切り抜きに関するガイドラインを制定いたしました。<br>
                    以下のルールを守って、楽しく活動していただければ幸いです！
                </div>

                <div class="g-section">
                    <div class="g-head"><i class="fas fa-palette"></i> 二次創作（イラスト・同人活動）について</div>
                    <div class="g-text">
                        メンバーを描いたイラスト（ファンアート）や、同人誌等の制作は歓迎しております！<br>
                        SNSに投稿する際は、ぜひ専用ハッシュタグをつけて投稿してください。メンバーが活動に使用させていただく場合があります（サムネイル、配信背景など）。
                    </div>
                    <ul class="g-list">
                        <li>非営利目的での個人活動（SNS投稿、Pixiv、無償配布など）は自由です。</li>
                        <li>同人誌やグッズの頒布については、過度な営利目的でなければOKです。</li>
                        <li>R-18（成人向け）作品については、専用のハッシュタグを使用し、未成年の目に触れないようゾーニングの配慮をお願いします。</li>
                        <li>AI生成画像については、「AI生成」であることを明記してください。</li>
                    </ul>
                    <div class="g-tag-box">
                        <div class="g-tag"><i class="fas fa-hashtag"></i> #あおはるArt</div>
                        <div class="g-tag"><i class="fas fa-hashtag"></i> #あおはるR (R-18)</div>
                    </div>
                </div>

                <div class="g-section">
                    <div class="g-head"><i class="fas fa-video"></i> 切り抜き動画について</div>
                    <div class="g-text">
                        YouTube配信の切り抜き動画（クリップ）の制作・投稿は大歓迎です！<br>
                        面白いシーンや感動的なシーンをぜひ拡散してください。
                    </div>
                    <ul class="g-list">
                        <li>動画の概要欄に、必ず「元動画のURL」と「チャンネルへのリンク」を記載してください。</li>
                        <li>歌枠（歌ってみた配信）の切り抜きは、楽曲の著作権の関係上、原則禁止とさせていただきます（一部例外あり）。</li>
                        <li>悪意のある編集（発言の捏造、誤解を招くタイトルなど）は禁止です。</li>
                        <li>YouTubeショート、TikTokへの投稿も歓迎です！</li>
                    </ul>
                    <div class="g-tag-box">
                        <div class="g-tag"><i class="fas fa-hashtag"></i> #あおはる切り抜き</div>
                    </div>
                </div>

                <div class="g-section" style="margin-bottom:0;">
                    <div class="g-head" style="color:#ff4757;"><i class="fas fa-exclamation-triangle" style="color:#ff4757;"></i> 禁止事項</div>
                    <ul class="g-list ng-list">
                        <li>公式のロゴ、メンバーの素材（立ち絵など）をそのままグッズ化・販売する行為</li>
                        <li>他者を攻撃する目的、政治的・宗教的な主張を含む利用</li>
                        <li>公式と誤認させるような振る舞い（なりすまし）</li>
                        <li>その他、公序良俗に反する行為、当グループが不適切と判断する行為</li>
                    </ul>
                </div>
            </div>

            <div style="text-align:center;">
                <button onclick="showPage('top')" class="more-btn">TOPへ戻る</button>
            </div>
        </div>
<div id="rakugaki" class="page">
        <div class="page-header">
            <div class="page-title-en" style="color:#f1c40f;">GRAFFITI</div>
            <div class="page-title-jp">みんなの黒板落書き</div>
        </div>
        <div class="container">
            <div class="board-container">
                <canvas id="drawCanvas" width="600" height="400"></canvas>
                
                <div class="paint-tools">
                    <div class="color-btn active" style="background:white;" onclick="changeColor(this, '#ffffff')"></div>
                    <div class="color-btn" style="background:#ff9ff3;" onclick="changeColor(this, '#ff9ff3')"></div>
                    <div class="color-btn" style="background:#feca57;" onclick="changeColor(this, '#feca57')"></div>
                    <div class="color-btn" style="background:#ff6b6b;" onclick="changeColor(this, '#ff6b6b')"></div>
                    <div class="color-btn" style="background:#48dbfb;" onclick="changeColor(this, '#48dbfb')"></div>
                    <div class="color-btn" style="background:#1dd1a1;" onclick="changeColor(this, '#1dd1a1')"></div>
                    
                    <button class="tool-btn" onclick="setEraser()"><i class="fas fa-eraser"></i> 消しゴム</button>
                    <button class="tool-btn" onclick="clearCanvas()"><i class="fas fa-trash"></i> 全消去</button>
                </div>
            </div>

            <div class="post-form-area">
                <div class="section-title" style="margin-top:0;"><span class="ja-title">落書きを投稿・保存する</span></div>
                <label class="form-label">作品タイトル</label>
                <input type="text" id="graffitiTitle" class="form-input" placeholder="あおはるちゃん描いたよ！">
                <label class="form-label">ニックネーム</label>
                <input type="text" id="graffitiName" class="form-input" placeholder="クリエイター名">
                
                <div style="display:flex; gap:10px;">
                    <button class="contact-btn" style="background:#333;" onclick="downloadGraffiti()">画像を保存のみ</button>
                    <button class="contact-btn" onclick="postGraffiti()">投稿する</button>
                </div>
            </div>

            <div class="section-title"><div class="en-title">GALLERY</div><span class="ja-title">みんなの作品</span></div>
            <div class="scroll-wrapper">
                <button class="scroll-btn left" onclick="scrollContent('graffitiList', 'left')">◀</button>
                <div class="scroll-grid" id="graffitiList">
                    <div style="padding:20px; color:#999; width:100%; text-align:center;">まだ投稿はありません。一番乗りしよう！</div>
                </div>
                <button class="scroll-btn right" onclick="scrollContent('graffitiList', 'right')">▶</button>
            </div>
        </div>
    </div>
    </div>

    <div class="floating-heart-btn" onclick="spawnHeart()">
        <i class="fas fa-heart"></i>
        <div class="like-badge" id="totalLikeCount">...</div>
    </div>

    <div id="omikujiAnimModal" class="modal" style="background:rgba(0,0,0,0.85);">
        <div class="modal-content" style="background:transparent; box-shadow:none; overflow:visible;">
            <div class="omi-anim-container">
                <div id="omiParticles" class="omi-particles"></div>
                <div class="omi-box-container">
                    <div id="omiSlip" class="omi-slip"></div>
                    <div id="omiBox" class="omi-box">おみくじ</div>
                </div>
            </div>
            <p style="color:white; font-weight:bold; margin-top:20px; font-size:20px; text-shadow:0 2px 5px rgba(0,0,0,0.5);">運命を抽選中...</p>
        </div>
    </div>

    <div id="omikujiModal" class="modal" onclick="closeOmikujiModal()">
        <div class="modal-content" style="text-align:center;" onclick="event.stopPropagation()">
            <span class="modal-close-btn" onclick="closeOmikujiModal()">×</span>
            
            <div id="omiCaptureArea" style="background:white; padding:10px; border-radius:10px;">
                <div style="font-size:24px; font-weight:900; margin-bottom:20px; color:var(--primary); font-family: 'M PLUS Rounded 1c', sans-serif;">今日の運勢は…？</div>
                <img id="omiResultImg" src="" class="omi-chara-img">
                <div id="omiResultRank" class="omi-rank"></div>
                <div id="omiResultMsg" class="omi-msg"></div>
                <div style="margin-top:15px;">ラッキーアイテム：<span id="omiResultItem" class="omi-item"></span></div>
            </div>

            <div class="omi-action-btns">
                <button class="sns-share-btn" onclick="shareOmikuji()"><i class="fab fa-x-twitter"></i> ポストする</button>
                <button class="save-img-btn" onclick="saveOmikuji()"><i class="fas fa-camera"></i> 保存する</button>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-container">
            <div class="footer-left">
                <ul class="footer-menu">
                    <li><a href="javascript:void(0)" onclick="showPage('top')">TOP<span class="footer-menu-ja">トップ</span></a></li>
                    <li><a href="javascript:void(0)" onclick="showPage('news')">NEWS<span class="footer-menu-ja">お知らせ</span></a></li>
                    <li><a href="javascript:void(0)" onclick="showPage('member')">MEMBER<span class="footer-menu-ja">メンバー</span></a></li>
                    <li><a href="javascript:void(0)" onclick="showPage('schedule')">SCHEDULE<span class="footer-menu-ja">スケジュール</span></a></li>
                    <li><a href="javascript:void(0)" onclick="showPage('goods')">GOODS<span class="footer-menu-ja">グッズ</span></a></li>
                    <li><a href="javascript:void(0)" onclick="showPage('radio')">RADIO<span class="footer-menu-ja">ラジオ</span></a></li>
                    <li><a href="javascript:void(0)" onclick="showPage('guideline')">GUIDELINE<span class="footer-menu-ja">ガイドライン</span></a></li> <li><a href="javascript:void(0)" onclick="openLoginModal()">LOGIN<span class="footer-menu-ja">ログイン</span></a></li>
                    <li><a href="javascript:void(0)" onclick="showPage('rakugaki')">GRAFFITI<span class="footer-menu-ja">落書き広場</span></a></li>
                </ul>
            </div>
            <div class="footer-right">
                <img src="logo.png" alt="AOHARU FRIENDS" class="footer-logo">
                <div class="footer-sns">
                    <a href="#" id="footerTwitterLink" target="_blank" class="footer-sns-btn"><img src="icon_x.png" alt="X" class="footer-sns-icon-img"></a>
                    <a href="#" id="footerYoutubeLink" target="_blank" class="footer-sns-btn"><img src="icon_youtube.png" alt="YouTube" class="footer-sns-icon-img"></a>
                </div>
            </div>
        </div>
        <div class="copyright">© 2026 AOHARU FRIENDS All Rights Reserved.</div>
    </footer>

<script>
        // ★★★ ここにGASのURLを貼り付けてください！ ★★★
        const GAS_API_URL = "https://script.google.com/macros/s/AKfycbykKAY7dzKcSfa6xXGfNexT4Q_Icgl2BaqQNoOMISVVr7ufaBNjz4XH4lNnqG56VdjB3Q/exec";

        // ★★★ YouTube Data APIキーを入れてください（空欄でもRSSで動作しますが、APIキーがあるとより正確です） ★★★
        let YOUTUBE_API_KEY = ""; 

        // --- 変数定義 ---
        let GROUP_CONFIG = {};
        let memberData = [];
        let goodsData = [{ name: "Loading...", price: "-", img: "icon.png", link: "#" }]; 

        const fortuneTypes = ["大吉", "中吉", "小吉", "吉", "末吉"];
        const luckyItems = ["ゲーミングPC", "エナジードリンク", "マイク", "配信機材", "推し活グッズ", "唐揚げ", "ラーメン", "猫", "ヘッドホン", "サイリウム"];
        const fortuneComments = [
            "今日は最高の配信ができそう！",
            "ラッキーアイテムを持って待機してね！",
            "推しの配信を見ると運気アップ！",
            "今日はゆっくりアーカイブを見よう。",
            "SNSで推しを布教するといいことあるかも！"
        ];
        
        let newsData = [], scheduleData = [], videoData = [], manualLiveData = [], memberVideoData = [];
        let radioBlogData = []; 
        let isMemberLoggedIn = false;
        let currentOmikujiResult = null; 
        let totalLikes = 0;
        let sessionLikes = 0;
        let likeSyncTimer = null;
        const secretCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
        let secretInput = [];
        let logoTapCount = 0;

        // ★読み込み開始（リロード対策済み）
        window.onload = function() { 
            // handleLocation(); ← ここにあったのを削除！

            fetchSheetData().then(() => {
                renderStaticParts(); 
                setTimeout(checkLiveStatus, 500);
                initCardMaker(); 
                renderRadioDiary(); 
                fetchLikes(); 
                initOmikuji(); 
                initEasterEgg(); 
                
                // ★ここに移動しました！
                // データが全て揃った後に「今どのページ？」を確認して表示します。
                handleLocation(); 
                
                // ★ローディング終了処理★
                const loader = document.getElementById('loadingScreen');
                if(loader) {
                    loader.classList.add('loaded');
                    setTimeout(() => loader.remove(), 500); 
                }
            });
        };

        window.onpopstate = handleLocation;

        function handleLocation() {
            const hash = location.hash;
            if (hash.startsWith('#member_')) {
                const index = parseInt(hash.split('_')[1]);
                if(memberData.length > 0) openMemberDetail(index, false); 
            } else if (hash) {
                const id = hash.replace('#', '');
                if(document.getElementById(id)) showPage(id, null, false);
            } else {
                showPage('top', null, false);
            }
        }

        async function fetchSheetData() {
            if (!GAS_API_URL || GAS_API_URL.indexOf("script.google.com") === -1) {
                console.error("GAS URLが設定されていません");
                return;
            }
            try {
                const res = await fetch(GAS_API_URL);
                const data = await res.json();
                
                if (data.config) {
                    const conf = {};
                    data.config.forEach(row => { conf[row.key] = row.value; });
                    if(conf.youtube_api_key) YOUTUBE_API_KEY = conf.youtube_api_key;
                    if(conf.radio_theme_main) document.getElementById('radioThemeDisplay').innerText = conf.radio_theme_main;
                    if(conf.radio_theme_sub) document.getElementById('radioThemeNote').innerText = conf.radio_theme_sub;
                    
                    GROUP_CONFIG.name = "あおはる⭐︎フレンズ";
                    if(conf.group_logo_img) GROUP_CONFIG.img = conf.group_logo_img;
                    if(conf.group_youtube_id) GROUP_CONFIG.youtubeChannelId = conf.group_youtube_id;
                    if(conf.group_twitter_url) GROUP_CONFIG.twitterUrl = conf.group_twitter_url;
                }

                if (data.members && data.members.length > 0) {
                    memberData = data.members;
                }

                if (data.news) { newsData = data.news; renderNews(); }
                if (data.schedule) { scheduleData = data.schedule; renderSchedule(); }
                if (data.videos) { videoData = data.videos; renderVideos(); }
                if (data.live) { manualLiveData = data.live; } 
                if (data.member_videos) { memberVideoData = data.member_videos; renderMemberVideos(); }
                if (data.radio_diaries) { radioBlogData = data.radio_diaries; } 
                
                if (data.goods) {
                    goodsData = data.goods;
                    document.getElementById('goodsList').innerHTML = goodsData.map((g, i) => `
                        <div class="goods-item" onclick="openGoodsModal(${i})">
                            <img src="${g.img}" class="goods-img">
                            <div class="goods-name">${g.name}</div>
                            <div class="goods-price">${g.price}</div>
                        </div>`).join('');
                }
            } catch (e) { console.error("Data Error:", e); }
        }

        function renderStaticParts() { 
            const twLink = document.getElementById('groupTwitterLink'); 
            const ytLink = document.getElementById('groupYoutubeLink'); 
            const footerTwLink = document.getElementById('footerTwitterLink'); 
            const footerYtLink = document.getElementById('footerYoutubeLink'); 
            
            if(GROUP_CONFIG.twitterUrl) {
                twLink.href = GROUP_CONFIG.twitterUrl; 
                footerTwLink.href = GROUP_CONFIG.twitterUrl;
            }
            if(GROUP_CONFIG.youtubeChannelId) {
                const ytUrl = `https://www.youtube.com/channel/${GROUP_CONFIG.youtubeChannelId}`;
                ytLink.href = ytUrl;
                footerYtLink.href = ytUrl; 
            }
            
            if(memberData.length > 0) {
                const memberHtml = memberData.map((m, i) => `<div class="member-card-vertical" onclick="openMemberDetail(${i})" style="--member-color: ${m.color}; --member-bg: url('${m.bgImg}');"><div class="member-img-wrapper"><img src="${m.img}" class="member-img-tachie"></div><a href="javascript:void(0)" class="member-link-overlay"></a></div>`).join(''); 
                document.getElementById('topMemberList').innerHTML = memberHtml; 
                document.getElementById('memberGrid').innerHTML = memberHtml; 
            }
        }

        // ★★★ 【完全版】LIVE埋め込みロジック (キャッシュ機能付き) ★★★
        async function checkLiveStatus() {
            const noaSection = document.getElementById('nowOnAirSection');
            const heroArea = document.getElementById('heroLiveArea');
            const subGrid = document.getElementById('subLiveGrid');
            heroArea.innerHTML = '';
            subGrid.innerHTML = '';
            
            // 手動設定のライブがある場合 (スプレッドシートの manualLive)
            if(manualLiveData && manualLiveData.length > 0) {
                noaSection.style.display = 'block';
                const mainLive = manualLiveData[0];
                renderLivePlayer(heroArea, mainLive.name, mainLive.image || "icon.png", mainLive.url, mainLive.title, true);
                if(manualLiveData.length > 1) {
                    for(let i=1; i<manualLiveData.length; i++) {
                        const sub = manualLiveData[i];
                        subGrid.innerHTML += createSubLiveCard(sub.name, sub.image, sub.url, sub.title);
                    }
                }
                return; // 手動優先ならここで終了
            }

            // APIキーがない場合、またはチャンネルIDがない場合は終了
            if(!YOUTUBE_API_KEY || memberData.length === 0) return;

            // キャッシュチェック (セッションストレージ: 15分間有効)
            const CACHE_KEY = 'aoharu_live_status';
            const CACHE_TIME = 15 * 60 * 1000; 
            const cached = sessionStorage.getItem(CACHE_KEY);
            let liveItems = [];

            if (cached) {
                const parsed = JSON.parse(cached);
                if (Date.now() - parsed.timestamp < CACHE_TIME) {
                    console.log("Using Cached Live Status");
                    liveItems = parsed.items;
                }
            }

            // キャッシュがない場合、APIで取得
            if (liveItems.length === 0) {
                console.log("Fetching YouTube API...");
                let targets = [...memberData];
                if(GROUP_CONFIG.youtubeChannelId) targets.push({ name: GROUP_CONFIG.name, img: GROUP_CONFIG.img, youtubeId: GROUP_CONFIG.youtubeChannelId });
                
                // 1人ずつチェック (API節約のため search ではなく videos.listを使いたいが、配信中か不明なので search を使う)
                // ※本来はGAS側で一括取得してHTMLに渡すのがベストですが、HTML単体で完結させるためここで実行します。
                for (const target of targets) {
                    if (target.youtubeId) {
                        try {
                            // "live" のみを検索 (APIコスト: 100/回)
                            // 注意: 頻繁なリロードは割り当て制限にかかります。必ずキャッシュを利用してください。
                            const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${target.youtubeId}&eventType=live&type=video&key=${YOUTUBE_API_KEY}`;
                            const res = await fetch(url);
                            const json = await res.json();
                            if (json.items && json.items.length > 0) {
                                const video = json.items[0];
                                liveItems.push({
                                    name: target.name,
                                    icon: target.img,
                                    videoId: video.id.videoId,
                                    title: video.snippet.title,
                                    status: 'live'
                                });
                            } else {
                                // liveがない場合、upcoming（配信予定）をチェックするか？
                                // コスト削減のため、今回はliveのみとします。
                            }
                        } catch(e) { console.error(e); }
                    }
                }
                // 結果を保存
                sessionStorage.setItem(CACHE_KEY, JSON.stringify({ timestamp: Date.now(), items: liveItems }));
            }

            // 描画処理
            if (liveItems.length > 0) {
                noaSection.style.display = 'block';
                // 1つ目をメインに
                const main = liveItems[0];
                renderLivePlayer(heroArea, main.name, main.icon, main.videoId, main.title, false); // false = isUrlではなくID
                
                // 2つ目以降をサブに
                if(liveItems.length > 1) {
                    for(let i=1; i<liveItems.length; i++) {
                        const sub = liveItems[i];
                        const link = `https://www.youtube.com/watch?v=${sub.videoId}`;
                        subGrid.innerHTML += createSubLiveCard(sub.name, sub.icon, link, sub.title);
                    }
                }
            }
        }

        // 埋め込みプレイヤー生成
        function renderLivePlayer(container, name, icon, urlOrId, title, isUrl) {
            let src = "";
            if(isUrl) {
                // URLからID抽出を試みる（簡易的）
                const match = urlOrId.match(/v=([^&]+)/);
                if(match) src = `https://www.youtube.com/embed/${match[1]}?autoplay=1&mute=1`;
                else src = urlOrId; // 埋め込み非対応URLかもしれないがそのまま
            } else {
                src = `https://www.youtube.com/embed/${urlOrId}?autoplay=1&mute=1`;
            }

            const html = `
                <div class="live-hero-wrapper">
                    <div class="live-iframe-box">
                        <iframe src="${src}" class="live-iframe" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                    <div class="live-info-bar">
                        <img src="${icon}" class="live-info-icon">
                        <div class="live-info-text">
                            <div class="live-info-name"><span class="live-status-badge">LIVE</span> ${name}</div>
                            <div class="live-info-title">${title}</div>
                        </div>
                    </div>
                </div>
            `;
            container.innerHTML = html;
        }

        function createSubLiveCard(name, icon, url, title) {
            return `
                <div class="sub-live-card" onclick="window.open('${url}', '_blank')">
                    <div style="background:#000; height:110px; display:flex; align-items:center; justify-content:center; color:white; font-size:10px;">
                        <img src="${icon}" style="height:40px; border-radius:50%; margin-right:5px;">
                        <span>Click to Watch</span>
                    </div>
                    <div class="sub-live-title">${title}</div>
                </div>
            `;
        }

        // --- 以下、既存機能 ---
        function initEasterEgg() {
            window.addEventListener('keydown', (e) => {
                secretInput.push(e.key);
                if (secretInput.length > secretCode.length) secretInput.shift();
                if (JSON.stringify(secretInput) === JSON.stringify(secretCode)) activateFeverMode();
            });
            const logo = document.getElementById('headerLogo');
            if(logo) {
                logo.addEventListener('click', (e) => {
                    e.preventDefault(); logoTapCount++;
                    if(logoTapCount === 10) { activateFeverMode(); logoTapCount = 0; }
                    setTimeout(() => logoTapCount = 0, 3000);
                });
            }
        }
        function activateFeverMode() {
            if(document.body.classList.contains('fever-mode')) return;
            document.body.classList.add('fever-mode');
            const text = document.createElement('div');
            text.className = 'fever-text'; text.innerText = "FEVER TIME!!";
            document.body.appendChild(text);
            var duration = 5000; var end = Date.now() + duration;
            (function frame() {
                if(typeof confetti === 'function'){
                    confetti({ particleCount: 2, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#ff0000', '#00ff00', '#0000ff'] });
                    confetti({ particleCount: 2, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#ff0000', '#00ff00', '#0000ff'] });
                }
                if (Date.now() < end) requestAnimationFrame(frame);
                else { document.body.classList.remove('fever-mode'); text.remove(); alert("祭りは終わった……"); }
            }());
        }

        // ★★★ おみくじ（派手カワ・リニューアル版）★★★
        function initOmikuji() {
            const container = document.querySelector('#top .container');
            // すでにある場合は作成しない
            if(container && !document.querySelector('.omikuji-area')) {
                const omikujiArea = document.createElement('div');
                omikujiArea.className = 'omikuji-area';
                omikujiArea.innerHTML = `
                    <div class="omi-deco d-1">✨</div>
                    <div class="omi-deco d-2">💖</div>
                    <div class="omi-title-ribbon">毎日1回運試し！</div>
                    <div class="omi-main-text">あおはるおみくじ</div>
                    <div class="omi-visual-box"><i class="fas fa-box-open"></i></div>
                    <br>
                    <button class="omikuji-btn" onclick="drawOmikuji()">おみくじを引く！</button>
                    <p style="font-size:11px; color:#888; margin-top:15px; font-weight:bold;">※推しメンが出るかも…！？</p>
                `;
                
                // 挿入場所：NOW ON AIRの下
                const noaSection = document.getElementById('nowOnAirSection');
                noaSection.parentNode.insertBefore(omikujiArea, noaSection.nextSibling);
            }
        }

        function drawOmikuji() {
            if(memberData.length === 0) return;
            const member = memberData[Math.floor(Math.random() * memberData.length)];
            const fortune = fortuneTypes[Math.floor(Math.random() * fortuneTypes.length)];
            const item = luckyItems[Math.floor(Math.random() * luckyItems.length)];
            const comment = fortuneComments[Math.floor(Math.random() * fortuneComments.length)];
            currentOmikujiResult = { member, fortune, item, comment };
            const animModal = document.getElementById('omikujiAnimModal');
            const box = document.getElementById('omiBox');
            const slip = document.getElementById('omiSlip');
            const particlesContainer = document.getElementById('omiParticles');
            particlesContainer.innerHTML = '';
            animModal.classList.add('open'); box.classList.add('shaking');
            setTimeout(() => {
                box.classList.remove('shaking'); box.classList.add('pre-burst');
                setTimeout(() => {
                    box.classList.remove('pre-burst'); slip.classList.add('coming-out'); animModal.classList.add('burst');
                    if(typeof spawnConfetti === 'function') spawnConfetti(particlesContainer);
                    setTimeout(() => {
                        animModal.classList.remove('open'); animModal.classList.remove('burst'); slip.classList.remove('coming-out');
                        showOmikujiResult();
                    }, 1500);
                }, 500);
            }, 2500);
        }
        function spawnConfetti(container) {
            const colors = ['#FF512F', '#DD2476', '#FFD700', '#27C6F5', '#ffffff'];
            const icons = ['fa-star', 'fa-heart', 'fa-music', 'fa-bolt'];
            for (let i = 0; i < 50; i++) {
                const el = document.createElement('i');
                el.className = `fas ${icons[Math.floor(Math.random() * icons.length)]} confetti`;
                el.style.color = colors[Math.floor(Math.random() * colors.length)];
                el.style.left = '50%'; el.style.top = '50%';
                const angle = Math.random() * 360; const dist = 150 + Math.random() * 200;
                el.style.setProperty('--tx', `${Math.cos(angle * Math.PI / 180) * dist}px`);
                el.style.setProperty('--ty', `${Math.sin(angle * Math.PI / 180) * dist}px`);
                el.style.setProperty('--r', `${Math.random() * 720 - 360}deg`);
                container.appendChild(el);
            }
            const shockwave = document.createElement('div'); shockwave.className = 'shockwave'; container.appendChild(shockwave);
        }
        function showOmikujiResult() {
            if(!currentOmikujiResult) return;
            document.getElementById('omiResultImg').src = currentOmikujiResult.member.img;
            document.getElementById('omiResultRank').innerText = currentOmikujiResult.fortune;
            document.getElementById('omiResultMsg').innerText = `${currentOmikujiResult.member.name}「${currentOmikujiResult.comment}」`;
            document.getElementById('omiResultItem').innerText = currentOmikujiResult.item;
            document.getElementById('omikujiModal').classList.add('open');
        }
        function closeOmikujiModal() { document.getElementById('omikujiModal').classList.remove('open'); }
        function shareOmikuji() {
            if(!currentOmikujiResult) return;
            const text = `【あおはるおみくじ】\n今日の運勢は…「${currentOmikujiResult.fortune}」でした！\nラッキーアイテム：${currentOmikujiResult.item}\n${currentOmikujiResult.member.name}「${currentOmikujiResult.comment}」\n#あおはるフレンズ #あおはるおみくじ`;
            const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(location.href)}`;
            window.open(url, '_blank');
        }
        function saveOmikuji() {
            const target = document.getElementById('omiCaptureArea');
            html2canvas(target, { scale: 3, backgroundColor: null, useCORS: true }).then(canvas => {
                const link = document.createElement('a'); link.download = 'aoharu_omikuji.png'; link.href = canvas.toDataURL('image/png'); link.click();
            });
        }

        function copyText(text) {
            navigator.clipboard.writeText(text).then(() => {
                const toast = document.getElementById('copyToast'); toast.style.display = 'block';
                const newOne = toast.cloneNode(true); toast.parentNode.replaceChild(newOne, toast);
                setTimeout(() => { newOne.style.display = 'none'; }, 2000);
            });
        }
        function openGoodsModal(index) {
            const item = goodsData[index];
            document.getElementById('goodsModalImg').src = item.img;
            document.getElementById('goodsModalTitle').innerText = item.name;
            document.getElementById('goodsModalPrice').innerText = item.price;
            document.getElementById('goodsModalDesc').innerText = item.detail || "最高品質のグッズです！";
            const linkBtn = document.getElementById('goodsModalLink'); linkBtn.href = item.link || "#";
            document.getElementById('goodsModal').classList.add('open');
        }
        function closeGoodsModal() { document.getElementById('goodsModal').classList.remove('open'); }
        
        async function fetchLikes() {
            if (!GAS_API_URL) return;
            try {
                const res = await fetch(`${GAS_API_URL}?action=get_likes`);
                const json = await res.json();
                totalLikes = json.count || 0; updateLikeDisplay();
            } catch (e) { console.error(e); }
        }
        function updateLikeDisplay() { document.getElementById('totalLikeCount').innerText = totalLikes + sessionLikes; }
        function spawnHeart() {
            const heart = document.createElement('i'); heart.className = 'fas fa-heart heart-particle';
            const colors = ['#ff9a9e', '#ff6b6b', '#feca57', '#48dbfb', '#ff9ff3'];
            heart.style.color = colors[Math.floor(Math.random() * colors.length)];
            heart.style.left = (window.innerWidth - 80 + (Math.random() * 40)) + 'px'; 
            heart.style.bottom = '80px'; document.body.appendChild(heart);
            setTimeout(() => heart.remove(), 1500); 
            sessionLikes++; updateLikeDisplay();
            clearTimeout(likeSyncTimer); likeSyncTimer = setTimeout(syncLikes, 2000);
        }
        async function syncLikes() {
            if (sessionLikes === 0) return;
            const countToSend = sessionLikes; sessionLikes = 0; totalLikes += countToSend; updateLikeDisplay();
            if (!GAS_API_URL) return;
            try {
                const res = await fetch(`${GAS_API_URL}?action=add_likes&count=${countToSend}`);
                const json = await res.json();
                if (json.total) { totalLikes = json.total; updateLikeDisplay(); }
            } catch (e) { console.error("Like Sync Error", e); }
        }

        async function submitRadio() {
            const name = document.getElementById('radioName').value;
            const corner = document.getElementById('radioCorner').value;
            const msg = document.getElementById('radioMessage').value;
            if(!name || !msg) { alert("ラジオネームとメッセージを入力してね！"); return; }
            if (!GAS_API_URL) { alert("GAS URL未設定"); return; }
            const btn = document.querySelector('.radio-btn'); btn.disabled = true; btn.innerText = "送信中...";
            try {
                const url = `${GAS_API_URL}?action=submit_radio&name=${encodeURIComponent(name)}&corner=${encodeURIComponent(corner)}&message=${encodeURIComponent(msg)}`;
                const res = await fetch(url); const json = await res.json();
                if (json.status === 'success') { alert(`送信完了！\nありがとう、${name}さん！`); document.getElementById('radioName').value = ""; document.getElementById('radioMessage').value = ""; } 
                else { alert("送信エラーが発生しました"); }
            } catch (e) { alert("通信エラーが発生しました"); } finally { btn.disabled = false; btn.innerText = "送信する"; }
        }
        async function sendContact() {
            const name = document.getElementById('contactName').value;
            const email = document.getElementById('contactEmail').value;
            const type = document.getElementById('contactType').value;
            const msg = document.getElementById('contactMsg').value;
            if(!name || !email || !msg) { alert('すべての項目を入力してください'); return; }
            if (!GAS_API_URL) { alert("GAS URL未設定"); return; }
            const btn = document.querySelector('.contact-btn'); btn.disabled = true; btn.innerText = "送信中...";
            try {
                const url = `${GAS_API_URL}?action=submit_contact&name=${encodeURIComponent(name)}&email=${encodeURIComponent(email)}&type=${encodeURIComponent(type)}&message=${encodeURIComponent(msg)}`;
                const res = await fetch(url); const json = await res.json();
                if (json.status === 'success') { alert('お問い合わせありがとうございます！\n送信が完了しました。'); document.getElementById('contactMsg').value = ""; } 
                else { alert('送信に失敗しました。'); }
            } catch(e) { alert('通信エラーが発生しました'); } finally { btn.disabled = false; btn.innerText = "送信する"; }
        }

        function renderRadioDiary() {
            const container = document.getElementById('radioDiaryList');
            if (!radioBlogData || radioBlogData.length === 0) { container.innerHTML = '<p style="text-align:center;color:#888;">まだ日記はありません</p>'; return; }
            
            container.innerHTML = radioBlogData.map(d => {
                // ★追加：ログインしていなければ「モザイク（鍵）」を表示して終わり
                if (!isMemberLoggedIn) {
                    return `
                        <div class="diary-card" onclick="openLoginModal()" style="cursor:pointer; position:relative; overflow:hidden;">
                            <div style="filter: blur(6px); opacity: 0.6; pointer-events: none;">
                                <div class="diary-icon" style="background:#ddd;"></div>
                                <div class="diary-content">
                                    <div class="diary-name">SECRET MEMBER</div>
                                    <div class="diary-text">このコンテンツは会員限定です。<br>ログインすると閲覧できます。</div>
                                    <div class="diary-date">----.--.--</div>
                                </div>
                            </div>
                            <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center; width:100%; z-index:2;">
                                <i class="fas fa-lock" style="font-size:24px; color:#555; margin-bottom:5px;"></i>
                                <div style="font-weight:bold; font-size:12px; color:#555;">MEMBER ONLY</div>
                            </div>
                        </div>
                    `;
                }

                // --- ここから下は「ログイン済み」の場合の表示（さっきと同じ） ---
                
                let iconSrc = "icon.png";
                let imgPos = "top center"; 

                // 1. 名前でメンバーリストから検索
                if (memberData && memberData.length > 0) {
                    const targetMember = memberData.find(m => m.name === d.name);
                    if (targetMember) {
                        if(targetMember.img) iconSrc = targetMember.img;
                        if(targetMember.icon_pos) imgPos = targetMember.icon_pos;
                    }
                }
                // 2. 個別画像指定があれば優先
                if (d.img && d.img !== "") iconSrc = d.img;

                const voicePlayer = d.voice ? 
                    `<div class="diary-voice-player" onclick="playVoice(this, '${d.voice}')">
                        <i class="fas fa-play voice-icon"></i> 
                        <span class="voice-time">限定ボイス</span>
                    </div>` : '';

                return `
                    <div class="diary-card">
                        <div class="diary-icon" style="background-image: url('${iconSrc}'); background-position: ${imgPos};"></div>
                        <div class="diary-content">
                            <div class="diary-name">${d.name}</div>
                            <div class="diary-text">${d.text}</div>
                            ${voicePlayer}
                            <div class="diary-date">${d.date}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        async function registerUser() { const name = document.getElementById('regName').value, email = document.getElementById('regEmail').value, pass = document.getElementById('regPass').value, btn = document.getElementById('regBtn'); if(!name || !email || !pass) { alert("全ての項目を入力してください"); return; } if (!GAS_API_URL) { alert("GAS URL未設定"); return; } btn.innerText = "送信中..."; btn.disabled = true; try { const res = await fetch(`${GAS_API_URL}?action=register&name=${encodeURIComponent(name)}&email=${encodeURIComponent(email)}&pass=${encodeURIComponent(pass)}`); const json = await res.json(); if (json.status === 'success') { alert("登録完了！\n会員ID: " + json.id); closeRegisterModal(); document.getElementById('regName').value = ""; document.getElementById('regEmail').value = ""; document.getElementById('regPass').value = ""; } else { alert("登録エラー: " + json.message); } } catch (e) { alert("通信エラー"); } finally { btn.innerText = "会員登録する"; btn.disabled = false; } }
        async function loginUser() { const email = document.getElementById('loginEmail').value, pass = document.getElementById('loginPass').value, btn = document.getElementById('loginBtn'); if(!email || !pass) { alert("メールアドレスとパスワードを入力してください"); return; } if (!GAS_API_URL) { alert("GAS URL未設定"); return; } btn.innerText = "確認中..."; btn.disabled = true; try { const res = await fetch(`${GAS_API_URL}?action=login&email=${encodeURIComponent(email)}&pass=${encodeURIComponent(pass)}`); const json = await res.json(); if (json.status === 'success') { alert("ログイン成功！ようこそ " + json.name + " さん！"); closeLoginModal(); const headerBtn = document.getElementById('headerLoginBtn'); headerBtn.innerText = `${json.name} 様`; headerBtn.classList.add('logged-in-user'); headerBtn.onclick = null; isMemberLoggedIn = true; renderMemberVideos(); } else { alert("ログイン失敗: " + json.message); } } catch (e) { alert("通信エラー"); } finally { btn.innerText = "ログインする"; btn.disabled = false; } }
        function updateBreadcrumbs(pageId, detailName) { 
            const container = document.getElementById('breadcrumbNav'); 
            let html = '<a href="javascript:void(0)" onclick="showPage(\'top\')" class="bc-item"><i class="fas fa-home bc-icon"></i></a>'; 
            if (pageId === 'top') { container.style.display = 'none'; return; } else { container.style.display = 'flex'; } 
            const sep = '<span class="bc-sep">▶</span>'; 
            if (pageId === 'news') html += sep + '<span class="bc-current">NEWS</span>'; 
            else if (pageId === 'member') html += sep + '<span class="bc-current">MEMBER</span>'; 
            else if (pageId === 'schedule') html += sep + '<span class="bc-current">SCHEDULE</span>'; 
            else if (pageId === 'goods') html += sep + '<span class="bc-current">GOODS</span>'; 
            else if (pageId === 'radio') html += sep + '<span class="bc-current">RADIO</span>'; 
            else if (pageId === 'guideline') html += sep + '<span class="bc-current">GUIDELINE</span>'; /* ガイドライン追加 */
            else if (pageId === 'rakugaki') html += sep + '<span class="bc-current">GRAFFITI</span>';
            else if (pageId === 'memberDetail') { html += sep + '<a href="javascript:void(0)" onclick="showPage(\'member\')" class="bc-item">MEMBER</a>'; html += sep + '<span class="bc-current">' + (detailName || 'DETAIL') + '</span>'; } 
            container.innerHTML = html; 
        }
        function renderNews() { const newsHtml = newsData.map((n, i) => { const imgSrc = n.image ? n.image : "https://placehold.co/600x400/eee/333?text=NEWS"; return `<div class="news-card" onclick="openNewsModal(${i})"><div class="news-thumb-area"><span class="news-badge" style="background:${getTagColor(n.tag)}">${n.tag}</span><img src="${imgSrc}" class="news-img"></div><div class="news-content"><div class="news-date">${n.date}</div><div class="news-title">${n.title}</div><div class="news-check-btn">CHECK</div></div></div>`; }).join(''); document.getElementById('topNewsList').innerHTML = newsHtml || "まだニュースはありません"; document.getElementById('fullNewsList').innerHTML = newsHtml || "まだニュースはありません"; }
        function renderSchedule() { const topScheduleHtml = scheduleData.map(s => `<div class="schedule-card"><div class="sch-thumb-box"><div class="sch-date-big">${s.date}</div><div class="sch-time-big">${s.time}</div></div><div class="sch-info"><span class="sch-badge-mini">配信</span><div class="sch-title">${s.content}</div></div></div>`).join(''); document.getElementById('topScheduleList').innerHTML = topScheduleHtml || "予定はありません"; document.getElementById('scheduleList').innerHTML = scheduleData.map(s => ` <div class="timeline-item"> <div class="tl-icon-box"><div class="tl-icon"><i class="fas fa-video"></i></div></div> <div class="tl-content"> <div class="tl-date">${s.date} <span style="font-size:12px;color:#888;">${s.time}</span></div> <div class="tl-title">${s.content}</div> <span class="tl-tag">配信</span> </div> </div>`).join(''); }
        function renderVideos() { const videoHtml = videoData.map(v => `<div class="video-card" onclick="window.open('https://www.youtube.com/watch?v=${v.id}', '_blank')"><div class="video-thumb-box"><img src="https://img.youtube.com/vi/${v.id}/mqdefault.jpg" class="video-thumb"><div class="play-icon">▶</div></div><div class="video-info"><div class="video-title">${v.title}</div><div class="video-date">${v.date}</div></div></div>`).join(''); document.getElementById('topVideoList').innerHTML = videoHtml || "動画はまだありません"; }
        function renderMemberVideos() { const container = document.getElementById('memberVideoList'); if(!memberVideoData.length) { container.innerHTML = "限定動画はまだありません"; return; } const html = memberVideoData.map(v => { const clickAction = isMemberLoggedIn ? `window.open('https://www.youtube.com/watch?v=${v.id}', '_blank')` : `openLoginModal()`; const lockedClass = isMemberLoggedIn ? 'unlocked' : 'mv-blur'; const lockOverlay = isMemberLoggedIn ? '' : `<div class="mv-lock-overlay"><div class="mv-lock-icon"><i class="fas fa-lock"></i></div><div class="mv-lock-text">MEMBER ONLY</div></div>`; return `<div class="member-video-card ${lockedClass}" onclick="${clickAction}">${lockOverlay}<div class="news-thumb-area"><img src="https://img.youtube.com/vi/${v.id}/mqdefault.jpg" class="news-img"></div><div class="news-content"><div class="news-date">${v.date}</div><div class="news-title">${v.title}</div><div class="news-check-btn">${isMemberLoggedIn ? 'PLAY' : 'LOCKED'}</div></div></div>`; }).join(''); container.innerHTML = html; }
        
        // ★メンバー詳細表示（ボイス対応版）
        function openMemberDetail(index, pushHistory = true) {
            const m = memberData[index];
            const detailContainer = document.getElementById('memberDetail');
            
            // SNSリンク生成
            const twitchLink = m.twitchId ? `<a href="https://www.twitch.tv/${m.twitchId}" target="_blank" class="p-btn" style="background:#9146FF;color:white;box-shadow:0 5px 15px rgba(145,70,255,0.3);"><i class="fab fa-twitch"></i> Twitch</a>` : '';
            const twitterLink = m.twitterId ? `https://x.com/${m.twitterId}` : '#';
            
            // ★ボイスリスト生成ロジック★
            // シートの列名が voice1, voice2, voice3 だと仮定
            // title1, title2, title3 でタイトルも指定可能（なければデフォルト）
            let voiceHtml = '';
            const voices = [
                { url: m.voice1 || m.voice, title: m.title1 || "自己紹介", time: "0:10" }, // voice1がなければ旧voiceを使用
                { url: m.voice2, title: m.title2 || "ご挨拶", time: "0:05" },
                { url: m.voice3, title: m.title3 || "システム音", time: "0:03" }
            ];

            // URLがあるものだけ表示
            const activeVoices = voices.filter(v => v.url);
            
            if (activeVoices.length > 0) {
                const voiceItems = activeVoices.map((v, i) => `
                    <div class="voice-card" onclick="playVoice(this, '${v.url}')">
                        <i class="fas fa-play voice-icon"></i>
                        <span class="voice-title">${v.title}</span>
                        <span class="voice-time">PLAY</span>
                    </div>
                `).join('');
                
                voiceHtml = `
                    <div class="voice-section">
                        <div style="font-weight:bold; color:var(--m-color); margin-bottom:10px; border-bottom:2px dashed var(--m-color); padding-bottom:5px; display:inline-block;">
                            <i class="fas fa-microphone-alt"></i> SAMPLE VOICE
                        </div>
                        <div class="voice-grid">${voiceItems}</div>
                    </div>
                `;
            }

            // HTML生成
            detailContainer.innerHTML = `
                <div class="member-bg-layer" style="background-image: url('${m.img}');"></div>
                <div class="profile-header-bg" style="--m-color: ${m.color}; --m-color-light: ${m.color}20;">
                    <div class="profile-wrapper">
                        <div class="profile-visual">
                            <img src="${m.img}" class="profile-tachie" alt="${m.name}">
                        </div>
                        <div class="profile-info">
                            <div class="profile-en-name">${m.enName || 'MEMBER'}</div>
                            <div class="profile-jp-name">${m.name}</div>
                            <div class="profile-catch">${m.catchphrase || ''}</div>
                            
                            <div class="profile-data-list">
                                <div class="p-data-item"><span class="p-label">誕生日</span><span class="p-value">${m.birthday || '-'}</span></div>
                                <div class="p-data-item"><span class="p-label">身長</span><span class="p-value">${m.height || '-'}</span></div>
                                <div class="p-data-item"><span class="p-label">ファンネーム</span><span class="p-value copy-tag" onclick="copyText('${m.fanName}')">${m.fanName || '-'} <i class="far fa-copy copy-icon"></i></span></div>
                                <div class="p-data-item"><span class="p-label">ファンアートタグ</span><span class="p-value copy-tag" style="color:var(--m-color)" onclick="copyText('${m.hashTag}')">${m.hashTag || '-'} <i class="far fa-copy copy-icon"></i></span></div>
                            </div>

                            <div class="profile-bio">${m.bio || ''}</div>
                            
                            ${voiceHtml}

                            <div class="profile-actions">
                                <a href="${m.youtubeId ? 'https://www.youtube.com/channel/' + m.youtubeId : '#'}" target="_blank" class="p-btn yt"><i class="fab fa-youtube"></i> YouTube</a>
                                ${twitchLink}
                                <a href="${twitterLink}" target="_blank" class="p-btn x"><i class="fab fa-x-twitter"></i> X</a>
                            </div>
                            
                            <div style="text-align:right;">
                                <span class="back-link" onclick="showPage('member')">◀ MEMBER LIST</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            if(pushHistory) history.pushState(null, null, '#member_' + index);
            showPage('memberDetail', m.name, false);
        }
        function scrollContent(elementId, direction) { const container = document.getElementById(elementId); const scrollAmount = container.clientWidth / 2; if (direction === 'left') container.scrollBy({ left: -scrollAmount, behavior: 'smooth' }); else container.scrollBy({ left: scrollAmount, behavior: 'smooth' }); }
        function openNewsModal(index) { const data = newsData[index]; document.getElementById('modalDate').innerText = data.date; const tagEl = document.getElementById('modalTag'); tagEl.innerText = data.tag; tagEl.style.background = getTagColor(data.tag); document.getElementById('modalTitle').innerText = data.title; document.getElementById('modalBody').innerText = data.detail || data.title; document.getElementById('newsModal').classList.add('open'); }
        function closeNewsModal() { document.getElementById('newsModal').classList.remove('open'); }
        function openLoginModal() { document.getElementById('loginModal').classList.add('open'); }
        function closeLoginModal() { document.getElementById('loginModal').classList.remove('open'); }
        function openRegisterModal() { document.getElementById('registerModal').classList.add('open'); }
        function closeRegisterModal() { document.getElementById('registerModal').classList.remove('open'); }
        function switchToRegister() { closeLoginModal(); setTimeout(openRegisterModal, 300); }
        function switchToLogin() { closeRegisterModal(); setTimeout(openLoginModal, 300); }
        function getTagColor(tag) { if(tag === 'INFO') return '#27C6F5'; if(tag === 'VIDEO') return '#ff4757'; return '#ccc'; }
        function toggleMenu() { document.getElementById('sideMenu').classList.toggle('open'); document.getElementById('overlay').classList.toggle('open'); }
        function showPage(pageId, detailName = null, pushHistory = true) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById(pageId).classList.add('active'); if(document.getElementById('sideMenu').classList.contains('open')) { toggleMenu(); } if(pushHistory) history.pushState(null, null, '#' + pageId); updateBreadcrumbs(pageId, detailName); if(pageId === 'rakugaki') { setTimeout(initCanvas, 100); } window.scrollTo(0,0); }
        function initCardMaker() { const today = new Date(); const dStr = `${today.getFullYear()}.${(today.getMonth()+1).toString().padStart(2,'0')}.${today.getDate().toString().padStart(2,'0')}`; const cardDateEl = document.getElementById('cardDate'); if(cardDateEl) cardDateEl.innerText = 'DATE: ' + dStr; const cardNoEl = document.getElementById('cardNo'); if(cardNoEl) cardNoEl.innerText = dStr.replace(/\./g,'') + '-' + (Math.floor(Math.random()*9000)+1000); const btnContainer = document.getElementById('oshiButtons'); if(btnContainer) { btnContainer.innerHTML = ''; memberData.forEach((m, i) => { const btn = document.createElement('div'); btn.className = 'oshi-btn'; btn.style.backgroundImage = `url('${m.img}')`; btn.onclick = () => selectOshi(i); btnContainer.appendChild(btn); }); if(memberData.length > 0) selectOshi(0); } }
        function selectOshi(index) { 
            currentOshiIndex = index; 
            const m = memberData[index]; 
            document.querySelectorAll('.oshi-btn').forEach((b, i) => b.classList.toggle('selected', i === index)); 
            
            const card = document.getElementById('digitalCard'); 
            if(card) { 
                card.style.setProperty('--card-color', m.color); 
                
                const bottom = m.card_bottom || "-20px";
                const right = m.card_right || "-50px";
                const width = m.card_width || "280px";

                card.style.setProperty('--char-bottom', bottom); 
                card.style.setProperty('--char-right', right); 
                card.style.setProperty('--char-width', width); 
                
                document.getElementById('cardOshiDisplay').innerText = m.name; 
                document.getElementById('cardCharImg').src = m.img; 
            } 
        }
        function updateCard() { const val = document.getElementById('cardNameInput').value; const display = document.getElementById('cardNameDisplay'); if(display) display.innerText = val ? val : 'GUEST'; }
        function downloadCard() { const card = document.getElementById('digitalCard'); html2canvas(card, { scale: 3, backgroundColor: null, useCORS: true }).then(canvas => { const link = document.createElement('a'); link.download = 'aoharu_card.png'; link.href = canvas.toDataURL('image/png'); link.click(); }); }

        // ★★★ 黒板落書き機能のロジック ★★★
        let canvas, ctx;
        let isDrawing = false;
        let currentColor = "#ffffff";
        let currentLineWidth = 3;

        // ページが表示されたらキャンバスを初期化
        function initCanvas() {
            canvas = document.getElementById('drawCanvas');
            ctx = canvas.getContext('2d');
            
            // スマホ対応：キャンバスサイズを親要素に合わせる（簡易レスポンシブ）
            const containerWidth = document.querySelector('.board-container').clientWidth - 40;
            if(window.innerWidth < 650) {
                canvas.width = containerWidth;
                canvas.height = containerWidth * 0.6; // アスペクト比維持
            }

            // イベントリスナー設定
            canvas.addEventListener('mousedown', startDraw);
            canvas.addEventListener('mousemove', drawing);
            canvas.addEventListener('mouseup', endDraw);
            canvas.addEventListener('mouseout', endDraw);
            
            // タッチイベント（スマホ用）
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault(); // スクロール防止
                startDraw(e.touches[0]);
            }, {passive: false});
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault(); // スクロール防止
                drawing(e.touches[0]);
            }, {passive: false});
            canvas.addEventListener('touchend', endDraw);
            
            // 初期設定
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.strokeStyle = currentColor;
            ctx.lineWidth = currentLineWidth;
        }

        // 描画開始
        function startDraw(e) {
            isDrawing = true;
            ctx.beginPath();
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || e.pageX) - rect.left;
            const y = (e.clientY || e.pageY) - rect.top;
            ctx.moveTo(x, y);
        }

        // 描画中
        function drawing(e) {
            if (!isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || e.pageX) - rect.left;
            const y = (e.clientY || e.pageY) - rect.top;
            ctx.lineTo(x, y);
            ctx.stroke();
        }

        // 描画終了
        function endDraw() {
            isDrawing = false;
        }

        // 色変更
        function changeColor(btn, color) {
            currentColor = color;
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.globalCompositeOperation = 'source-over'; // 通常描画モード
            
            // ボタンの見た目更新
            document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        // 消しゴム
        function setEraser() {
            ctx.lineWidth = 15;
            ctx.globalCompositeOperation = 'destination-out'; // 透明にするモード
            document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
        }

        // 全消去
        function clearCanvas() {
            if(confirm('本当に消しますか？')) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }

        // 画像のみ保存
        function downloadGraffiti() {
            // 背景色をつける（透明だと保存時に見えないため）
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            const tCtx = tempCanvas.getContext('2d');
            tCtx.fillStyle = "#2b4a3c"; // 黒板色
            tCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
            tCtx.drawImage(canvas, 0, 0);

            const link = document.createElement('a');
            link.download = 'aoharu_graffiti.png';
            link.href = tempCanvas.toDataURL('image/png');
            link.click();
        }

        // 投稿機能（擬似的にリストに追加）
        function postGraffiti() {
            const title = document.getElementById('graffitiTitle').value;
            const name = document.getElementById('graffitiName').value;
            
            if(!title || !name) {
                alert('タイトルとニックネームを入力してください！');
                return;
            }

            // 黒板背景と合成して画像化
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            const tCtx = tempCanvas.getContext('2d');
            tCtx.fillStyle = "#2b4a3c";
            tCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
            tCtx.drawImage(canvas, 0, 0);
            const dataUrl = tempCanvas.toDataURL('image/png');

            // カードHTML生成
            const cardHtml = `
                <div class="graffiti-card">
                    <div class="g-img-box">
                        <img src="${dataUrl}" class="g-img">
                    </div>
                    <div class="g-info">
                        <div class="g-title">${title}</div>
                        <div class="g-author">by ${name}</div>
                    </div>
                </div>
            `;

            // リストに追加（最初は「投稿なし」メッセージがあれば消す）
            const list = document.getElementById('graffitiList');
            if(list.innerText.includes('まだ投稿はありません')) {
                list.innerHTML = '';
            }
            // 先頭に追加
            list.insertAdjacentHTML('afterbegin', cardHtml);

            alert('投稿しました！ギャラリーに追加されたよ！');
            
            // フォームクリア
            document.getElementById('graffitiTitle').value = '';
            ctx.clearRect(0, 0, canvas.width, canvas.height); // キャンバスもクリア
        }

        // ★ボイス再生機能（同時再生防止機能付き）
        let currentAudio = null;
        let currentBtn = null;

        function playVoice(btn, url) {
            // もし同じボタンを押したら停止
            if (currentBtn === btn && currentAudio) {
                currentAudio.pause();
                resetPlayer();
                return;
            }

            // 他の再生中があれば止める
            if (currentAudio) {
                currentAudio.pause();
                resetPlayer();
            }

            // 新しく再生
            const audio = new Audio(url);
            audio.volume = 0.5; // 音量調整
            
            // デザイン変更
            btn.classList.add('playing');
            btn.querySelector('.voice-icon').className = 'fas fa-stop voice-icon';
            btn.querySelector('.voice-time').innerText = 'STOP';

            audio.play().catch(e => {
                console.error("再生エラー", e);
                alert("音声ファイルが再生できませんでした");
                resetPlayer();
            });

            // 再生終了時
            audio.onended = resetPlayer;

            currentAudio = audio;
            currentBtn = btn;
        }

        function resetPlayer() {
            if (currentBtn) {
                currentBtn.classList.remove('playing');
                currentBtn.querySelector('.voice-icon').className = 'fas fa-play voice-icon';
                currentBtn.querySelector('.voice-time').innerText = 'PLAY';
            }
            currentAudio = null;
            currentBtn = null;
        }
    </script>
</body>
</html>