<!DOCTYPE html>
<html lang="ja" prefix="og: http://ogp.me/ns#">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>あおはる⭐︎フレンズ Official</title>
    
    <link rel="icon" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">

    <meta property="og:title" content="あおはる⭐︎フレンズ Official Site">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://aoharu-site.vercel.app/">
    <meta property="og:image" content="https://aoharu-site.vercel.app/ogp.png">
    <meta property="og:description" content="2026年デビュー！4人組VTuberグループ「あおはる⭐︎フレンズ」の公式サイトです。">
    <meta property="og:site_name" content="あおはる⭐︎フレンズ Official">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@aoharu_official">
    
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;900&family=Oswald:wght@500;700&family=Poppins:wght@600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://bs-community.github.io/skinview3d/js/skinview3d.bundle.js"></script>

    <style>
        /* ▼▼▼ ベーススタイル（カーソル設定を追加） ▼▼▼ */
        :root { --primary: #27C6F5; --text-main: #444444; --text-sub: #888888; --bg-color: #ffffff; --light-bg: #f4f8fa; }
        
        body { 
            font-family: 'M PLUS Rounded 1c', sans-serif; margin: 0; padding: 0; 
            background-color: var(--bg-color); color: var(--text-main); 
            padding-top: 70px; overflow-x: hidden; display: flex; flex-direction: column; min-height: 100vh; 
            transition: filter 0.5s;
            
            /* ★追加：オリジナルカーソル */
            cursor: url('cursor_main.png') 4 4, auto;
        }

        /* ★追加：リンクやボタンに乗せた時のカーソル */
        a, button, .clickable, .news-card, .video-card, .schedule-card, .member-card-vertical, .menu-btn, .login-btn-header {
            cursor: url('cursor_hand.png') 10 0, pointer;
        }

        .page { display: none !important; animation: fadeInPage 0.4s ease; flex: 1; width: 100%; padding-bottom: 60px; }
        .page.active { display: block !important; }
        @keyframes fadeInPage { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ▼▼▼ 追加：背景キラキラアニメーション ▼▼▼ */
        .bg-shape-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; pointer-events: none; }
        .bg-shape { position: absolute; opacity: 0.1; animation: floatShape linear infinite; }
        @keyframes floatShape { 
            0% { transform: translateY(100vh) rotate(0deg); } 
            100% { transform: translateY(-20vh) rotate(360deg); } 
        }

        /* ★ローディング画面★ */
        #loadingScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #e0f7ff; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.5s, visibility 0.5s;
        }
        #loadingScreen.loaded { opacity: 0; visibility: hidden; pointer-events: none; }
        .loading-logo { width: 120px; height: auto; margin-bottom: 20px; animation: bounce-logo 1s infinite; }
        .loading-text { font-family: 'Poppins', sans-serif; font-weight: bold; color: var(--primary); font-size: 18px; letter-spacing: 2px; animation: blink 1.5s infinite; }
        @keyframes bounce-logo { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* ヘッダー */
        header { position: fixed; top: 0; left: 0; width: 100%; height: 70px; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(5px); display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 10px rgba(0,0,0,0.05); z-index: 1000; }
        .logo-img { height: 40px; width: auto; margin-left: 20px; object-fit: contain; cursor: pointer; transition: transform 0.1s; }
        .logo-img:active { transform: scale(0.9); }
        .header-right { display: flex; align-items: center; gap: 15px; margin-right: 20px; }
        .login-btn-header { font-family: 'Poppins', sans-serif; font-weight: bold; font-size: 14px; color: var(--primary); border: 2px solid var(--primary); padding: 5px 15px; border-radius: 20px; cursor: pointer; background: white; transition: all 0.2s; }
        .login-btn-header:hover { background: var(--primary); color: white; }
        .logged-in-user { font-weight: bold; color: var(--text-main); font-size: 14px; background: #e0f7ff; padding: 5px 15px; border-radius: 20px; }
        .menu-btn { width: 40px; height: 40px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; cursor: pointer; box-shadow: 0 4px 10px rgba(39, 198, 245, 0.4); }

        /* ▼▼▼ 追加：カラーチェンジボタンのスタイル ▼▼▼ */
        .theme-btn-container { 
            display: flex; 
            gap: 8px; 
            margin-right: 15px; 
            align-items: center; 
        }
        .theme-btn { 
            width: 32px; 
            height: 32px; 
            border-radius: 50%; 
            border: 2px solid white; 
            cursor: pointer; 
            background-size: cover; 
            background-position: center; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); 
            transition: transform 0.2s, border-color 0.2s; 
        }
        .theme-btn:hover { 
            transform: scale(1.2); 
            border-color: var(--primary); 
        }
        /* スマホ向け調整 */
        @media (max-width: 480px) {
            .theme-btn { width: 24px; height: 24px; }
            .theme-btn-container { gap: 5px; margin-right: 10px; }
        }

        /* ナビゲーション */
        .breadcrumb-nav { position: fixed; top: 70px; left: 0; width: 100%; padding: 10px 20px; background: rgba(255, 255, 255, 0.95); z-index: 900; display: none; align-items: center; font-size: 14px; font-family: 'Poppins', sans-serif; border-bottom: 1px solid #eee; box-sizing: border-box; }
        .bc-item { color: var(--text-sub); text-decoration: none; display: flex; align-items: center; font-weight: bold; transition: color 0.2s; } .bc-item:hover { color: var(--primary); } .bc-icon { font-size: 16px; margin-bottom: 2px; } .bc-sep { margin: 0 10px; color: #ccc; font-size: 10px; } .bc-current { color: var(--primary); font-weight: bold; }
        .side-menu { position: fixed; top: 0; right: -100%; width: 80%; max-width: 300px; height: 100%; background: white; z-index: 2000; transition: 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); box-shadow: -5px 0 20px rgba(0,0,0,0.1); display: flex; flex-direction: column; padding-top: 80px; } .side-menu.open { right: 0; }
        .menu-link { padding: 15px 30px; font-family: 'Poppins', sans-serif; font-size: 18px; color: var(--text-main); text-decoration: none; border-bottom: 1px solid #f0f0f0; display: block; }
        .menu-close { position: absolute; top: 20px; right: 20px; font-size: 30px; color: #ccc; cursor: pointer; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); z-index: 1500; opacity: 0; visibility: hidden; transition: 0.3s; } .overlay.open { opacity: 1; visibility: visible; }

        /* 共通コンポーネント */
        .hero-section { width: 100%; background-color: #e0f7ff; position: relative; margin-bottom: 40px; padding: 0; }.hero-logo-img { width: 100%; max-width: 1300px; height: auto; display: block; margin: 0 auto; filter: drop-shadow(0 5px 15px rgba(39, 198, 245, 0.3)); }
        .container { padding: 0 20px 40px; max-width: 1000px; margin: 0 auto; }
        .page-header { text-align: center; margin: 40px 0 60px; } .page-title-en { font-family: 'Oswald', sans-serif; font-size: 48px; color: var(--primary); letter-spacing: 2px; line-height: 1; margin-bottom: 10px; } .page-title-jp { font-size: 14px; color: var(--text-sub); font-weight: bold; letter-spacing: 1px; }
        .section-title { text-align: center; margin-bottom: 30px; margin-top: 40px; } .en-title { font-family: 'Poppins', sans-serif; font-size: 28px; font-weight: bold; color: var(--primary); letter-spacing: 2px; } .ja-title { display: block; font-size: 12px; color: var(--text-sub); margin-top: 5px; font-weight: bold; }
        .more-btn { background: transparent; border: 1px solid #ccc; padding: 10px 30px; border-radius: 30px; cursor: pointer; color: var(--text-main); font-family: 'Poppins', sans-serif; font-size: 14px; margin-top: 20px; transition: all 0.3s ease; outline: none; } .more-btn:hover { background: var(--primary); color: white; border-color: var(--primary); }

        /* おみくじ */
        .omikuji-area { text-align: center; margin-bottom: 60px; background: linear-gradient(135deg, #fff5f8 0%, #f0faff 100%); padding: 30px 20px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); border: 4px solid white; outline: 4px dashed #ff9a9e; position: relative; overflow: hidden; max-width: 600px; margin-left: auto; margin-right: auto; }
        .omikuji-area::before { content: ""; position: absolute; inset: 0; opacity: 0.1; background-image: radial-gradient(#ff9a9e 20%, transparent 20%), radial-gradient(#27C6F5 20%, transparent 20%); background-size: 30px 30px; background-position: 0 0, 15px 15px; pointer-events: none; }
        .omi-deco { position: absolute; font-size: 24px; animation: float-deco 3s ease-in-out infinite; z-index: 1; }
        .d-1 { top: 10px; left: 10px; color: #FFD700; animation-delay: 0s; } .d-2 { bottom: 10px; right: 10px; color: #27C6F5; animation-delay: 1.5s; font-size: 30px; }
        @keyframes float-deco { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-10px) rotate(20deg); } }
        .omi-visual-box { font-size: 60px; color: #ff4757; margin: 10px 0 20px; text-shadow: 0 5px 0 rgba(0,0,0,0.1); animation: omi-bounce 2s infinite; display: inline-block; }
        @keyframes omi-bounce { 0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-20px); } 60% { transform: translateY(-10px); } }
        .omi-title-ribbon { background: #ff4757; color: white; display: inline-block; padding: 5px 20px; border-radius: 20px; font-weight: bold; font-size: 14px; box-shadow: 0 4px 0 #cc1e2b; margin-bottom: 10px; position: relative; z-index: 2; }
        .omi-main-text { font-family: 'M PLUS Rounded 1c', sans-serif; font-weight: 900; font-size: 28px; color: #444; margin: 0 0 20px; letter-spacing: 2px; position: relative; z-index: 2; background: linear-gradient(to right, #ff4757, #ff9a9e); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .omikuji-btn { background: linear-gradient(to bottom, #FFD700, #FFA500); color: #fff; font-weight: 900; padding: 18px 50px; border-radius: 50px; border: 4px solid #fff; font-size: 22px; cursor: pointer; box-shadow: 0 8px 0 #d35400, 0 15px 20px rgba(0,0,0,0.2); transition: transform 0.1s, box-shadow 0.1s; font-family: 'M PLUS Rounded 1c', sans-serif; letter-spacing: 2px; position: relative; z-index: 5; text-shadow: 1px 1px 0 rgba(0,0,0,0.2); }
        .omikuji-btn:hover { transform: translateY(4px); box-shadow: 0 4px 0 #d35400, 0 8px 10px rgba(0,0,0,0.2); }
        .omikuji-btn:active { transform: translateY(8px); box-shadow: 0 0 0 #d35400, inset 0 2px 5px rgba(0,0,0,0.2); }
        .omikuji-btn::after { content: "FREE!"; position: absolute; top: -15px; right: -20px; background: #27C6F5; color: white; font-size: 12px; padding: 5px 10px; border-radius: 50%; transform: rotate(20deg); border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); animation: pulse-red 1s infinite; }
        
        /* おみくじアニメ・結果 */
        .omi-anim-container { position: relative; width: 100%; height: 300px; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .omi-box-container { position: relative; width: 140px; height: 200px; perspective: 1000px; z-index: 10; }
        .omi-box { width: 100%; height: 100%; background: linear-gradient(135deg, #FF512F, #DD2476, #FF512F); background-size: 200% 200%; border: 6px solid #fff; box-shadow: 0 15px 35px rgba(221, 36, 118, 0.6); color: white; font-weight: 900; display: flex; align-items: center; justify-content: center; font-size: 36px; writing-mode: vertical-rl; border-radius: 20px; position: relative; z-index: 5; text-shadow: 3px 3px 0 rgba(0,0,0,0.3); font-family: 'M PLUS Rounded 1c', sans-serif; animation: gradient-shift 3s ease infinite; }
        @keyframes gradient-shift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .omi-box.shaking { animation: omi-shake-crazy 0.25s infinite cubic-bezier(.36,.07,.19,.97) alternate; }
        @keyframes omi-shake-crazy { 0% { transform: translate(0, 0) rotate(0) scale(1); } 25% { transform: translate(-10px, 5px) rotate(-10deg) scale(1.05, 0.95); } 50% { transform: translate(0, -5px) rotate(0) scale(0.95, 1.05); } 75% { transform: translate(10px, 5px) rotate(10deg) scale(1.05, 0.95); } 100% { transform: translate(0, 0) rotate(0) scale(1); } }
        .omi-box.pre-burst { animation: pre-burst-pop 0.5s forwards cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        @keyframes pre-burst-pop { 0% { transform: scale(1); } 50% { transform: scale(0.8) translateY(20px); } 100% { transform: scale(1.3) translateY(-10px); } }
        .omi-slip { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 24px; height: 120px; background: #fff; border: 4px solid #DD2476; z-index: 2; transition: top 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); border-radius: 8px; box-shadow: 0 0 15px rgba(255, 255, 255, 1); }
        .omi-slip.coming-out { top: -70%; }
        .confetti { position: absolute; pointer-events: none; z-index: 1; opacity: 0; } .confetti i { font-size: 20px; }
        .burst .confetti { animation: confetti-explosion 1s ease-out forwards; }
        @keyframes confetti-explosion { 0% { opacity: 1; transform: translate(0, 0) scale(0.5) rotate(0deg); } 100% { opacity: 0; transform: translate(var(--tx), var(--ty)) scale(1.5) rotate(var(--r)); } }
        .shockwave { position: absolute; top: 50%; left: 50%; width: 10px; height: 10px; border-radius: 50%; background: rgba(255, 255, 255, 0.8); z-index: 0; opacity: 0; pointer-events: none; }
        .burst .shockwave { animation: shockwave-anim 0.6s ease-out forwards; }
        @keyframes shockwave-anim { 0% { opacity: 1; transform: translate(-50%, -50%) scale(1); } 100% { opacity: 0; transform: translate(-50%, -50%) scale(50); box-shadow: 0 0 50px rgba(255,255,255,0.5); } }
        #omikujiAnimModal.flash-effect::after { content: ""; position: absolute; inset: 0; background: white; z-index: 100; animation: flash-anim 0.5s ease-out forwards; pointer-events: none; }
        @keyframes flash-anim { 0% { opacity: 1; } 100% { opacity: 0; } }

        .omi-rank { font-size: 48px; font-weight: 900; color: #ff4757; margin-bottom: 10px; text-shadow: 2px 2px 0 rgba(0,0,0,0.1); font-family: 'M PLUS Rounded 1c', sans-serif; }
        .omi-msg { font-size: 16px; color: #555; margin-bottom: 20px; font-weight: bold; line-height: 1.5; }
        .omi-item { font-size: 14px; color: #fff; background: var(--primary); display: inline-block; padding: 8px 20px; border-radius: 20px; font-weight: bold; box-shadow: 0 5px 10px rgba(39, 198, 245, 0.3); }
        .omi-chara-img { width: 180px; height: 180px; border-radius: 50%; object-fit: cover; object-position: top center; border: 6px solid var(--primary); margin-bottom: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .omi-action-btns { margin-top: 25px; display: flex; justify-content: center; gap: 15px; }
        .sns-share-btn, .save-img-btn { border: none; padding: 10px 20px; border-radius: 30px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px; transition: transform 0.2s; color: white; font-family: 'Poppins', sans-serif; }
        .sns-share-btn { background: #000; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .save-img-btn { background: linear-gradient(135deg, #27C6F5, #2ecc71); box-shadow: 0 4px 10px rgba(39, 198, 245, 0.3); }
        .sns-share-btn:hover, .save-img-btn:hover { transform: translateY(-3px); }

        /* スクロールエリア */
        .scroll-wrapper { position: relative; display: flex; align-items: center; } .scroll-grid { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; gap: 15px; padding-bottom: 10px; scrollbar-width: none; flex-grow: 1; margin: 0 10px; } .scroll-grid::-webkit-scrollbar { display: none; } .scroll-btn { width: 30px; height: 30px; border-radius: 50%; background: rgba(255, 255, 255, 0.8); color: var(--primary); border: 1px solid #eee; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; cursor: pointer; z-index: 10; transition: all 0.2s; flex-shrink: 0; } .scroll-btn:hover { background: var(--primary); color: white; box-shadow: 0 4px 8px rgba(39, 198, 245, 0.3); } .scroll-btn.left { margin-right: -15px; } .scroll-btn.right { margin-left: -15px; }

        /* NOW ON AIR */
        #nowOnAirSection { display: none; margin-bottom: 60px; animation: fadeIn 0.5s ease; width: 100%; }
        .noa-title { text-align: center; font-family: 'Poppins', sans-serif; font-weight: 900; font-size: 32px; color: #ff0000; margin-bottom: 20px; letter-spacing: 2px; text-shadow: 0 2px 10px rgba(255,0,0,0.1); display: flex; align-items: center; justify-content: center; gap: 10px; }
        .noa-title::before, .noa-title::after { content: "●"; font-size: 14px; animation: pulse-red 1s infinite; }
        .live-hero-wrapper { width: 100%; max-width: 900px; margin: 0 auto; background: #000; border-radius: 16px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.2); position: relative; border: 4px solid #ff0000; }
        .live-iframe-box { position: relative; width: 100%; padding-top: 56.25%; /* 16:9 */ }
        .live-iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        .live-info-bar { padding: 15px; background: white; display: flex; align-items: center; gap: 15px; border-bottom: 2px solid #f0f0f0; }
        .live-info-icon { width: 50px; height: 50px; border-radius: 50%; border: 2px solid #ff0000; object-fit: cover; }
        .live-info-text { flex: 1; }
        .live-status-badge { background: #ff0000; color: white; font-weight: bold; font-size: 12px; padding: 2px 8px; border-radius: 4px; vertical-align: middle; margin-right: 5px; }
        .live-status-badge.upcoming { background: #FF9800; }
        .live-info-name { font-weight: bold; font-size: 14px; color: #555; }
        .live-info-title { font-weight: bold; font-size: 16px; color: #333; display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; }
        .sub-live-grid { display: flex; gap: 10px; overflow-x: auto; padding: 15px 0; max-width: 900px; margin: 0 auto; }
        .sub-live-card { min-width: 200px; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); cursor: pointer; transition: 0.2s; border: 2px solid transparent; }
        .sub-live-card:hover { border-color: #ff0000; transform: translateY(-3px); }
        .sub-live-thumb { width: 100%; height: 110px; object-fit: cover; }
        .sub-live-title { font-size: 12px; font-weight: bold; padding: 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        @keyframes pulse-red { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        /* 各種カード */
/* TOPページのカード（サムネ対応） */
        /* ↓ 160px から 280px に変更して大きくする！ */
        .schedule-card { 
            flex: 0 0 280px; /* ★ここ重要！NEWSと同じ幅にします */
            background: white; 
            border-radius: 8px; 
            overflow: hidden; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
            transition: transform 0.3s; 
            scroll-snap-align: start; 
            text-align: center; 
            border: 1px solid #eee; 
        } 
        .schedule-card:hover { transform: translateY(-3px); border-color: var(--primary); } 
        
        /* ↓ 画像の余白をなくして枠いっぱいに表示 */
        .sch-thumb-box { 
            background: linear-gradient(135deg, var(--primary), #89CFF0); 
            color: white; 
            padding: 0; /* ★余白なし */
            display: flex; 
            flex-direction: column; 
            justify-content: flex-end; 
            align-items: center; 
            aspect-ratio: 16 / 9; 
            position: relative; 
            overflow: hidden;
        }
 .sch-date-big { font-size: 16px; font-weight: bold; font-family: 'Poppins', sans-serif; } .sch-time-big { font-size: 12px; font-family: 'Poppins', sans-serif; background: rgba(0,0,0,0.2); padding: 2px 8px; border-radius: 10px; margin-top: 3px;} .sch-info { padding: 8px; } .sch-title { font-size: 10px; font-weight: bold; margin-bottom: 2px; color: var(--text-main); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.4; text-align: left; } .sch-badge-mini { font-size: 9px; color: var(--primary); border: 1px solid var(--primary); padding: 1px 4px; border-radius: 3px; display: inline-block; margin-bottom: 3px; }
        .video-card { flex: 0 0 200px; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: transform 0.3s; cursor: pointer; scroll-snap-align: start; } .video-card:hover { transform: translateY(-3px); } .video-thumb-box { position: relative; width: 100%; aspect-ratio: 16 / 9; overflow: hidden; } .video-thumb { width: 100%; height: 100%; object-fit: cover; } .play-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 24px; height: 24px; background: rgba(0,0,0,0.6); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; } .video-info { padding: 6px; } .video-title { font-size: 10px; font-weight: bold; margin-bottom: 2px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.3; } .video-date { font-size: 9px; color: #888; }
        .member-video-card { min-width: 250px; scroll-snap-align: start; cursor: pointer; position: relative; background:white; border-radius:12px; overflow:hidden; box-shadow:0 2px 5px rgba(0,0,0,0.05); border:1px solid #eee; } .mv-blur .news-img, .mv-blur .news-title { filter: blur(4px); } .mv-lock-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.4); z-index:10; display:flex; flex-direction:column; align-items:center; justify-content:center; color:white; } .mv-lock-icon { font-size:30px; margin-bottom:10px; } .mv-lock-text { font-family:'Oswald',sans-serif; font-weight:bold; letter-spacing:1px; }

        /* メンバーリスト */
        .member-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 0 auto; width: 100%; }
        .member-card-vertical { position: relative; aspect-ratio: 2 / 3; z-index: 1; border-radius: 8px; overflow: hidden; transition: transform 0.2s, box-shadow 0.2s; cursor: pointer; width: 100%; }
        .member-card-vertical::before { content: ""; position: absolute; inset: 0; background-image: var(--member-bg); background-size: cover; background-position: center; background-color: var(--member-color, #ccc); background-blend-mode: hard-light; z-index: -1; transition: transform 0.3s; }
        .member-img-wrapper { position: absolute; inset: 0; -webkit-mask-image: var(--member-bg); mask-image: var(--member-bg); -webkit-mask-size: cover; mask-size: cover; -webkit-mask-position: center; mask-position: center; }
        .member-img-tachie { position: absolute; left: 50%; transform: translateX(-50%); width: 300%; top: -20%; object-fit: contain; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .member-card-vertical:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 100; overflow: visible; }
        .member-card-vertical:hover::before { transform: scale(1.05); } .member-card-vertical:hover .member-img-wrapper { -webkit-mask-image: none; mask-image: none; } .member-card-vertical:hover .member-img-tachie { width: auto; height: 150%; max-width: none; top: auto; bottom: -10%; }

        /* メンバー詳細 */
        .member-bg-layer { position: fixed; top: 70px; left: 0; width: 50vw; height: calc(100vh - 70px); z-index: -1; background-repeat: no-repeat; background-position: center bottom; background-size: contain; opacity: 0.15; pointer-events: none; padding-bottom: 20px; box-sizing: border-box; }
        .profile-header-bg { background: linear-gradient(135deg, var(--m-color-light) 0%, rgba(255,255,255,0.85) 100%); padding-top: 40px; padding-bottom: 60px; position: relative; overflow: hidden; margin-top: 0; min-height: calc(100vh - 70px); }
        .profile-wrapper { display: flex; flex-direction: column; align-items: center; max-width: 1000px; margin: 0 auto; padding: 0 20px; } @media (min-width: 768px) { .profile-wrapper { flex-direction: row; align-items: flex-start; justify-content: space-between; } }
        .profile-visual { width: 100%; max-width: 400px; position: relative; margin-bottom: 30px; display: flex; justify-content: center; } .profile-tachie { width: 100%; height: auto; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.2)); animation: slideUpTachie 0.8s cubic-bezier(0.2, 0.8, 0.2, 1); } @keyframes slideUpTachie { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
        .profile-info { width: 100%; max-width: 550px; }
        .profile-en-name { font-family: 'Poppins', sans-serif; font-size: 40px; font-weight: 900; line-height: 1; color: var(--m-color); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 10px; opacity: 0; animation: fadeInRight 0.5s 0.2s forwards; }
        .profile-jp-name { font-size: 24px; font-weight: bold; color: #333; margin-bottom: 20px; opacity: 0; animation: fadeInRight 0.5s 0.3s forwards; }
        .profile-catch { font-size: 16px; color: #666; margin-bottom: 30px; font-weight: bold; border-left: 4px solid var(--m-color); padding-left: 15px; opacity: 0; animation: fadeInRight 0.5s 0.4s forwards; }
        .profile-data-list { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; opacity: 0; animation: fadeInRight 0.5s 0.5s forwards; }
        .p-data-item { background: rgba(255,255,255,0.7); padding: 10px; border-radius: 8px; border-bottom: 2px solid var(--m-color); } .p-label { font-size: 11px; color: #666; font-weight: bold; display: block; margin-bottom: 5px; } .p-value { font-size: 15px; font-weight: bold; color: #333; }
        .profile-bio { font-size: 15px; line-height: 1.8; color: #333; margin-bottom: 40px; white-space: pre-wrap; font-weight: 500; background: rgba(255,255,255,0.5); padding: 15px; border-radius: 10px; opacity: 0; animation: fadeInRight 0.5s 0.6s forwards; }
        .profile-actions { display: flex; gap: 15px; margin-bottom: 40px; opacity: 0; animation: fadeInUp 0.5s 0.7s forwards; flex-wrap: wrap; }
        .p-btn { flex: 1; padding: 15px; text-align: center; border-radius: 50px; text-decoration: none; font-weight: bold; font-family: 'Poppins', sans-serif; transition: transform 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; white-space: nowrap; cursor: pointer; } .p-btn:hover { transform: translateY(-3px); }
        .p-btn.yt { background: #ff0000; color: white; box-shadow: 0 5px 15px rgba(255,0,0,0.3); } .p-btn.tw { background: #6441a5; color: white; box-shadow: 0 5px 15px rgba(29, 161, 242, 0.3); } .p-btn.x { background: #000; color: white; box-shadow: 0 5px 15px rgba(0,0,0,0.3); } .p-btn.voice { background: #FF9800; color: white; box-shadow: 0 5px 15px rgba(255, 152, 0, 0.3); }
        .back-link { display: inline-block; margin-top: 20px; color: #888; text-decoration: none; font-size: 14px; font-weight: bold; cursor: pointer; } .back-link:hover { color: var(--primary); }
        @keyframes fadeInRight { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } } @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* ワンタップ・コピー */
        .copy-tag { cursor: pointer; position: relative; transition: all 0.2s; display: inline-flex; align-items: center; gap: 5px; }
        .copy-tag:hover { transform: scale(1.05); text-decoration: underline; }
        .copy-icon { font-size: 12px; color: #aaa; }
        #copyToast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 30px; font-size: 14px; font-weight: bold; display: none; z-index: 3000; animation: fadeInOut 2s ease forwards; }
        @keyframes fadeInOut { 0% { opacity:0; transform: translate(-50%, 20px); } 15% { opacity:1; transform: translate(-50%, 0); } 85% { opacity:1; transform: translate(-50%, 0); } 100% { opacity:0; transform: translate(-50%, -20px); } }

        /* ★隠しモード（フィーバー）★ */
        body.fever-mode { animation: rainbow-rush 0.5s infinite linear; }
        @keyframes rainbow-rush { 0% { filter: hue-rotate(0deg); } 100% { filter: hue-rotate(360deg); } }
        body.fever-mode::before { content: ""; position: fixed; inset: 0; z-index: 9998; background: radial-gradient(circle, rgba(255,255,255,0.5) 10%, transparent 20%); background-size: 50px 50px; animation: disco-lights 1s infinite alternate; pointer-events: none; }
        @keyframes disco-lights { from { background-position: 0 0; } to { background-position: 50px 50px; } }
        .fever-text { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 80px; font-weight: 900; color: white; text-shadow: 0 0 20px #FF00DE, 0 0 40px #FF00DE; z-index: 9999; pointer-events: none; animation: bounce-text 0.5s infinite alternate; font-family: 'Oswald', sans-serif; }
        @keyframes bounce-text { from { transform: translate(-50%, -50%) scale(1); } to { transform: translate(-50%, -50%) scale(1.2); } }

        /* デジタル会員証メーカー */
        .oshi-buttons { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px; }
        .oshi-btn { width: 55px; height: 55px; border-radius: 50%; border: 3px solid transparent; cursor: pointer; background-size: 200%; background-position: center 10%; transition: transform 0.2s; }
        .oshi-btn.selected { border-color: #333; transform: scale(1.1); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .card-maker-area { margin-top: 60px; padding-top: 40px; border-top: 1px dashed #ddd; }
        .maker-container { background: #fff; border-radius: 20px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); text-align: center; }
        .maker-controls label { display: block; font-size: 12px; font-weight: bold; color: var(--text-sub); margin-bottom: 5px; text-align: left; }
        .maker-controls input { width: 100%; padding: 10px; border: 2px solid #eee; border-radius: 8px; font-size: 16px; margin-bottom: 15px; box-sizing: border-box; font-family: 'M PLUS Rounded 1c', sans-serif; }
        .card-preview-wrapper { display: flex; justify-content: center; margin-bottom: 20px; perspective: 1000px; }
        .digital-card { width: 320px; height: 190px; border-radius: 12px; position: relative; overflow: hidden; color: white; text-align: left; font-family: 'Poppins', sans-serif; background: #000; border: 1px solid rgba(255, 255, 255, 0.3); transition: 0.3s; box-shadow: 0 0 15px var(--card-color), 0 10px 30px rgba(0,0,0,0.5); }
        .card-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; opacity: 0.8; background: radial-gradient(circle at 50% 30%, var(--card-color), #000 75%); }
        .card-shine { position: absolute; inset: 0; z-index: 2; pointer-events: none; mix-blend-mode: overlay; background: linear-gradient(115deg, transparent 20%, rgba(255,255,255,0.4) 25%, transparent 30%, transparent 70%, rgba(255,255,255,0.2) 75%, transparent 80%); }
        .digital-card::after { content: ""; position: absolute; inset: 0; z-index: 3; pointer-events: none; background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.2) 3px); }
        .card-content { position: relative; z-index: 10; padding: 20px; height: 100%; box-sizing: border-box; display: flex; flex-direction: column; justify-content: space-between; }
        .card-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.3); padding-bottom: 5px; }
        .card-logo { font-weight: bold; font-size: 14px; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .card-official { font-size: 8px; background: rgba(255,255,255,0.2); padding: 2px 6px; border-radius: 4px; }
        .card-value { font-size: 14px; font-weight: bold; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .card-value.number { font-family: monospace; font-size: 12px; }
        .card-value.name { font-size: 18px; font-family: 'M PLUS Rounded 1c', sans-serif; }
        .card-char-img { position: absolute; bottom: var(--char-bottom, -20px); right: var(--char-right, -50px); width: var(--char-width, 280px); height: auto; z-index: 5; mask-image: linear-gradient(to bottom, black 85%, transparent 100%); -webkit-mask-image: linear-gradient(to bottom, black 85%, transparent 100%); filter: drop-shadow(-5px 0 10px rgba(0,0,0,0.3)); pointer-events: none; }
        .download-btn { background: linear-gradient(90deg, #333, #555); color: white; border: none; padding: 12px 40px; border-radius: 30px; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

        /* ニュース */
        .news-category-bar { display: flex; justify-content: center; gap: 10px; margin-bottom: 30px; }
        .news-cat-btn { padding: 8px 20px; border-radius: 20px; background: #eee; font-size: 13px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .news-cat-btn.active, .news-cat-btn:hover { background: var(--primary); color: white; }
        .news-pickup { margin-bottom: 40px; position: relative; border-radius: 15px; overflow: hidden; aspect-ratio: 16/9; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .news-pickup-img { width: 100%; height: 100%; object-fit: cover; }
        .news-pickup-content { position: absolute; bottom: 0; left: 0; width: 100%; padding: 20px; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); color: white; box-sizing: border-box; }
        .news-pickup-badge { background: #ff4757; padding: 3px 10px; border-radius: 5px; font-size: 12px; font-weight: bold; margin-bottom: 5px; display: inline-block; }
        .news-pickup-title { font-size: 20px; font-weight: bold; }
        .news-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; padding-bottom: 20px; }
        .news-card { background: white; border-radius: 12px; overflow: hidden; border: 1px solid #eee; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; flex-direction: column; } .news-card:hover { border-color: var(--primary); box-shadow: 0 5px 15px rgba(39, 198, 245, 0.25); transform: translateY(-5px); } .scroll-grid .news-card { flex: 0 0 280px; margin-right: 0; height: 100%; } 

        /* ニュースのサムネイル画像エリア */
        .news-thumb-area {
            width: 100%;
            height: auto;         /* 高さを自動にする */
            aspect-ratio: 3 / 2;  /* ★比率を 1500x1000 (3:2) に固定！ */
            background-color: #f0f0f0;
            position: relative;
            overflow: hidden;
        } 

.news-img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s; } .news-card:hover .news-img { transform: scale(1.05); } .news-badge { position: absolute; top: 10px; left: 10px; background: var(--primary); color: white; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: bold; z-index: 2; box-shadow: 0 2px 5px rgba(0,0,0,0.2); } .news-content { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; } .news-date { font-size: 12px; color: #888; font-family: 'Poppins', sans-serif; margin-bottom: 5px; } .news-title { font-size: 14px; font-weight: bold; color: #333; line-height: 1.5; margin-bottom: 15px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; flex-grow: 1; } .news-check-btn { background: #eee; color: #666; text-align: center; padding: 8px; border-radius: 6px; font-weight: bold; font-family: 'Poppins', sans-serif; font-size: 12px; transition: all 0.3s; } .news-card:hover .news-check-btn { background: var(--primary); color: white; }

        /* ▼▼▼ 追加：ニュース詳細テキストエリアのデザイン ▼▼▼ */
        .news-detail-box {
            background: #fff;
            border: 2px solid #eee;
            border-radius: 15px;
            padding: 30px;
            margin-top: 20px;
            margin-bottom: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            font-size: 15px;
            line-height: 1.8;
            color: #444;
            white-space: pre-wrap; /* 改行を反映させる */
        }
        
        /* ニュース詳細の画像エリア（PICK UP） */
        /* PICK UP画像（トップの大きい画像） */
        .news-pickup {
            margin-top: 40px;
            
            /* 下の余白をなくして、下のテキストボックスにくっつける */
            margin-bottom: 0;  /* ← 修正！ */
            
            max-width: 800px;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
            
            max-height: none;
            aspect-ratio: 3 / 2;
            
            position: relative;
            /* 画像の下側の角丸をなくす（つながって見えるように） */
            border-radius: 15px 15px 0 0; /* ← 追加！上が15px、下は0 */
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            z-index: 2; /* 影がテキストボックスの上にくるように */
        }

        /* PICK UP画像の本体設定（修正版） */
        .news-pickup-img {
            width: 100%;
            height: 100%;       /* 親要素に合わせる */
            object-fit: cover;  /* 比率を維持して隙間なく表示 */
            object-position: center;
        }

        /* 詳細テキストエリア */
        .news-detail-box {
            background: #fff;
            border: 2px solid #eee;
            /* 上の境界線を消して、画像とつながっているように見せる */
            border-top: none; /* ← 追加！ */
            
            /* 上側の角丸をなくす */
            border-radius: 0 0 15px 15px; /* ← 修正！上が0、下は15px */
            
            padding: 30px;
            
            /* 上の余白をなくす */
            margin-top: 0;    /* ← 修正！ */
            
            margin-bottom: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            font-size: 15px;
            line-height: 1.8;
            color: #444;
            white-space: pre-wrap;
            
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            box-sizing: border-box;
            
            /* 画像の下に潜り込まないように少し調整 */
            position: relative;
            z-index: 1;
        }

        /* ▼▼▼ スケジュール（サムネ対応版） ▼▼▼ */
        .timeline-container { position: relative; padding: 20px 0; }
        .timeline-container::before { content: ''; position: absolute; top: 0; left: 24px; height: 100%; width: 2px; background: #eee; }
        .timeline-item { display: flex; margin-bottom: 25px; position: relative; }
        .tl-icon-box { width: 50px; display: flex; flex-direction: column; align-items: center; z-index: 1; }
        .tl-icon { width: 40px; height: 40px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-size: 18px; border: 4px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        /* ↓ 余白を減らしてスリムにします！ */
.tl-content { 
    flex: 1; 
    background: white; 
    
    padding: 8px; /* ★ここを小さくすると、カードがグッと細くなります！ */
    
    border-radius: 12px; 
    border: 1px solid #eee; 
    margin-left: 15px; 
    box-shadow: 0 2px 5px rgba(0,0,0,0.03); 
}
        .tl-date { font-family: 'Poppins', sans-serif; font-weight: bold; color: var(--primary); font-size: 14px; margin-bottom: 5px; }
        .tl-title { font-weight: bold; font-size: 15px; margin-bottom: 5px; }
        .tl-tag { font-size: 11px; background: #eee; padding: 2px 8px; border-radius: 4px; color: #666; }

        /* 個別ページのサムネイル */
        /* ▼ 個別ページのリスト表示をスタイリッシュにする設定 ▼ */

/* リストの中身（画像とテキストの横並び） */
.tl-body-box { 
    display: flex; 
    align-items: flex-start; /* 上揃えにする */
    gap: 15px; 
    margin-top: 10px;
}

/* ▼▼▼ 個別ページのリスト表示の修正 ▼▼▼ */

/* 3. サムネイル画像を16:9にする */
.tl-thumb-img {
    width: 160px;          /* 横幅を少し大きく */
    aspect-ratio: 16 / 9;  /* ★高さを固定せず、16:9の比率を指定！ */
    object-fit: cover;
    border-radius: 6px;
    flex-shrink: 0;
    border: 1px solid #eee;
    /* height: 80px; <-- この行は削除されます */
}

/* 2. タイトルの文字を大きくする */
.tl-title {
    font-size: 18px;       /* ★14pxや15pxから「18px」に拡大！ */
    font-weight: bold;
    line-height: 1.4;
    margin: 0;
}

/* 1. タグの位置調整用（余白をリセット） */
.tl-tag {
    font-size: 11px;
    background: #eee;
    padding: 3px 8px;
    border-radius: 4px;
    color: #666;
    margin: 0;             /* ★以前の margin-top などをリセット */
    display: inline-block;
    flex-shrink: 0;        /* 縮まないようにする */
}

/* 新しいヘッダー行のレイアウト調整 */
.tl-header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px; /* タイトルとの間隔 */
}

/* タグと日付を横並びにするエリア */
.tl-meta-left {
    display: flex;
    align-items: center;
    gap: 10px; /* タグと日付の間隔 */
}

/* 日付の調整 */
.tl-date {
    font-family: 'Poppins', sans-serif;
    font-weight: bold;
    color: var(--primary);
    font-size: 16px; /* 少し大きく */
    margin: 0;       /* 余白リセット */
}
/* 時間の調整 */
.tl-time {
    font-size: 14px;
    color: #888;
    margin-left: 5px;
}

        /* TOPページのカード（サムネ対応） */
        /* ↓ 160px の記述を見つけて、このコードに上書きしてください */
.schedule-card { 
    flex: 0 0 250px;  /* ★ニュース(280px)より少し小さく設定！ */
    background: white; 
    border-radius: 8px; 
    overflow: hidden; 
    box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
    transition: transform 0.3s; 
    scroll-snap-align: start; 
    text-align: center; 
    border: 1px solid #eee; 
} 
        .schedule-card:hover { transform: translateY(-3px); border-color: var(--primary); } 
        
        /* ↓ これをコピペして上書きしてください */
.sch-thumb-box { 
    background: linear-gradient(135deg, var(--primary), #89CFF0); 
    color: white; 
    padding: 0; /* ← パディングを0にする */
    display: flex; 
    flex-direction: column; 
    justify-content: flex-end; /* 文字を下側に寄せる */
    align-items: center; 
    aspect-ratio: 16 / 9; 
    position: relative; /* 画像を重ねるために必要 */
    overflow: hidden; 
}

/* ↓ ついでに、画像の設定も確認・強化しておきましょう */
.sch-bg-img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* 枠いっぱいにトリミングして表示 */
    position: absolute;
    top: 0;
    left: 0;
    z-index: 0;
}
        
        /* 画像がある場合 */
        .sch-bg-img {
            width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; z-index: 0;
        }
        /* 画像の上に載せる文字 */
        .sch-date-big, .sch-time-big { 
            position: relative; z-index: 2; /* 画像より手前 */
            font-family: 'Poppins', sans-serif; 
            text-shadow: 0 2px 5px rgba(0,0,0,0.8); /* 文字が見えるように影 */
        }
        .sch-date-big { font-size: 16px; font-weight: bold; margin-top: 10px; }
        .sch-time-big { font-size: 12px; margin-top: 3px; margin-bottom: 10px; }

        /* 画像がない場合のデフォルト背景（日付の位置調整） */
        .sch-thumb-box.no-img .sch-date-big, 
        .sch-thumb-box.no-img .sch-time-big {
            text-shadow: none;
        }
        .sch-thumb-box.no-img { padding: 10px 0; }

        .sch-info { padding: 8px; } 
        .sch-title { font-size: 10px; font-weight: bold; margin-bottom: 2px; color: var(--text-main); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.4; text-align: left; } 
        .sch-badge-mini { font-size: 9px; color: var(--primary); border: 1px solid var(--primary); padding: 1px 4px; border-radius: 3px; display: inline-block; margin-bottom: 3px; }

        /* ラジオ */
        .radio-theme-box { background: #333; color: white; padding: 20px; border-radius: 10px; border: 4px solid #8B4513; margin-bottom: 30px; position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .radio-theme-box::before { content: "今週のテーマ"; position: absolute; top: -15px; left: 20px; background: #f1c40f; color: #333; padding: 2px 10px; font-weight: bold; font-size: 12px; border-radius: 4px; transform: rotate(-2deg); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .radio-theme-text { font-size: 18px; font-weight: bold; text-align: center; font-family: 'M PLUS Rounded 1c', sans-serif; letter-spacing: 1px; }
        .letter-form { background: white; padding: 20px; border-radius: 15px; border: 2px solid #eee; box-shadow: 0 5px 15px rgba(0,0,0,0.03); }
        .form-label { display: block; font-weight: bold; font-size: 12px; margin-bottom: 5px; color: var(--text-sub); }
        .form-input, .form-select, .form-textarea { width: 100%; padding: 10px; border: 2px solid #eee; border-radius: 8px; font-family: inherit; margin-bottom: 15px; box-sizing: border-box; }
        .form-input:focus, .form-select:focus, .form-textarea:focus { border-color: var(--primary); outline: none; }
        .radio-btn { width: 100%; background: var(--primary); color: white; padding: 12px; border: none; border-radius: 30px; font-weight: bold; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 10px rgba(39, 198, 245, 0.3); }
        .radio-btn:hover { transform: translateY(-2px); }
        .diary-section { margin-top: 50px; }
        .diary-card { background: white; border-radius: 15px; padding: 15px; margin-bottom: 20px; border: 1px solid #eee; display: flex; gap: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); position: relative; }
        .diary-icon { width: 60px; height: 60px; border-radius: 50%; flex-shrink: 0; border: 2px solid #eee; background-size: 330%; background-position: top center; background-repeat: no-repeat; }
        .diary-content { flex: 1; }
        .diary-name { font-weight: bold; font-size: 13px; margin-bottom: 5px; color: var(--text-sub); }
        .diary-text { font-size: 14px; line-height: 1.6; background: #f9f9f9; padding: 10px; border-radius: 0 10px 10px 10px; display: inline-block; position: relative; }
        .diary-voice-player { margin-top: 10px; background: #eee; padding: 8px 15px; border-radius: 20px; display: flex; align-items: center; gap: 10px; cursor: pointer; width: fit-content; transition: 0.2s; }
        .diary-voice-player:hover { background: #ddd; }
        .diary-date { font-size: 10px; color: #aaa; text-align: right; margin-top: 5px; }

        /* いいねボタン */
        .floating-heart-btn { position: fixed; bottom: 30px; right: 20px; width: 60px; height: 60px; background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%); border-radius: 50%; box-shadow: 0 5px 15px rgba(255, 105, 180, 0.4); display: flex; align-items: center; justify-content: center; color: white; font-size: 28px; cursor: pointer; z-index: 999; transition: transform 0.1s; user-select: none; }
        .floating-heart-btn:active { transform: scale(0.9); }
        .like-badge { position: absolute; top: -15px; right: -5px; background: #ff4757; color: white; font-size: 10px; font-weight: bold; padding: 3px 8px; border-radius: 10px; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); min-width: 20px; text-align: center; transition: transform 0.1s; }
        .heart-particle { position: fixed; pointer-events: none; animation: floatUp 1.5s ease-out forwards; font-size: 20px; z-index: 1000; }
        @keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-150px) scale(1.5) rotate(20deg); opacity: 0; } }

        /* お問い合わせ */
        .contact-section { max-width: 800px; margin: 60px auto; background: #fff; border-radius: 20px; padding: 30px; border: 4px solid #eee; box-shadow: 0 10px 30px rgba(0,0,0,0.05); background-image: radial-gradient(#e0f7ff 20%, transparent 20%); background-size: 20px 20px; }
        .contact-title { text-align: center; font-size: 24px; font-weight: bold; color: var(--primary); margin-bottom: 20px; letter-spacing: 2px; font-family: 'Poppins', sans-serif; }
        .contact-form { background: white; padding: 20px; border-radius: 15px; border: 2px solid #eee; }
        .contact-btn { width: 100%; background: linear-gradient(135deg, var(--primary), #89CFF0); color: white; padding: 12px; border: none; border-radius: 30px; font-weight: bold; cursor: pointer; margin-top: 10px; box-shadow: 0 4px 10px rgba(39, 198, 245, 0.3); transition: transform 0.2s; }
        .contact-btn:hover { transform: translateY(-2px); }

        /* フッター */
        .sns-container { text-align: center; margin-bottom: 30px; } .sns-links { display: flex; justify-content: center; gap: 20px; margin-top: 20px; } .sns-btn { width: 50px; height: 50px; background: #111; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; text-decoration: none; transition: transform 0.2s, box-shadow 0.2s; } .sns-btn.youtube { background: #ff0000; } .sns-btn:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); } .sns-logo-img { width: 30px; height: 30px; object-fit: contain; filter: brightness(0) invert(1); }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s; } .modal.open { display: flex; opacity: 1; } 
        /* ▼▼▼ モーダルウィンドウの修正（ここを上書き！） ▼▼▼ */
        .modal-content {
            background: white;
            width: 90%;
            max-width: 400px;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            transform: translateY(20px);
            transition: transform 0.3s;
            text-align: center;

            /* ★追加：これを入れるとスクロールできるようになります！ */
            max-height: 80vh;  /* 画面の高さの80%までに制限 */
            overflow-y: auto;  /* 中身が溢れたらスクロールバーを出す */
        }

        /* ★追加：右上の×ボタンを押しやすく改良 */
        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 40px;       /* ボタンを大きく */
            height: 40px;
            background: #eee;  /* 背景色をつけて目立たせる */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #555;
            cursor: pointer;
            z-index: 100;      /* 一番手前に表示 */
        } 
.modal.open .modal-content { transform: translateY(0); } .modal-close-btn { position: absolute; top: 15px; right: 20px; font-size: 28px; color: #aaa; cursor: pointer; } .news-modal-content { max-width: 500px; text-align: left; } .news-modal-content .modal-title { font-size: 18px; font-weight: bold; margin: 15px 0; border-bottom: 2px solid #f0f0f0; padding-bottom: 15px; } .news-modal-content .modal-body { font-size: 15px; line-height: 1.8; color: #444; white-space: pre-wrap; }
        .auth-title { font-size: 20px; font-weight: bold; margin-bottom: 20px; color: var(--text-main); font-family: 'Poppins', sans-serif; } .auth-input { width: 100%; padding: 12px; margin-bottom: 15px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9; font-size: 16px; } .auth-input:focus { border-color: var(--primary); outline: none; background: white; } .auth-btn { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 25px; font-weight: bold; font-size: 16px; cursor: pointer; margin-top: 10px; box-shadow: 0 4px 10px rgba(39, 198, 245, 0.3); } .auth-btn:hover { background: var(--primary-dark); } .auth-link { margin-top: 20px; font-size: 14px; color: #888; } .auth-link a { color: var(--primary); text-decoration: none; font-weight: bold; cursor: pointer; } .auth-link a:hover { text-decoration: underline; } .social-login-area { margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px; } .social-login-label { font-size: 12px; color: #888; margin-bottom: 10px; } .social-login-btn { width: 100%; padding: 10px; border-radius: 25px; font-weight: bold; font-size: 14px; margin-bottom: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; border: 1px solid #ddd; background: white; transition: background 0.2s; } .social-login-btn:hover { background: #f5f5f5; }

        footer { background: linear-gradient(135deg, #27C6F5, #89CFF0); color: white; padding: 50px 20px 30px; margin-top: auto; }
        .footer-container { max-width: 1000px; margin: 0 auto; display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 30px; }
        .footer-left, .footer-right { flex: 1; min-width: 250px; }
        .footer-right { display: flex; flex-direction: column; align-items: flex-end; }
        .footer-menu { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 15px; }
        .footer-menu li a { color: white; text-decoration: none; font-family: 'Oswald', sans-serif; font-weight: 500; font-size: 36px; letter-spacing: 1px; transition: opacity 0.2s; display: flex; align-items: baseline; cursor: pointer; }
        .footer-menu-ja { font-family: 'M PLUS Rounded 1c', sans-serif; font-weight: 400; font-size: 14px; margin-left: 20px; opacity: 0.8; letter-spacing: 0.05em; } .footer-menu li a:hover { opacity: 0.7; }
        .footer-logo { height: 240px; width: auto; margin-bottom: 30px; }
        .footer-sns { display: flex; gap: 15px; }
        .footer-sns-btn { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.2); transition: transform 0.2s, background 0.2s; text-decoration: none; }
        .footer-sns-btn:hover { transform: translateY(-3px); background: rgba(255, 255, 255, 0.4); }
        .footer-sns-icon-img { width: 30px; height: 30px; object-fit: contain; filter: brightness(0) invert(1); }
        .copyright { text-align: center; font-size: 12px; margin-top: 50px; opacity: 0.8; font-family: 'Poppins', sans-serif; }
        @media (max-width: 768px) { .footer-container { flex-direction: column; align-items: center; text-align: center; } .footer-right { align-items: center; margin-top: 40px; } .footer-menu li a { justify-content: center; } .footer-logo { height: 150px; } }

        /* ガイドライン */
        .guideline-box { background: white; border-radius: 15px; padding: 30px; border: 2px solid #eee; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.03); }
        .g-section { margin-bottom: 40px; }
        .g-head { font-size: 20px; font-weight: 900; color: var(--primary); margin-bottom: 20px; border-bottom: 2px dashed #ddd; padding-bottom: 10px; display: flex; align-items: center; gap: 10px; font-family: 'M PLUS Rounded 1c', sans-serif; }
        .g-head i { font-size: 24px; color: #ff9f43; }
        .g-text { font-size: 14px; line-height: 1.8; color: #555; margin-bottom: 20px; }
        .g-list { list-style: none; padding: 0; margin: 0; background: #f9f9f9; border-radius: 10px; padding: 20px; }
        .g-list li { position: relative; padding-left: 25px; margin-bottom: 12px; font-size: 14px; line-height: 1.6; color: #444; font-weight: bold; }
        .g-list li:last-child { margin-bottom: 0; }
        .g-list li::before { content: "✔"; color: var(--primary); position: absolute; left: 5px; top: 0; font-weight: 900; font-size: 16px; }
        .g-list.ng-list { background: #fff5f5; }
        .g-list.ng-list li::before { content: "✖"; color: #ff4757; }
        .g-tag-box { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
        .g-tag { background: white; border: 1px solid #ddd; padding: 5px 15px; border-radius: 20px; font-size: 12px; color: #666; font-family: 'Poppins', sans-serif; font-weight: bold; display: flex; align-items: center; gap: 5px; }
        .g-tag i { color: var(--primary); }

        /* ボイス */
        .voice-section { width: 100%; margin-bottom: 30px; opacity: 0; animation: fadeInUp 0.5s 0.6s forwards; }
        .voice-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .voice-card { background: rgba(255,255,255,0.8); border: 2px solid var(--m-color); border-radius: 50px; padding: 10px 20px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; transition: 0.2s; position: relative; overflow: hidden; }
        .voice-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); background: white; }
        .voice-card.playing { background: var(--m-color); color: white; }
        .voice-card.playing .voice-icon { color: white; animation: pulse-voice 1s infinite; }
        .voice-card.playing .voice-title { color: white; }
        .voice-icon { font-size: 20px; color: var(--m-color); margin-right: 15px; width: 30px; text-align: center; }
        .voice-title { font-weight: bold; font-size: 14px; color: #555; flex: 1; }
        .voice-time { font-size: 12px; font-weight: bold; opacity: 0.6; }
        @keyframes pulse-voice { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
        
        /* 落書き */
        /* ↓↓↓ ここを修正（board-containerを書き換え） ↓↓↓ */
        .board-container { 
            background: #2b4a3c; 
            border: 10px solid #8B4513; 
            border-radius: 10px; 
            padding: 0; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.3); 
            margin-bottom: 30px; 
            position: relative; 
            
            /* 修正：中央揃えと幅の設定 */
            width: 100%;
            max-width: 100%; /* はみ出し防止 */
            margin-left: auto;
            margin-right: auto;
            box-sizing: border-box; /* 枠線を含めたサイズ計算にする */

            aspect-ratio: 3 / 4; /* スマホは縦長 */
            
            /* 修正：overflow:hiddenを削除し、バッジが見えるようにする */
            /* overflow: hidden;  <-- 削除 */
            z-index: 1; /* 重なり順を調整 */
        }

        /* PC用レイアウト */
        @media (min-width: 768px) {
            .board-container {
                aspect-ratio: 16 / 9; 
            }
        }

        /* ↓↓↓ バッジ（黄色い表示）の修正 ↓↓↓ */
        .board-container::before { 
            /* 修正：文字を変更 */
            content: "あおはる黒板"; 
            
            position: absolute; 
            top: -15px; 
            left: 50%; 
            transform: translateX(-50%); 
            background: #f1c40f; 
            color: #333; 
            padding: 4px 20px; /* 少し大きく */
            font-weight: bold; 
            border-radius: 4px; 
            font-size: 14px; 
            z-index: 20; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            white-space: nowrap; /* 折り返し防止 */
        }

        /* ↓↓↓ 追加：キャンバス自体に角丸をつける（overflowを外した代わり） ↓↓↓ */
        canvas#drawCanvas {
            border-radius: 4px; /* コンテナの内側に合わせる */
            /* ...既存の設定はそのまま... */
        }
        .paint-tools { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); width: 90%; box-sizing: border-box; z-index: 10; pointer-events: auto; }
        .color-btn { width: 30px; height: 30px; border-radius: 50%; border: 2px solid white; cursor: pointer; transition: transform 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
        .color-btn:hover, .color-btn.active { transform: scale(1.2); border-color: #f1c40f; }
        .tool-btn { padding: 5px 15px; border-radius: 20px; background: white; font-size: 12px; font-weight: bold; cursor: pointer; border: none; font-family: 'Poppins', sans-serif; }
        .tool-btn:hover { background: var(--primary); color: white; }
        .post-form-area { background: white; padding: 20px; border-radius: 15px; border: 2px solid #eee; margin-top: 20px; }
        .graffiti-card { flex: 0 0 220px; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 10px rgba(0,0,0,0.1); border: 1px solid #eee; display: flex; flex-direction: column; }
        .g-img-box { width: 100%; aspect-ratio: 4/3; background: #eee; border-bottom: 1px dashed #ccc; }
        .g-img { width: 100%; height: 100%; object-fit: contain; background: #2b4a3c; }
        .g-info { padding: 10px; }
        .g-title { font-weight: bold; font-size: 14px; margin-bottom: 5px; color: #333; }
        .g-author { font-size: 12px; color: #888; text-align: right; }
        
        #graffitiModal .modal-content { max-width: 800px; width: 95%; padding: 0; overflow: hidden; display: flex; flex-direction: column; max-height: 90vh; }
        .g-modal-body { display: flex; flex-direction: column; overflow-y: auto; }
        @media (min-width: 768px) { .g-modal-body { flex-direction: row; } }
        .g-modal-img-area { flex: 2; background: #333; display: flex; align-items: center; justify-content: center; padding: 20px; position: relative; }
        .g-modal-img { max-width: 100%; max-height: 500px; object-fit: contain; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .g-modal-like-btn { position: absolute; bottom: 20px; right: 20px; background: rgba(255,255,255,0.9); border-radius: 30px; padding: 8px 20px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: transform 0.2s; color: #ff4757; font-size: 18px; }
        .g-modal-like-btn:active { transform: scale(0.9); }
        .g-modal-info-area { flex: 1; background: white; display: flex; flex-direction: column; border-left: 1px solid #eee; }
        .g-modal-header { padding: 20px; border-bottom: 1px solid #eee; }
        .g-modal-title { font-size: 18px; font-weight: 900; margin-bottom: 5px; }
        .g-modal-author { font-size: 12px; color: #888; display: flex; align-items: center; gap: 5px; }
        .g-comment-list { flex: 1; padding: 15px; overflow-y: auto; background: #f9f9f9; min-height: 200px; }
        .g-comment-item { display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-start; }
        /* 修正後 */
        .g-cmt-icon {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #ddd;
            flex-shrink: 0;
            object-fit: cover;
            /* ↓↓↓ この1行を追加してください！ ↓↓↓ */
            object-position: top center; 
            /* ↑↑↑ 画像の上の方を基準に表示する設定 ↑↑↑ */
            border: 1px solid #ccc;
        }
        .g-cmt-body { background: white; padding: 8px 12px; border-radius: 0 12px 12px 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.03); font-size: 13px; position: relative; }
        .g-cmt-name { font-weight: bold; font-size: 11px; color: #888; margin-bottom: 2px; }
        .g-comment-item.is-member .g-cmt-icon { border: 2px solid #f1c40f; box-shadow: 0 0 10px rgba(241, 196, 15, 0.5); }
        .g-comment-item.is-member .g-cmt-body { background: #fffbf0; border: 1px solid #f1c40f; }
        .g-comment-item.is-member .g-cmt-name { color: #f1c40f; }
        .g-comment-item.is-member .g-cmt-name::after { content: "★OFFICIAL"; background: #f1c40f; color: white; font-size: 9px; padding: 1px 4px; border-radius: 4px; margin-left: 5px; }
        .g-comment-form { padding: 15px; border-top: 1px solid #eee; display: flex; gap: 10px; background: white; }
        .g-cmt-input { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ddd; font-size: 12px; outline: none; }
        .g-cmt-btn { background: var(--primary); color: white; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .delete-btn { position: absolute; top: 10px; right: 10px; background: #ff4757; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; cursor: pointer; z-index: 10; box-shadow: 0 2px 5px rgba(0,0,0,0.3); border: 2px solid white; }
        .delete-btn:hover { transform: scale(1.1); }
        
        /* ★マイページ用スタイル */
        .mypage-header { 
            /* ↓↓↓ ここを書き換え ↓↓↓ */
            background-image: url('mypage_bg.png'); /* 画像のファイル名を指定 */
            background-size: cover;                  /* 枠いっぱいに画像を表示 */
            background-position: center;             /* 画像の真ん中を表示 */
            /* ↑↑↑ ここまで ↑↑↑ */

            padding: 40px 20px; 
            text-align: center; 
            color: white; 
            border-radius: 0 0 30px 30px; 
            margin-bottom: 30px; 
            
            /* 読みやすいように文字に少し影をつけるとお洒落です（お好みで） */
            text-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        .mypage-icon { width: 100px; height: 100px; border-radius: 50%; border: 4px solid white; background: #eee; object-fit: cover; margin-bottom: 10px; cursor: pointer; }
        .mypage-name { font-size: 24px; font-weight: 900; margin-bottom: 5px; }
        .mypage-id { font-size: 12px; opacity: 0.8; font-family: monospace; }
        .mypage-form { max-width: 600px; margin: 0 auto; padding: 20px; }
        .edit-label { font-size: 12px; font-weight: bold; color: #888; margin-bottom: 5px; display: block; }
        .edit-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; background: #f9f9f9; box-sizing: border-box; }
        .edit-textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; background: #f9f9f9; box-sizing: border-box; resize: none; height: 100px; }
        .save-btn { width: 100%; background: #2ecc71; color: white; padding: 15px; border: none; border-radius: 30px; font-weight: bold; font-size: 16px; cursor: pointer; box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3); transition: transform 0.2s; }
        .save-btn:hover { transform: translateY(-2px); }
        .logout-btn { display: block; text-align: center; margin-top: 30px; color: #ff4757; font-weight: bold; cursor: pointer; text-decoration: underline; }

        /* ▼▼▼ 隠し要素（ホラーモード）のスタイル ▼▼▼ */
        
        /* 懐中電灯のオーバーレイ（普段は隠す） */
        .flashlight-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999; /* どの要素よりも手前に */
            pointer-events: none; /* クリックは通過させる（下の要素を触れるように） */
            
            /* 初期状態：真っ暗 */
            background: rgba(0, 0, 0, 1);
            opacity: 0;
            transition: opacity 2s ease; /* ふわっと現れる */
            display: none;
        }

        /* 懐中電灯オンの状態（カーソルの周りだけ透明にするグラデーション） */
        .flashlight-layer.active {
            display: block;
            opacity: 1;
            /* ここが技術の核！マウス位置(var(--x), var(--y))を中心に穴を開ける */
            background: radial-gradient(
                circle 150px at var(--cursor-x, 50%) var(--cursor-y, 50%), 
                transparent 0%, 
                rgba(0, 0, 0, 0.98) 100%
            );
        }

        /* ▼▼▼ ここから追加：薄暗さと雨のエフェクト ▼▼▼ */

        /* 1. 全体を薄暗くするフィルター */
        .darkness-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6); /* 黒色の半透明（0.6で60%の暗さ） */
            z-index: 1; /* 背景より手前 */
            pointer-events: none; /* クリックを邪魔しない */
        }

        /* 2. 雨のアニメーション（共通設定） */
        .rain-layer {
            position: fixed;
            top: -100%; /* 上から降ってくるように見せるため開始位置をずらす */
            left: 0;
            width: 100%;
            height: 200%; /* ループさせるために高さを倍に */
            z-index: 2; /* 暗さよりさらに手前 */
            pointer-events: none;
            /* 雨粒の模様（細い透明～白のグラデーション線） */
            background-image: linear-gradient(to bottom, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 10%, rgba(255,255,255,0) 20%);
            background-repeat: repeat-x;
        }

        /* 雨レイヤー1（手前・大きくて速い雨） */
        .rain-layer.layer1 {
            background-size: 2px 200px; /* 雨粒の太さと長さ */
            animation: rain-fall 0.8s linear infinite; /* 0.8秒で落下 */
            opacity: 0.8;
        }

        /* 雨レイヤー2（奥・少し小さくて遅い雨） */
        .rain-layer.layer2 {
            background-size: 1px 150px; /* 少し細くて短い */
            background-position: 50% 0; /* 位置を少しずらす */
            animation: rain-fall 1.2s linear infinite; /* 1.2秒で落下 */
            opacity: 0.4;
        }

        /* 落下アニメーションの定義 */
        @keyframes rain-fall {
            from { transform: translateY(0); }
            to { transform: translateY(50%); } /* 画面の高さ半分だけ移動してループ */
        }

        /* 旧校舎の背景演出 */
        .secret-bg-img {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            /* ↓↓↓ ここをファイル名に変更！ */
            background-image: url('old_school.jpg'); 
            background-size: cover;
            background-position: center;
            opacity: 1.0; /* ← 画像が見えやすいように少し明るくしました（お好みで調整OK） */
            z-index: 0;
            pointer-events: none;
        }

        /* ▼▼▼ 秘密の門のデザイン ▼▼▼ */
        /* 門（左右のパネル）のラッパー */
        .gate-wrapper {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            
            /* ▼▼▼ ここを修正！(5000 -> 30000) ▼▼▼ */
            z-index: 30000; 
            /* ▲▲▲ これで看板が暗闇より手前に表示されます ▲▲▲ */
            
            display: flex; justify-content: center; align-items: center;
            pointer-events: none;
        }
        
        /* 門（左右のパネル） */
        .gate-door {
            position: absolute; top: 0; width: 50%; height: 100%;
            background: repeating-linear-gradient(45deg, #111, #111 10px, #220000 10px, #220000 20px); /* 錆びた鉄のような柄 */
            border: 2px solid #000;
            transition: transform 3s cubic-bezier(0.5, 0, 0, 1); /* ゆっくり開く */
        }
        .gate-door.left { left: 0; border-right: 5px solid #000; }
        .gate-door.right { right: 0; border-left: 5px solid #000; }

        /* 門が開く時のクラス */
        .gate-wrapper.open .gate-door.left { transform: translateX(-100%); }
        .gate-wrapper.open .gate-door.right { transform: translateX(100%); }

        /* 真ん中の警告看板とボタン */
        .gate-content {
            z-index: 5001; text-align: center; pointer-events: auto; /* ここだけクリック可能 */
        }
        .warning-sign {
            font-size: 40px; color: #ff0000; font-weight: bold; border: 5px solid #ff0000;
            padding: 20px; background: rgba(0,0,0,0.8); transform: rotate(-5deg);
            margin-bottom: 50px; text-shadow: 0 0 10px red;
        }
        .enter-message {
            font-size: 24px; color: #fff; cursor: pointer; text-decoration: underline;
            animation: blink 1s infinite;
        }
        /* ▼▼▼ 追加：門が開いたら、看板と文字を消す設定 ▼▼▼ */
        .gate-wrapper.open .gate-content {
            opacity: 0;
            pointer-events: none; /* 消えた後はクリックできないようにする */
            transition: opacity 1s ease; /* 1秒かけてフワッと消す */
        }

        /* ▼▼▼ ギミック用スタイル ▼▼▼ */
        .horror-item { position: absolute; cursor: pointer; z-index: 10; transition: transform 0.2s; }
        
        /* 画像自体の設定 */
        .horror-item img {
            width: 100%; height: auto; 
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5));
        }
        
        .horror-item:hover { transform: scale(1.1); filter: brightness(1.2); }
        
        /* 1. ノートのサイズと角度 */
        .horror-item.note { width: 80px; transform: rotate(-10deg); }

        /* 2. ラジカセのサイズ */
        .horror-item.radio { width: 100px; }
        .horror-item.radio.playing { animation: shake-radio 0.1s infinite; }
        @keyframes shake-radio { 0% { transform:translate(1px, 1px) rotate(0deg); } 100% { transform:translate(-1px, -2px) rotate(-1deg); } }

        /* 4. 血文字 */
        .blood-text { font-family: 'Times New Roman', serif; font-size: 40px; color: #880000; opacity: 0; transition: opacity 3s; text-shadow: 2px 2px 5px #000; font-weight: 900; pointer-events: none; user-select: none; white-space: nowrap; writing-mode: vertical-rl; }
        .horror-item.blood-wall:hover .blood-text { opacity: 1; }

        /* 3. ドッキリ画像 */
        .scream-overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; z-index: 12000; background: black; }

        /* ★★★ 修正箇所：ノートの表示デザイン（ここを上書き！） ★★★ */
        .note-overlay { 
            display: none; /* 初期状態は非表示 */
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.8); 
            z-index: 20000; 
            
            /* ↓↓↓ ここが重要！画面中央に配置する魔法の呪文 ↓↓↓ */
            align-items: center; 
            justify-content: center; 
        }

        /* JavaScriptで display:block にされた時も flex に強制する */
        .note-overlay[style*="display: flex"] {
            display: flex !important;
        }

        .note-paper { 
            background: #fdf5e6; /* クリーム色の紙 */
            padding: 40px; 
            width: 80%; 
            max-width: 500px; 
            min-height: 300px; 
            
            /* ↓↓↓ 文字の色とフォント ↓↓↓ */
            color: #333333 !important; /* 強制的に黒（こげ茶）にする */
            font-family: 'Times New Roman', serif; 
            font-weight: bold; 
            font-size: 18px;
            line-height: 2; 
            
            /* その他の装飾 */
            border-radius: 2px; 
            box-shadow: 0 0 20px #000; 
            position: relative; 
            text-align: left; 
        }
        
        /* 紙の左側の赤い線（ノートっぽさ） */
        .note-paper::before { 
            content:""; 
            position:absolute; 
            top:0; 
            left:30px; 
            bottom:0; 
            width:2px; 
            background:rgba(255,0,0,0.3); 
        }

        /* ▼▼▼ 追加：テレビ風ホラーノイズのスタイル ▼▼▼ */

        /* ノイズ画面の基本設定 */
        .tv-noise-layer {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 20000;
            pointer-events: none;
            opacity: 0;
            /* 画像を使わず、計算式で「砂嵐」を描画します（エラー回避！） */
            background-image: repeating-radial-gradient(circle, #000 0 0.0001%, #fff 0 0.0002%);
            background-size: 100% 100%;
            mix-blend-mode: exclusion; 
        }

        /* ノイズが表示された時の状態 */
        .tv-noise-layer.active {
            opacity: 0.8; /* 少し透けさせて後ろを見せる */
            /* 画面全体を激しく歪ませるアニメーション */
            animation: noise-glitch 0.2s infinite linear alternate-reverse;
        }

        /* 走査線（テレビの横線）のエフェクト */
        .tv-noise-layer::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            /* 細かい横縞模様を作る */
            background: repeating-linear-gradient(
                to bottom,
                transparent 0%,
                rgba(0, 0, 0, 0.3) 50%,
                transparent 100%
            );
            background-size: 100% 3px; /* 線の太さ */
            pointer-events: none;
        }

        /* 画面が歪んでチラつくアニメーション */
        @keyframes noise-glitch {
            0% {
                transform: translateX(0) skewX(0deg) scale(1);
                filter: hue-rotate(0deg) contrast(1.2);
            }
            25% {
                transform: translateX(-5px) skewX(3deg) scale(1.02);
                filter: hue-rotate(10deg) contrast(1.5); /* 色が少しずれる */
            }
            50% {
                transform: translateX(3px) skewX(-2deg) scale(0.98);
                opacity: 0.5; /* 一瞬暗くなる */
            }
            75% {
                transform: translateX(-2px) skewX(1deg) scale(1.01);
                filter: hue-rotate(-10deg) contrast(1.3);
            }
            100% {
                transform: translateX(0) skewX(0deg) scale(1);
            }
        }

        /* ▼▼▼ 追加：激ヤバ・テレビ風ホラーノイズ（画像不要版） ▼▼▼ */
        .tv-noise-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 20000;
            pointer-events: none;
            opacity: 0;
            /* 画像を使わず、計算式で「砂嵐」を描画します（これでエラー消滅！） */
            background-image: repeating-radial-gradient(circle, #000 0 0.0001%, #fff 0 0.0002%);
            background-size: 100% 100%;
            mix-blend-mode: exclusion; 
        }

        /* ノイズ発動時のアニメーション */
        .tv-noise-layer.active {
            opacity: 0.9; /* ほぼ真っ白になるくらい濃く */
            animation: super-glitch 0.1s infinite linear alternate-reverse;
        }

        /* 走査線（テレビの横線） */
        .tv-noise-layer::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-linear-gradient(to bottom, transparent 0%, rgba(0, 0, 0, 0.8) 50%, transparent 100%);
            background-size: 100% 4px;
            animation: scanline 5s linear infinite;
        }

        /* トラウマ級の激しい動き */
        @keyframes super-glitch {
            0% { transform: translate(0, 0) scale(1); filter: hue-rotate(0deg) invert(0); }
            20% { transform: translate(-10px, 5px) skewX(20deg) scale(1.1); filter: hue-rotate(90deg) invert(1); }
            40% { transform: translate(10px, -10px) skewX(-20deg); opacity: 0.5; }
            60% { transform: translate(-5px, 10px) scale(1.2) scaleX(1.5); filter: contrast(5); }
            80% { transform: translate(5px, -5px) skewY(10deg); background-position: 10px 10px; }
            100% { transform: translate(0, 0) scale(1); }
        }
        @keyframes scanline {
            0% { background-position: 0 0; }
            100% { background-position: 0 100%; }
        }
        .cursed-input-area {
            position: absolute; z-index: 100; text-align: center; width: 300px;
        }
        .cursed-label {
            color: #550000; font-family: 'Serif', serif; font-weight: bold; font-size: 14px;
            margin-bottom: 5px; text-shadow: 0 0 5px #000; opacity: 0.7;
        }
        .cursed-input {
            width: 100%; background: rgba(0, 0, 0, 0.5); border: none;
            border-bottom: 2px solid #880000; color: #ff0000; font-size: 20px;
            padding: 10px; font-family: 'Times New Roman', serif; outline: none;
            text-align: center; transition: 0.3s;
        }
        .cursed-input::placeholder { color: #550000; }
        .cursed-input:focus {
            background: rgba(50, 0, 0, 0.6); border-bottom: 2px solid #ff0000;
            box-shadow: 0 0 15px #ff0000;
        }
        /* 画面が赤くなる演出 */
        .red-flash { animation: flash-red 0.2s 3; }
        @keyframes flash-red {
            0%, 100% { background-color: transparent; }
            50% { background-color: rgba(255, 0, 0, 0.3); }
        }
        /* ▼▼▼ 追加：入力欄を震わせるアニメーション ▼▼▼ */
        .shaking {
            animation: shake-hard 0.1s infinite;
        }
        @keyframes shake-hard {
            0% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(-5px, 5px) rotate(-5deg); }
            50% { transform: translate(0, -5px) rotate(0deg); }
            75% { transform: translate(5px, 5px) rotate(5deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        /* ▼▼▼ 【追加2】ここに追加！スキンビューワーのデザイン ▼▼▼ */
        .skin-viewer-container {
            width: 100%; max-width: 400px; height: 400px; margin: 0 auto 20px;
            background: linear-gradient(to bottom, #87CEEB, #E0F7FA); /* 空色のグラデーション */
            background-size: cover; background-position: center;
            border-radius: 20px; border: 4px solid #fff;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5), 0 10px 20px rgba(0,0,0,0.2);
            position: relative; overflow: hidden;
        }
        canvas#skin_container { width: 100% !important; height: 100% !important; outline: none; }
        .skin-controls { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 30px; }
        .skin-btn {
            background: white; border: 1px solid #ddd; padding: 8px 15px;
            border-radius: 20px; font-size: 12px; font-weight: bold; cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: 0.2s;
        }
        .skin-btn:hover, .skin-btn.active { background: var(--primary); color: white; }
        .skin-member-select { display: flex; gap: 10px; overflow-x: auto; padding: 10px; margin-bottom: 20px; justify-content: center; }
        /* ▼▼▼ アイコンの設定（書き換え） ▼▼▼ */
        .skin-member-icon {
            width: 60px;              /* アイコン自体の大きさ */
            height: 60px;
            border-radius: 50%;       /* 丸くする */
            border: 3px solid #eee;   /* 枠線 */
            cursor: pointer;
            transition: 0.2s;
            
            /* ↓↓↓ ここが魔法のズーム設定！ ↓↓↓ */
            background-size: 220%;    /* 画像を2.2倍にズーム！（数字を変えれば調節可能） */
            background-position: top center; /* 上の方（顔）を中心に表示 */
            background-repeat: no-repeat;
            background-color: #ffffff; /* 画像がない時の背景色 */
        }

        /* 選択された時の動き */
        .skin-member-icon.selected {
            border-color: var(--primary);
            transform: scale(1.1);
        }
        /* ▼▼▼ AOHARU STUDIO (公式風デザイン) ▼▼▼ */
        .studio-stage {
            position: relative; width: 100%; aspect-ratio: 16 / 9;
            background: #2d3436; border-radius: 20px; overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.4); border: 4px solid #fff;
        }
        .studio-bg {
            position: absolute; inset: 0; background-size: cover; background-position: center;
            background-color: #ff9a9e; transition: 0.3s;
        }
        .studio-watermark {
            position: absolute; bottom: 15px; right: 15px; width: 120px; opacity: 0.9; z-index: 50; pointer-events: none;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        /* キャラクター配置エリア */
        .studio-actors {
            position: absolute; inset: 0; z-index: 10; pointer-events: none;
        }
        
        /* キャラクターボックス */
        .actor-box {
            position: absolute;
            height: 90%; width: auto; aspect-ratio: 140 / 300;
            bottom: 5%;
            transition: transform 0.1s;
            pointer-events: auto; /* ここは触れる */
            display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
        }
        
        /* 3Dキャンバス（ここを掴むと回転する） */
        .actor-box canvas { 
            width: 100% !important; height: 100% !important; 
            outline: none; cursor: col-resize; /* 回転できそうなカーソル */
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3));
        }

        /* ★新機能：移動用のハンドル（ここを掴むと移動する） */
        .move-handle {
            width: 100%; height: 24px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 12px;
            color: white; font-size: 10px; font-weight: bold;
            display: flex; align-items: center; justify-content: center;
            cursor: move; /* 移動カーソル */
            opacity: 0; transition: 0.2s;
            margin-top: -10px; z-index: 100;
            backdrop-filter: blur(4px);
        }
        .actor-box:hover .move-handle, .actor-box.selected .move-handle { opacity: 1; }
        .move-handle i { margin-right: 4px; }

        /* 選択リング */
        .actor-select-ring {
            position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%);
            width: 80%; height: 15px; border-radius: 50%;
            background: radial-gradient(rgba(255, 255, 0, 0.6), transparent 70%);
            opacity: 0; transition: 0.2s; pointer-events: none;
            box-shadow: 0 0 15px #f1c40f;
        }
        .actor-box.selected .actor-select-ring { opacity: 1; }

        /* 操作パネル（リッチデザイン） */
        .studio-controls {
            background: #fff; color: #333; padding: 25px; border-radius: 20px; margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); border: 1px solid #eee;
        }
        .control-header {
            font-weight: 900; margin-bottom: 20px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;
            display: flex; justify-content: space-between; align-items: center;
            font-family: 'Poppins', sans-serif; letter-spacing: 1px; color: #555;
        }
        .target-badge {
            background: #e1b12c; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; margin-left: 10px;
        }
        .reset-select-btn {
            font-size: 11px; background: #eee; color: #666; border: none; padding: 6px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; transition:0.2s;
        }
        .reset-select-btn:hover { background: #ddd; }

        .control-group { margin-bottom: 25px; }
        .c-label { 
            font-size: 13px; font-weight: 900; color: #888; margin-bottom: 12px; 
            display: flex; align-items: center; gap: 8px; font-family: 'Poppins', sans-serif;
        }
        .c-label i { color: var(--primary); font-size: 16px; }

        /* 公式っぽいボタンデザイン */
        .pose-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; }
        .c-btn {
            background: white; color: #555; 
            border: 2px solid #f0f0f0;
            padding: 10px 5px; border-radius: 12px; cursor: pointer;
            font-size: 11px; font-weight: bold; transition: all 0.2s;
            display: flex; flex-direction: column; align-items: center; gap: 5px;
        }
        .c-btn i { font-size: 18px; color: #ccc; transition: 0.2s; }
        .c-btn:hover { border-color: var(--primary); color: var(--primary); transform: translateY(-3px); box-shadow: 0 5px 15px rgba(39, 198, 245, 0.15); }
        .c-btn:hover i { color: var(--primary); }
        .c-btn:active { transform: translateY(0); }

        .c-btn.main { 
            width: 100%; background: linear-gradient(135deg, var(--primary), #89CFF0); 
            color: white; border: none; padding: 15px; font-size: 14px; letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(39, 198, 245, 0.4);
            flex-direction: row; justify-content: center;
        }
        .c-btn.main i { color: white; }
        .c-btn.main:hover { opacity: 0.9; transform: translateY(-2px); }

        /* 背景ボタン */
        .bg-selector { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; }
        .bg-btn {
            flex: 0 0 50px; height: 50px; border-radius: 12px; cursor: pointer;
            border: 3px solid transparent; background-size: cover; background-position: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: 0.2s;
        }
        .bg-btn:hover { transform: scale(1.1); border-color: var(--primary); }
        
        /* 自由配置モブ */
        .free-mob-box {
            position: absolute; width: 100px; height: 200px; z-index: 50;
            display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
            transition: transform 0.1s;
        }
        .free-mob-box:active { z-index: 100; }
        .mob-delete-btn {
            position: absolute; top: 0; right: 0;
            width: 24px; height: 24px; background: #ff4757; color: white;
            border-radius: 50%; text-align: center; line-height: 24px;
            font-size: 14px; font-weight: bold; cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            opacity: 0; transition: 0.2s;
        }
        .free-mob-box:hover .mob-delete-btn { opacity: 1; }
        @media (max-width: 768px) {
            .studio-watermark { width: 60px; bottom: 5px; right: 5px; }
            .actor-box { height: 75%; } /* スマホは少し小さく */
            .c-btn { font-size: 10px; }
        }
            /* ついでに操作パネルの文字も少し小さくして見やすく */
            .c-btn {
                font-size: 10px;
                padding: 6px 10px;
            }
        }
        /* ニュースページの詳細表示エリア */
        .news-detail-box {
            background: #fff;
            border: 2px solid #eee;
            border-radius: 15px;
            padding: 30px;
            margin-top: 20px;
            margin-bottom: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            font-size: 15px;
            line-height: 1.8;
            color: #444;
            white-space: pre-wrap; /* 改行を反映させる */
        }
        /* NEWSページトップ画像のサイズ調整 */
        .news-pickup-img {
            object-position: center 20%; /* 顔などが映りやすい位置に */
        }
        /* 閉じるボタンのデザイン */
        .pickup-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 35px;
            height: 35px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border-radius: 50%;
            display: none; /* 最初は隠しておく */
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            z-index: 100;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        /* ▼▼▼ 追加：ダークモード（ゲーミング/サイバー）の設定 ▼▼▼ */
        body.dark-mode {
            /* サイバーパンク風の配色に上書き */
            --bg-color: #050510;       /* 超濃い紺色（ほぼ黒） */
            --text-main: #e0f7ff;      /* 発光するような白水色 */
            --text-sub: #8899a6;       /* くすんだ青グレー */
            --light-bg: #1a1a2e;       /* カード背景用の暗い色 */
            --primary: #00f3ff;        /* ネオンシアン */
        }

        /* ダークモード時のカードの見た目 */
        body.dark-mode .news-card,
        body.dark-mode .schedule-card,
        body.dark-mode .member-card-vertical,
        body.dark-mode .radio-theme-box,
        body.dark-mode .letter-form,
        body.dark-mode .guideline-box,
        body.dark-mode .maker-container,
        body.dark-mode .contact-form,
        body.dark-mode .diary-card {
            background: #16213e;       /* 暗いネイビー */
            border-color: #0f3460;     /* 枠線も暗く */
            color: #e0f7ff;            /* 文字色 */
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.1); /* ほんのり光らせる */
        }

        /* ダークモード時のヘッダー */
        body.dark-mode header,
        body.dark-mode .breadcrumb-nav {
            background: rgba(5, 5, 16, 0.9); /* 黒っぽく透過 */
            border-bottom: 1px solid #0f3460;
        }
        
        /* ダークモード切替スイッチのデザイン */
        .theme-switch-btn {
            cursor: pointer;
            font-size: 20px;
            margin-right: 15px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }
        /* ダークモードONの時のスイッチ */
        body.dark-mode .theme-switch-btn {
            background: #0f3460;
            color: #ffeb3b; /* 月の色（黄色） */
            box-shadow: 0 0 10px #ffeb3b; /* 発光 */
        }

        /* ▼▼▼ 追加：マウスストーカー（キラキラパーティクル） ▼▼▼ */
        .mouse-particle {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 9999;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, #fff, transparent); /* 光る点 */
            border-radius: 50%;
            transform: translate(-50%, -50%); /* 中心に合わせる */
            animation: particle-fade 1s forwards; /* 1秒で消える */
        }
        /* 星の形にするバリエーション */
        .mouse-particle.star {
            background: none;
            width: 15px;
            height: 15px;
            color: #FFD700; /* 金色 */
            font-size: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .mouse-particle.star::before {
            content: "✦"; /* キラキラ記号 */
        }

        @keyframes particle-fade {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, 20px) scale(0.5); } /* 下に落ちながら消える */
        }
    </style>
</head>
<body>
    <div id="loadingScreen">
        <img src="logo.png" class="loading-logo" alt="Loading...">
        <div class="loading-text">LOADING...</div>
    </div>

    <div id="bgShapes" class="bg-shape-container"></div>

    <header>
        <img src="logo.png" alt="AOHARU FRIENDS" class="logo-img" onclick="showPage('top')" id="headerLogo">
        <div class="header-right">
            <div id="themeColorButtons" class="theme-btn-container"></div>
            
            <div class="theme-switch-btn" onclick="toggleDarkMode()" title="昼/夜 切り替え">
                <i class="fas fa-sun" id="themeIcon"></i>
            </div>

            <div id="headerLoginBtn" class="login-btn-header" onclick="openLoginModal()">LOGIN</div>
            <div class="menu-btn" onclick="toggleMenu()"><span style="margin-top:-2px;">☰</span></div>
        </div>
    </header>

    <div id="breadcrumbNav" class="breadcrumb-nav"></div>
    <div id="liveContainer" class="live-container"></div>
    
    <div id="sideMenu" class="side-menu">
        <div class="menu-close" onclick="toggleMenu()">×</div>
        <a href="javascript:void(0)" class="menu-link" onclick="showPage('top')">TOP</a>
        <a href="javascript:void(0)" class="menu-link" onclick="showPage('news')">NEWS</a>
        <a href="javascript:void(0)" class="menu-link" onclick="showPage('member')">MEMBER</a>
        <a href="javascript:void(0)" class="menu-link" onclick="showPage('schedule')">SCHEDULE</a>
        <a href="javascript:void(0)" class="menu-link" onclick="showPage('goods')">GOODS</a>
        <a href="javascript:void(0)" class="menu-link" onclick="showPage('radio')">RADIO</a>
        <a href="javascript:void(0)" class="menu-link" onclick="showPage('guideline')">GUIDELINE</a> 
        <a href="javascript:void(0)" class="menu-link" onclick="showPage('rakugaki')">GRAFFITI</a>
        <a href="javascript:void(0)" class="menu-link" onclick="showPage('studio')">STUDIO</a>
        <a href="javascript:void(0)" class="menu-link" onclick="openLoginModal(); toggleMenu();" style="color:var(--primary);">LOGIN</a>
    </div>
    <div id="overlay" class="overlay" onclick="toggleMenu()"></div>

    <div id="copyToast">コピーしました✨</div>

    <div id="scheduleModal" class="modal" onclick="closeScheduleModal()">
        <div class="modal-content news-modal-content" onclick="event.stopPropagation()">
            <span class="modal-close-btn" onclick="closeScheduleModal()">×</span>
            
            <img id="schModalImg" src="" style="width:100%; aspect-ratio:16/9; object-fit:cover; border-radius:8px; margin-bottom:15px; display:none;">
            
            <div>
                <span id="schModalDate" class="modal-date" style="font-size:16px; color:#27C6F5; font-weight:bold;"></span>
                <span class="modal-tag" style="background:#27C6F5;">配信</span>
            </div>
            
            <div id="schModalTitle" class="modal-title" style="font-size:20px; margin-top:10px;"></div>

            <div style="margin-top: 30px; text-align: center;">
                <button onclick="closeScheduleModal()" class="contact-btn" style="background:#888; width:auto; padding:10px 40px;">閉じる</button>
            </div>
        </div>
    </div>

<div id="newsModal" class="modal" onclick="closeNewsModal()">
        <div class="modal-content news-modal-content" onclick="event.stopPropagation()">
            <span class="modal-close-btn" onclick="closeNewsModal()">×</span>
            <img id="modalImg" src="" style="width:100%; border-radius:8px; display:none;">
            <div>
                <span id="modalDate" style="color:#888;"></span> 
                <span id="modalTag" class="news-badge" style="position:static;"></span>
            </div>
            <div id="modalTitle" style="font-size:18px; font-weight:bold; margin:10px 0;"></div>
            <div id="modalBody" style="text-align:left; font-size:14px; line-height:1.6;"></div>
            <button onclick="closeNewsModal()" class="more-btn" style="margin-top:20px; width:auto;">閉じる</button>
        </div>
    </div>

    <div id="goodsModal" class="modal" onclick="closeGoodsModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close-btn" onclick="closeGoodsModal()">×</span>
            <img id="goodsModalImg" src="">
            <div id="goodsModalTitle"></div>
            <div id="goodsModalPrice"></div>
            <div id="goodsModalDesc"></div>
            <a href="#" id="goodsModalLink" class="buy-btn" target="_blank">販売ページへ</a>
        </div>
    </div>

    <div id="loginModal" class="modal" onclick="closeLoginModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close-btn" onclick="closeLoginModal()">×</span>
            <div class="auth-title">LOGIN</div>
            <input type="text" id="loginEmail" class="auth-input" placeholder="メールアドレス">
            <input type="password" id="loginPass" class="auth-input" placeholder="パスワード">
            <button class="auth-btn" id="loginBtn" onclick="loginUser()">ログインする</button>
            
            <div style="text-align:right; margin-top:10px; font-size:12px;">
                <a href="javascript:void(0)" onclick="openForgotModal()" style="color:#888;">パスワードを忘れた方はこちら</a>
            </div>
            <div class="auth-link">はじめての方はこちら<br><a onclick="switchToRegister()">▶ 新規会員登録（無料）</a></div>
        </div>
    </div>

    <div id="forgotModal" class="modal" onclick="closeForgotModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close-btn" onclick="closeForgotModal()">×</span>
            <div class="auth-title">PASSWORD RECOVERY</div>
            <p style="font-size:12px; color:#888; margin-bottom:15px;">登録したメールアドレスを入力してください。<br>パスワードをメールでお知らせします。</p>
            
            <input type="email" id="forgotEmail" class="auth-input" placeholder="メールアドレス">
            <button class="auth-btn" id="forgotBtn" onclick="sendForgotRequest()">送信する</button>
            
            <div class="auth-link">
                <a onclick="closeForgotModal(); openLoginModal();">▶ ログインに戻る</a>
            </div>
        </div>
    </div>

    <div id="registerModal" class="modal" onclick="closeRegisterModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close-btn" onclick="closeRegisterModal()">×</span>
            <div class="auth-title">REGISTER</div>
            <p style="font-size:12px; color:#888; margin-bottom:15px;">あおはる⭐︎フレンズの会員になって<br>限定コンテンツを楽しもう！</p>
            <input type="text" id="regName" class="auth-input" placeholder="ニックネーム">
            <input type="email" id="regEmail" class="auth-input" placeholder="メールアドレス">
            <input type="password" id="regPass" class="auth-input" placeholder="パスワード">
            <button class="auth-btn" id="regBtn" onclick="registerUser()">会員登録する</button>
            <div class="auth-link">すでにアカウントをお持ちの方<br><a onclick="switchToLogin()">▶ ログインはこちら</a></div>
        </div>
    </div>

    <div id="mypage" class="page">
        <div class="mypage-header">
            <img src="icon.png" id="myIconDisplay" class="mypage-icon" onclick="document.getElementById('myIconInput').focus()">
            <div id="myNameDisplay" class="mypage-name">GUEST</div>
            <div id="myIdDisplay" class="mypage-id">ID: ----</div>
        </div>

        <div class="container mypage-form">
            <div class="section-title" style="margin-top:0;"><span class="ja-title">プロフィール編集</span></div>

            <label class="edit-label">ニックネーム</label>
            <input type="text" id="myNameInput" class="edit-input">

            <label class="edit-label">アイコン画像URL</label>
            <input type="text" id="myIconInput" class="edit-input" placeholder="https://... (画像のURLを貼り付け)" oninput="document.getElementById('myIconDisplay').src = this.value || 'icon.png'">
            <p style="font-size:10px; color:#aaa; margin-top:-10px; margin-bottom:15px;">※画像のアドレス(URL)を貼ってください。</p>

            <label class="edit-label">自己紹介</label>
            <textarea id="myBioInput" class="edit-textarea" placeholder="よろしくお願いします！"></textarea>

            <label class="edit-label"><i class="fab fa-x-twitter"></i> X (旧Twitter) リンク</label>
            <input type="text" id="myXInput" class="edit-input" placeholder="https://x.com/username">

            <label class="edit-label"><i class="fab fa-youtube"></i> YouTube / 配信 リンク</label>
            <input type="text" id="myYtInput" class="edit-input" placeholder="https://youtube.com/@channel">

            <button class="save-btn" onclick="saveProfile()">変更を保存する</button>

            <div class="logout-btn" onclick="logoutUser()">ログアウト</div>
        </div>
    </div> 

    <div id="userProfileModal" class="modal" onclick="closeUserProfileModal()">
        <div class="modal-content" onclick="event.stopPropagation()" style="max-width:350px; padding:0; overflow:hidden; border-radius:20px;">
            <div style="background: linear-gradient(135deg, var(--primary), #89CFF0); padding: 30px 20px 50px; text-align: center; position:relative;">
                <span class="modal-close-btn" onclick="closeUserProfileModal()" style="color:white; text-shadow:0 0 5px rgba(0,0,0,0.3);">×</span>
                <div style="font-family:'Oswald',sans-serif; color:rgba(255,255,255,0.3); font-size:40px; position:absolute; top:10px; left:0; width:100%; pointer-events:none;">PROFILE</div>
            </div>
            
            <div style="margin-top:-40px; text-align:center; padding:0 20px 20px;">
                <img id="upIcon" src="icon.png" style="width:80px; height:80px; border-radius:50%; border:4px solid white; background:white; object-fit:cover; box-shadow:0 5px 15px rgba(0,0,0,0.1);">
                <div id="upName" style="font-size:20px; font-weight:900; margin-top:5px; color:#333;">Name</div>
                <span id="upBadge" style="display:none; background:#f1c40f; color:white; font-size:10px; padding:2px 8px; border-radius:10px; font-weight:bold;">OFFICIAL</span>
            </div>

            <div style="padding:0 25px 30px; text-align:left;">
                <div style="font-size:12px; font-weight:bold; color:#888; margin-bottom:5px;">BIO</div>
                <div id="upBio" style="font-size:14px; line-height:1.6; color:#555; background:#f9f9f9; padding:10px; border-radius:10px; min-height:50px; white-space: pre-wrap;">...</div>
                
                <div style="margin-top:20px; display:flex; flex-direction:column; gap:10px;">
                    <a id="upLinkX" href="#" target="_blank" style="display:none; align-items:center; gap:10px; background:#000; color:white; padding:10px; border-radius:30px; text-decoration:none; font-weight:bold; font-size:12px; justify-content:center;">
                        <i class="fab fa-x-twitter"></i> X (Twitter)
                    </a>
                    <a id="upLinkYt" href="#" target="_blank" style="display:none; align-items:center; gap:10px; background:#ff0000; color:white; padding:10px; border-radius:30px; text-decoration:none; font-weight:bold; font-size:12px; justify-content:center;">
                        <i class="fab fa-youtube"></i> YouTube / 配信
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div id="top" class="page active">
            <div class="hero-section">
                <img src="top_logo.png" alt="AOHARU FRIENDS MAIN VISUAL" class="hero-logo-img">
            </div>
            <div class="container">
                <div id="nowOnAirSection">
                    <div class="noa-title">NOW ON AIR</div>
                    <div id="heroLiveArea"></div>
                    <div id="subLiveGrid" class="sub-live-grid"></div>
                </div>

                <div class="section-title" style="margin-top: 0;">
                    <div class="en-title">NEWS</div><span class="ja-title">最新情報</span>
                </div>
                <div class="scroll-wrapper">
                    <button class="scroll-btn left" onclick="scrollContent('topNewsList', 'left')">◀</button>
                    <div class="scroll-grid" id="topNewsList">読み込み中...</div>
                    <button class="scroll-btn right" onclick="scrollContent('topNewsList', 'right')">▶</button>
                </div>
                <div style="text-align:center;">
                    <button onclick="showPage('news')" class="more-btn">MORE VIEW</button>
                </div>


                <div class="section-title">
                    <div class="en-title">SCHEDULE</div><span class="ja-title">配信スケジュール</span>
                </div>
                <div class="scroll-wrapper">
                    <button class="scroll-btn left" onclick="scrollContent('topScheduleList', 'left')">◀</button>
                    <div class="scroll-grid" id="topScheduleList">読み込み中...</div>
                    <button class="scroll-btn right" onclick="scrollContent('topScheduleList', 'right')">▶</button>
                </div>
                <div style="text-align:center;">
                    <button onclick="showPage('schedule')" class="more-btn">MORE VIEW</button>
                </div>


                <div id="memberVideoSection" class="section-title">
                    <div class="en-title">MEMBER ONLY</div><span class="ja-title">会員限定動画※会員登録しないと視聴できません</span>
                </div>
                <div class="scroll-wrapper">
                    <button class="scroll-btn left" onclick="scrollContent('memberVideoList', 'left')">◀</button>
                    <div class="scroll-grid" id="memberVideoList">読み込み中...</div>
                    <button class="scroll-btn right" onclick="scrollContent('memberVideoList', 'right')">▶</button>
                </div>

            <div style="text-align:center;"><button onclick="showPage('schedule')" class="more-btn">MORE VIEW</button></div>

            <div class="section-title"><div class="en-title">MEMBER</div><span class="ja-title">メンバー</span></div>
            <div class="member-grid" id="topMemberList"></div>
            <div style="text-align:center;"><button onclick="showPage('member')" class="more-btn">MORE VIEW</button></div>

            <div class="section-title"><div class="en-title">VIDEOS</div><span class="ja-title">最新動画</span></div>
            <div class="scroll-wrapper">
                <button class="scroll-btn left" onclick="scrollContent('topVideoList', 'left')">◀</button>
                <div class="scroll-grid" id="topVideoList">読み込み中...</div>
                <button class="scroll-btn right" onclick="scrollContent('topVideoList', 'right')">▶</button>
            </div>
            <div style="text-align:center;"><button class="more-btn" onclick="window.open('https://youtube.com', '_blank')">CHANNEL</button></div>

            <div class="sns-container" style="margin-top: 50px;">
                <div class="section-title"><div class="en-title" style="letter-spacing: 5px;">OFFICIAL SNS</div><span class="ja-title">あおはる⭐︎フレンズ公式SNS</span></div>
                <div class="sns-links">
                    <a href="#" id="groupTwitterLink" target="_blank" class="sns-btn"><img src="icon_x.png" alt="X" class="sns-logo-img"></a>
                    <a href="#" id="groupYoutubeLink" target="_blank" class="sns-btn youtube"><img src="icon_youtube.png" alt="YouTube" class="sns-logo-img"></a>
                </div>
            </div>

            <div class="contact-section">
                <div class="contact-title"><i class="fas fa-envelope"></i> CONTACT</div>
                <div class="contact-form">
                    <label class="form-label">お名前</label>
                    <input type="text" class="form-input" id="contactName" placeholder="あおはる 太郎">
                    
                    <label class="form-label">メールアドレス</label>
                    <input type="email" class="form-input" id="contactEmail" placeholder="example@aoharu.com">
                    
                    <label class="form-label">お問い合わせ種別</label>
                    <select class="form-select" id="contactType">
                        <option value="ご意見・ご感想">ご意見・ご感想</option>
                        <option value="お仕事の依頼">お仕事の依頼</option>
                        <option value="不具合報告">不具合報告</option>
                        <option value="その他">その他</option>
                    </select>

                    <label class="form-label">メッセージ</label>
                    <textarea class="form-textarea" id="contactMsg" rows="5" placeholder="お問い合わせ内容を入力してください"></textarea>

                    <button class="contact-btn" onclick="sendContact()">送信する</button>
                </div>
            </div>

        </div>
    </div>

    <div id="news" class="page">
        <div class="page-header">
            <div class="page-title-en">NEWS</div>
            <div class="page-title-jp">最新ニュース</div>
        </div>
        <div class="container">
            <div class="news-category-bar" style="flex-wrap:wrap;"> <div class="news-cat-btn active">ALL</div>
                <div class="news-cat-btn">INFO</div>
                <div class="news-cat-btn">VIDEO</div>
                <div class="news-cat-btn">GOODS</div>
                <div class="news-cat-btn">MUSIC</div>
                <div class="news-cat-btn">MEMBER</div>
                </div>
            
            <div class="news-pickup" id="newsDetailAnchor" style="scroll-margin-top: 100px;">
                <div id="pickupCloseBtn" class="pickup-close-btn" onclick="resetPickupNews()">×</div>

                <img id="pickupImg" src="https://placehold.co/800x450/27C6F5/ffffff?text=PICK+UP+NEWS" class="news-pickup-img">
                <div class="news-pickup-content">
                    <div id="pickupBadge" class="news-pickup-badge" style="display:none;">CHECK!</div>
                    <div id="pickupTitle" class="news-pickup-title"></div>
                </div>
            </div>

            <div class="news-detail-box" id="pickupTextBox">
                <div id="pickupDetail" style="text-align:center; color:#888;">
                    ▼ 下のリストからニュースをクリックすると、ここに詳細が表示されます ▼
                </div>
            </div>

            <div class="section-title" style="margin-top: 40px; margin-bottom: 20px;">
                <span class="ja-title">記事一覧</span>
            </div>

            <div class="news-list" id="fullNewsList">読み込み中...</div>

            <div style="text-align:center; margin-top:30px;">
                <button onclick="showPage('top')" class="more-btn">TOPへ戻る</button>
            </div>
        </div>
    </div>

    <div id="member" class="page">
        <div class="page-header">
            <div class="page-title-en">MEMBER</div>
            <div class="page-title-jp">メンバー紹介</div>
        </div>
        <div class="container">
            <div style="text-align:center; margin-bottom:40px; font-size:14px; color:#666;">
                <p>個性豊かな4人が集まったVTuberグループ。<br>ゲーム実況、歌ってみた、雑談など様々なジャンルで活動中！</p>
            </div>
            <div class="member-grid" id="memberGrid"></div>

            <div class="card-maker-area">
                <div class="section-title">
                    <div class="en-title" style="color:#ff4757;">DIGITAL CARD</div>
                    <span class="ja-title">推しメン会員証を作ろう！</span>
                </div>
                <div class="maker-container">
                    <div class="maker-controls">
                        <label>ニックネームを入力</label>
                        <input type="text" id="cardNameInput" placeholder="あおはる 太郎" maxlength="10" oninput="updateCard()">
                        <label>推しメンを選択</label>
                        <div class="oshi-buttons" id="oshiButtons"></div>
                    </div>
                    <div class="card-preview-wrapper">
                        <div id="digitalCard" class="digital-card">
                            <div class="card-bg"></div>
                            <div class="card-shine"></div>
                            <div class="card-content">
                                <div class="card-header">
                                    <span class="card-logo">AOHARU FRIENDS</span>
                                    <span class="card-official">OFFICIAL MEMBER</span>
                                </div>
                                <div class="card-body">
                                    <div style="margin-bottom:4px;"><span class="card-label">No.</span><span class="card-value number" id="cardNo">0000</span></div>
                                    <div style="margin-bottom:4px;"><span class="card-label">NAME</span><span class="card-value name" id="cardNameDisplay">GUEST</span></div>
                                    <div><span class="card-label">OSHI-MEN</span><span class="card-value" id="cardOshiDisplay">-----</span></div>
                                </div>
                                <div class="card-footer"><span id="cardDate">DATE: 2026.01.01</span></div>
                            </div>
                            <img src="" id="cardCharImg" class="card-char-img">
                        </div>
                    </div>
                    <button class="download-btn" onclick="downloadCard()">画像を保存する</button>
                </div>
            </div>
        </div>
    </div>

    <div id="memberDetail" class="page" style="padding:0; min-height: 100vh;"></div>

    <div id="schedule" class="page">
        <div class="page-header">
            <div class="page-title-en">SCHEDULE</div>
            <div class="page-title-jp">配信スケジュール</div>
        </div>
        <div class="container">
            <div class="timeline-container" id="scheduleList">
                </div>
        </div>
    </div>

    <div id="goods" class="page">
        <div class="page-header">
            <div class="page-title-en">GOODS</div>
            <div class="page-title-jp">公式グッズ</div>
        </div>
        <div class="container">
            <div class="goods-hero">
                <h3>NEW ARRIVAL</h3>
                <p>新作グッズが登場！今すぐチェック！</p>
            </div>
            <div class="section-title"><span class="ja-title" style="margin:0;">商品一覧</span></div>
            <div class="goods-grid" id="goodsList"></div>
        </div>
    </div>

    <div id="radio" class="page">
        <div class="page-header">
            <div class="page-title-en" style="color:#ff9f43;">RADIO</div>
            <div class="page-title-jp">お便り＆アフタートーク</div>
        </div>
        <div class="container">
            <div class="radio-theme-box">
                <div class="radio-theme-text" id="radioThemeDisplay">読み込み中...</div>
                <div style="text-align:center; font-size:12px; margin-top:5px; color:#ccc;" id="radioThemeNote"></div>
            </div>

            <div class="letter-form">
                <div class="section-title" style="margin-top:0;"><span class="ja-title">お便りを送る</span></div>
                <label class="form-label">ラジオネーム（必須）</label>
                <input type="text" class="form-input" id="radioName" placeholder="あおはる 太郎">
                
                <label class="form-label">コーナー選択</label>
                <select class="form-select" id="radioCorner">
                    <option value="ふつおた">ふつおた（普通のお便り）</option>
                    <option value="テーマメール">今週のテーマ</option>
                    <option value="無茶振り">メンバーへの無茶振り</option>
                    <option value="お悩み相談">お悩み相談室</option>
                </select>

                <label class="form-label">メッセージ</label>
                <textarea class="form-textarea" id="radioMessage" rows="5" placeholder="ここにメッセージを書いてね！"></textarea>

                <button class="radio-btn" onclick="submitRadio()">送信する</button>
            </div>

            <div class="diary-section">
                <div class="section-title"><span class="ja-title">放送後記＆裏話</span></div>
                <div id="radioDiaryList"></div>
            </div>
        </div>
    </div>

    <div id="guideline" class="page">
        <div class="page-header">
            <div class="page-title-en" style="color:#2ecc71;">GUIDELINE</div>
            <div class="page-title-jp">二次創作・切り抜きガイドライン</div>
        </div>
        <div class="container">
            <div class="guideline-box">
                <div class="g-text">
                    「あおはる⭐︎フレンズ」（以下、当グループ）を応援いただきありがとうございます。<br>
                    ファンの皆様に安心して推し活を楽しんでいただくため、二次創作や動画の切り抜きに関するガイドラインを制定いたしました。<br>
                    以下のルールを守って、楽しく活動していただければ幸いです！
                </div>

                <div class="g-section">
                    <div class="g-head"><i class="fas fa-palette"></i> 二次創作（イラスト・同人活動）について</div>
                    <div class="g-text">
                        メンバーを描いたイラスト（ファンアート）や、同人誌等の制作は歓迎しております！<br>
                        SNSに投稿する際は、ぜひ専用ハッシュタグをつけて投稿してください。メンバーが活動に使用させていただく場合があります（サムネイル、配信背景など）。
                    </div>
                    <ul class="g-list">
                        <li>非営利目的での個人活動（SNS投稿、Pixiv、無償配布など）は自由です。</li>
                        <li>同人誌やグッズの頒布については、過度な営利目的でなければOKです。</li>
                        <li>R-18（成人向け）作品については、専用のハッシュタグを使用し、未成年の目に触れないようゾーニングの配慮をお願いします。</li>
                        <li>AI生成画像については、「AI生成」であることを明記してください。</li>
                    </ul>
                    <div class="g-tag-box">
                        <div class="g-tag"><i class="fas fa-hashtag"></i> #あおはるArt</div>
                        <div class="g-tag"><i class="fas fa-hashtag"></i> #あおはるR (R-18)</div>
                    </div>
                </div>

                <div class="g-section">
                    <div class="g-head"><i class="fas fa-video"></i> 切り抜き動画について</div>
                    <div class="g-text">
                        YouTube配信の切り抜き動画（クリップ）の制作・投稿は大歓迎です！<br>
                        面白いシーンや感動的なシーンをぜひ拡散してください。
                    </div>
                    <ul class="g-list">
                        <li>動画の概要欄に、必ず「元動画のURL」と「チャンネルへのリンク」を記載してください。</li>
                        <li>歌枠（歌ってみた配信）の切り抜きは、楽曲の著作権の関係上、原則禁止とさせていただきます（一部例外あり）。</li>
                        <li>悪意のある編集（発言の捏造、誤解を招くタイトルなど）は禁止です。</li>
                        <li>YouTubeショート、TikTokへの投稿も歓迎です！</li>
                    </ul>
                    <div class="g-tag-box">
                        <div class="g-tag"><i class="fas fa-hashtag"></i> #あおはる切り抜き</div>
                    </div>
                </div>

                <div class="g-section" style="margin-bottom:0;">
                    <div class="g-head" style="color:#ff4757;"><i class="fas fa-exclamation-triangle" style="color:#ff4757;"></i> 禁止事項</div>
                    <ul class="g-list ng-list">
                        <li>公式のロゴ、メンバーの素材（立ち絵など）をそのままグッズ化・販売する行為</li>
                        <li>他者を攻撃する目的、政治的・宗教的な主張を含む利用</li>
                        <li>公式と誤認させるような振る舞い（なりすまし）</li>
                        <li>その他、公序良俗に反する行為、当グループが不適切と判断する行為</li>
                    </ul>
                </div>
            </div>

            <div style="text-align:center;">
                <button onclick="showPage('top')" class="more-btn">TOPへ戻る</button>
            </div>
        </div>
    </div>

<div id="rakugaki" class="page">
        <div class="page-header">
            <div class="page-title-en" style="color:#f1c40f;">GRAFFITI</div>
            <div class="page-title-jp">みんなの黒板落書き</div>
            
            <p style="margin-top: 20px; font-size: 14px; color: #666; line-height: 1.8; font-weight: bold;">
                推しへの愛をキャンバスに！🎨<br>
                イラストや応援メッセージを自由に描いて投稿しよう！
            </p>
            </div>
        <div class="container">
            <div class="board-container">
                <canvas id="drawCanvas"></canvas>                
                <div class="paint-tools">
                    <div class="color-btn active" style="background:white;" onclick="changeColor(this, '#ffffff')"></div>
                    <div class="color-btn" style="background:#ff9ff3;" onclick="changeColor(this, '#ff9ff3')"></div>
                    <div class="color-btn" style="background:#feca57;" onclick="changeColor(this, '#feca57')"></div>
                    <div class="color-btn" style="background:#ff6b6b;" onclick="changeColor(this, '#ff6b6b')"></div>
                    <div class="color-btn" style="background:#48dbfb;" onclick="changeColor(this, '#48dbfb')"></div>
                    <div class="color-btn" style="background:#1dd1a1;" onclick="changeColor(this, '#1dd1a1')"></div>
                    
                    <button class="tool-btn" onclick="setEraser()"><i class="fas fa-eraser"></i> 消しゴム</button>
                    <button class="tool-btn" onclick="clearCanvas()" ontouchend="clearCanvas()"><i class="fas fa-trash"></i> 全消去</button>
                </div>

                <div id="canvasLockOverlay" style="display:flex; flex-direction:column; align-items:center; justify-content:center; position:absolute; inset:0; background:rgba(0,0,0,0.6); z-index:50; color:white; border-radius:10px;">
                    <i class="fas fa-lock" style="font-size:40px; margin-bottom:10px;"></i>
                    <div style="font-weight:bold; font-size:16px;">MEMBER ONLY</div>
                    <p style="font-size:12px; margin:10px 0;">お絵描き機能は会員限定です</p>
                    <button class="contact-btn" style="width:auto; padding:8px 20px;" onclick="openLoginModal()">ログインする</button>
                </div>
            </div>

            <div style="background:#fff3cd; color:#856404; padding:15px; border-radius:10px; font-size:12px; font-weight:bold; margin-bottom:20px; border:1px solid #ffeeba;">
                <i class="fas fa-exclamation-triangle"></i> 落書き投稿に関するご注意
                <ul style="margin:5px 0 0 15px; padding:0;">
                    <li>公序良俗に反するイラスト、他人を不快にさせる表現は禁止です。</li>
                    <li>不適切な投稿は、運営（あおはる⭐︎フレンズ）の判断で削除する場合があります。</li>
                    <li>みんなで楽しく使えるようにご協力お願いします！</li>
                    <li>※公式X等でツイートさせていただく場合もありますので予めご了承ください</li>
                </ul>
            </div>

            <div class="post-form-area">
                <div class="section-title" style="margin-top:0;"><span class="ja-title">落書きを投稿・保存する</span></div>
                <label class="form-label">作品タイトル</label>
                <input type="text" id="graffitiTitle" class="form-input" placeholder="あおはるちゃん描いたよ！">
                <label class="form-label">ニックネーム</label>
                <input type="text" id="graffitiName" class="form-input" placeholder="クリエイター名">
                
                <div style="display:flex; gap:10px;">
                    <button class="contact-btn" style="background:#333;" onclick="downloadGraffiti()">画像を保存のみ</button>
                    <button class="contact-btn" onclick="postGraffiti()">投稿する</button>
                </div>
            </div>

            <div class="section-title"><div class="en-title">GALLERY</div><span class="ja-title">みんなの作品</span></div>
            <div class="scroll-wrapper">
                <button class="scroll-btn left" onclick="scrollContent('graffitiList', 'left')">◀</button>
                <div class="scroll-grid" id="graffitiList">
                    <div style="padding:20px; color:#999; width:100%; text-align:center;">読み込み中...</div>
                </div>
                <button class="scroll-btn right" onclick="scrollContent('graffitiList', 'right')">▶</button>
            </div>
        </div>
    </div>
</div>    
<div id="studio" class="page">
        <div class="page-header">
            <div class="page-title-en" style="color:#e1b12c;">STUDIO</div>
            <div class="page-title-jp">あおはるスタジオ</div>
        </div>
        
        <div class="container" style="max-width: 1000px;">
            <div style="text-align:center; margin-bottom:20px;">
                <p style="font-size:14px; font-weight:bold; color:#555;">
                    メンバーをタップしてポーズを変更できるよ！<br>
                    真ん中の「YOU」に自分のスキンを着せてね！
                </p>
            </div>

            <div id="studioStage" class="studio-stage">
                <div id="studioBg" class="studio-bg"></div>
                <img src="logo.png" class="studio-watermark">
                
                <div class="studio-actors">
                    <div class="actor-box" onclick="selectActor(0)">
                        <canvas id="skin_member_1"></canvas>
                        <div class="actor-select-ring"></div>
                    </div>
                    <div class="actor-box" onclick="selectActor(1)">
                        <canvas id="skin_member_2"></canvas>
                        <div class="actor-select-ring"></div>
                    </div>
                    <div class="actor-box center" onclick="selectActor(2)">
                        <canvas id="skin_user"></canvas>
                        <div class="user-label">YOU</div>
                        <div class="actor-select-ring"></div>
                    </div>
                    <div class="actor-box" onclick="selectActor(3)">
                        <canvas id="skin_member_3"></canvas>
                        <div class="actor-select-ring"></div>
                    </div>
                    <div class="actor-box" onclick="selectActor(4)">
                        <canvas id="skin_member_4"></canvas>
                        <div class="actor-select-ring"></div>
                    </div>
                </div>
            </div>

            <div class="studio-controls">
                
                <div class="control-header">
                    <div>CONTROLLER <span id="targetName" class="target-badge">全員</span></div>
                    <button class="reset-select-btn" onclick="selectActor(-1)"><i class="fas fa-undo"></i> 選択解除</button>
                </div>

                <div class="control-group">
                    <div class="c-label"><i class="fas fa-running"></i> MOTION & POSE</div>
                    <div class="pose-grid">
                        <button class="c-btn" onclick="setStudioAnim('idle')"><i class="fas fa-male"></i>立ち</button>
                        <button class="c-btn" onclick="setStudioAnim('walk')"><i class="fas fa-walking"></i>歩き</button>
                        <button class="c-btn" onclick="setStudioAnim('run')"><i class="fas fa-running"></i>走り</button>
                        <button class="c-btn" onclick="setStudioAnim('fly')"><i class="fas fa-plane"></i>飛行</button>
                        
                        <button class="c-btn" onclick="setPose('hug')"><i class="fas fa-child"></i>ハグ</button>
                        <button class="c-btn" onclick="setPose('cheer')"><i class="fas fa-hands-up"></i>バンザイ</button>
                        <button class="c-btn" onclick="setPose('point')"><i class="fas fa-hand-point-right"></i>指差し</button>
                        <button class="c-btn" onclick="setPose('sit')"><i class="fas fa-chair"></i>座る</button>
                        <button class="c-btn" onclick="setPose('ninja')"><i class="fas fa-mask"></i>忍者</button>
                        <button class="c-btn" onclick="setPose('zombie')"><i class="fas fa-book-dead"></i>キョンシー</button>

                        <button class="c-btn" onclick="toggleHeadTilt()"><i class="fas fa-question"></i>首かしげ</button>
                        <button class="c-btn" onclick="toggleRotate()"><i class="fas fa-sync"></i>回転ON</button>
                    </div>
                </div>

                <div class="control-group">
                    <div class="c-label"><i class="fas fa-tshirt"></i> CHANGE SKIN (YOU)</div>
                    <input type="file" id="skinUpload" accept="image/png" onchange="uploadUserSkin(this)" style="display:none;">
                    <button class="c-btn main" onclick="document.getElementById('skinUpload').click()">
                        <i class="fas fa-upload"></i> スキン画像を選択する
                    </button>
                </div>

                <div class="control-group">
                    <div class="c-label"><i class="fas fa-image"></i> BACKGROUND</div>
                    <div class="bg-selector">
                        <div class="bg-btn" onclick="changeStudioBg('#ff9a9e')" style="background:#ff9a9e;"></div>
                        <div class="bg-btn" onclick="changeStudioBg('#fad390')" style="background:#fad390;"></div>
                        <div class="bg-btn" onclick="changeStudioBg('#a29bfe')" style="background:#a29bfe;"></div>
                        <div class="bg-btn" onclick="changeStudioBg('#81ecec')" style="background:#81ecec;"></div>
                        <div class="bg-btn" onclick="changeStudioBg('#55efc4')" style="background:#55efc4;"></div>
                        
                        <div class="bg-btn minecraft-bg" onclick="changeStudioBg('url(bg_forest.jpg)')" style="background-image:url('bg_forest.jpg');"></div>
                        <div class="bg-btn minecraft-bg" onclick="changeStudioBg('url(bg_nether.jpg)')" style="background-image:url('bg_nether.jpg');"></div>
                        <div class="bg-btn minecraft-bg" onclick="changeStudioBg('url(bg_snow.jpg)')" style="background-image:url('bg_snow.jpg');"></div>
                        
                        <div class="bg-btn" onclick="changeStudioBg('#00ff00')" style="background:#00ff00; border-color:#000;"></div>
                    </div>
                </div>

                <div class="control-group">
                    <div class="c-label" style="color:#ff4757;"><i class="fas fa-plus-circle"></i> ADD MOB & ITEM</div>
                    <div class="pose-grid">
                        <button class="c-btn mob-btn" onclick="addFreeMob('skin_zombie.png')">🧟 ゾンビ</button>
                        <button class="c-btn mob-btn" onclick="addFreeMob('skin_skeleton.png')">💀 ガイコツ</button>
                        <button class="c-btn mob-btn" onclick="addFreeMob('skin_villager.png')">👨‍🌾 村人</button>
                        <button class="c-btn mob-btn" onclick="addFreeMob('skin_creeper.png')">💥 匠</button>
                    </div>
                    <p style="font-size:10px; color:#aaa; margin-top:8px;">
                        <i class="fas fa-info-circle"></i> キャラを移動するには足元の「MOVEバー」をドラッグしてください。<br>
                        <i class="fas fa-sync"></i> キャラ自体をドラッグすると回転します。
                    </p>
                </div>

            </div>

            <div style="text-align:center; margin-top:30px;">
                <button class="download-btn" onclick="captureStudio()" style="font-size:18px; padding:15px 40px; background:linear-gradient(to right, #e1b12c, #f39c12);">
                    <i class="fas fa-camera"></i> 撮影して保存！
                </button>
            </div>
            <div style="text-align:center; margin-top:20px;">
                <button onclick="showPage('top')" class="more-btn">TOPへ戻る</button>
            </div>
        </div>
    </div>    
    <div class="floating-heart-btn" onclick="spawnHeart()">
        <i class="fas fa-heart"></i>
        <div class="like-badge" id="totalLikeCount">...</div>
    </div>

    <div id="omikujiAnimModal" class="modal" style="background:rgba(0,0,0,0.85);">
        <div class="modal-content" style="background:transparent; box-shadow:none; overflow:visible;">
            <div class="omi-anim-container">
                <div id="omiParticles" class="omi-particles"></div>
                <div class="omi-box-container">
                    <div id="omiSlip" class="omi-slip"></div>
                    <div id="omiBox" class="omi-box">おみくじ</div>
                </div>
            </div>
            <p style="color:white; font-weight:bold; margin-top:20px; font-size:20px; text-shadow:0 2px 5px rgba(0,0,0,0.5);">運命を抽選中...</p>
        </div>
    </div>

    <div id="omikujiModal" class="modal" onclick="closeOmikujiModal()">
        <div class="modal-content" style="text-align:center;" onclick="event.stopPropagation()">
            <span class="modal-close-btn" onclick="closeOmikujiModal()">×</span>
            
            <div id="omiCaptureArea" style="background:white; padding:10px; border-radius:10px;">
                <div style="font-size:24px; font-weight:900; margin-bottom:20px; color:var(--primary); font-family: 'M PLUS Rounded 1c', sans-serif;">今日の運勢は…？</div>
                <img id="omiResultImg" src="" class="omi-chara-img">
                <div id="omiResultRank" class="omi-rank"></div>
                <div id="omiResultMsg" class="omi-msg"></div>
                <div style="margin-top:15px;">ラッキーアイテム：<span id="omiResultItem" class="omi-item"></span></div>
            </div>

<div class="omi-action-btns">
                <button class="sns-share-btn" onclick="shareOmikuji()"><i class="fab fa-x-twitter"></i> ポストする</button>
                <button class="save-img-btn" onclick="saveOmikuji()"><i class="fas fa-camera"></i> 保存する</button>
            </div>
            
        </div> </div> 
            <div id="graffitiModal" class="modal" onclick="closeGraffitiModal()">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <span class="modal-close-btn" onclick="closeGraffitiModal()" style="z-index: 10; color: white; text-shadow: 0 0 5px black;">×</span>
                        <div class="g-modal-body">
                            <div class="g-modal-img-area">
                                <img id="gDetailImg" src="" class="g-modal-img">
                                <div class="g-modal-like-btn" onclick="toggleGraffitiLike()">
                                    <i class="fas fa-heart"></i> <span id="gDetailLikes">0</span>
                                </div>
                            </div>
                            <div class="g-modal-info-area">
                                <div class="g-modal-header">
                                    <div id="gDetailTitle" class="g-modal-title">タイトル</div>
                                    <div class="g-modal-author">
                                        <i class="fas fa-user-circle"></i> <span id="gDetailAuthor">作者名</span>
                                    </div>
                                </div>
                                <div id="gDetailComments" class="g-comment-list">
                                    </div>
                                <div class="g-comment-form">
                                    <input type="text" id="gCommentInput" class="g-cmt-input" placeholder="コメントを入力...">
                                    <button class="g-cmt-btn" onclick="submitGraffitiComment()"><i class="fas fa-paper-plane"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        </div>
    </div>

    <footer>
        <div class="footer-container">
            <div class="footer-left">
                <ul class="footer-menu">
                    <li><a href="javascript:void(0)" onclick="showPage('top')">TOP<span class="footer-menu-ja">トップ</span></a></li>
                    <li><a href="javascript:void(0)" onclick="showPage('news')">NEWS<span class="footer-menu-ja">お知らせ</span></a></li>
                    <li><a href="javascript:void(0)" onclick="showPage('member')">MEMBER<span class="footer-menu-ja">メンバー</span></a></li>
                    <li><a href="javascript:void(0)" onclick="showPage('schedule')">SCHEDULE<span class="footer-menu-ja">スケジュール</span></a></li>
                    <li><a href="javascript:void(0)" onclick="showPage('goods')">GOODS<span class="footer-menu-ja">グッズ</span></a></li>
                    <li><a href="javascript:void(0)" onclick="showPage('radio')">RADIO<span class="footer-menu-ja">ラジオ</span></a></li>
                    <li><a href="javascript:void(0)" onclick="showPage('guideline')">GUIDELINE<span class="footer-menu-ja">ガイドライン</span></a></li> 
                    <li><a href="javascript:void(0)" onclick="showPage('rakugaki')">GRAFFITI<span class="footer-menu-ja">落書き広場</span></a></li>
                    <li><a href="javascript:void(0)" onclick="showPage('studio')">STUDIO<span class="footer-menu-ja">スタジオ</span></a></li>
                    <li><a href="javascript:void(0)" onclick="openLoginModal()">LOGIN<span class="footer-menu-ja">ログイン</span></a></li>
                </ul>
            </div>
            <div class="footer-right">
                <img src="logo.png" alt="AOHARU FRIENDS" class="footer-logo">
                <div class="footer-sns">
                    <a href="https://x.com/AO_FURE" id="footerTwitterLink" target="_blank" class="footer-sns-btn"><img src="icon_x.png" alt="X" class="footer-sns-icon-img"></a>
                    <a href="https://www.youtube.com/@あおはるフレンズ" id="footerYoutubeLink" target="_blank" class="footer-sns-btn"><img src="icon_youtube.png" alt="YouTube" class="footer-sns-icon-img"></a>
                </div>
            </div>
        </div>
<div class="copyright" onclick="triggerSecretEvent()" style="cursor:pointer; user-select:none;">
    © 2026 AOHARU FRIENDS All Rights Reserved.
</div>
</footer>

<div id="flashlightOverlay" class="flashlight-layer"></div>

    <div id="tvNoiseOverlay" class="tv-noise-layer"></div>

<div id="secretOldSchool" class="page" style="background-color:#050505; min-height:100vh; overflow:hidden;">
        
        <div id="secretGate" class="gate-wrapper">
            <div class="gate-door left"></div>
            <div class="gate-door right"></div>
            
            <div class="gate-content">
                <div class="warning-sign">
                    ⚠️ DANGER ⚠️<br>立ち入り禁止
                </div>
                <div class="enter-message" onclick="openSecretGate()">
                    入る...？
                </div>
            </div>
        </div>

        <div id="oldSchoolRoom" class="room-content" style="opacity:0; transition:opacity 2s;">
            
            <div class="horror-item note" onclick="openHorrorNote()" style="top: 70%; left: 20%;">
                <img src="item_note.png" alt="ノート">
            </div>

            <div class="horror-item radio" onclick="playHorrorRadio()" style="top: 80%; right: 15%;">
                <img src="item_radio.png" alt="ラジカセ">
            </div>

            <div class="horror-item window" onclick="triggerScream()" style="top: 30%; left: 10%; width: 15%; height: 20%; opacity: 0;">
                </div>

            <div class="horror-item blood-wall" style="top: 20%; right: 30%;">
                <span id="bloodTextDisplay" class="blood-text"></span>
            </div>

<div class="cursed-input-area" style="top: 50%; left: 50%; transform: translate(-50%, -50%);">
                <p class="cursed-label">...ナマエヲ カケ...</p>
                <input type="text" id="cursedInput" class="cursed-input" placeholder="ここに入力..." autocomplete="off">
            </div>

            <div class="container" style="padding-top:50px; text-align:center; position:relative; z-index:1; pointer-events:none;">
                <div style="font-family:'Times New Roman', serif; font-size:40px; color:#550000; letter-spacing:5px; margin-bottom:20px; opacity:0.5;">
                    OLD SCHOOL
                </div>
<div onclick="exitHorrorMode()" style="pointer-events:auto; display:inline-block; cursor:pointer; border:1px solid #555; padding:5px 15px; color:#555; border-radius:5px; background:rgba(0,0,0,0.5);">
            <i class="fas fa-running"></i> 非常口
        </div>
    </div>

    <div class="darkness-overlay"></div>
    <div class="rain-layer layer1"></div>
    <div class="rain-layer layer2"></div>
    <div class="secret-bg-img"></div>

            <div id="noteModal" class="note-overlay" onclick="this.style.display='none'">
                <div class="note-paper">
                    <p id="noteContent">読み込み中...</p>
                </div>
            </div>

            <div id="screamOverlay" class="scream-overlay">
                <img id="screamImg" src="" style="width:100%; height:100%; object-fit:cover;">
            </div>
        </div>

<div id="secretOldSchool" class="page" style="background-color:#050505; min-height:100vh; overflow:hidden;">
       <div id="screamOverlay" class="scream-overlay">
           <img id="screamImg" src="" style="width:100%; height:100%; object-fit:cover;">
       </div>
</div>

<script>
    // ==========================================
    // ▼▼▼ あおはる⭐︎フレンズ 公式サイト 最終完全版スクリプト ▼▼▼
    // ==========================================

    const GAS_API_URL = "https://script.google.com/macros/s/AKfycby_qq3_EBcgITkVStFSbca1JmVeh2B3Dv3Xd72ycSwXd1uxSJJ9MDKlgFCzC3_heFKMWQ/exec";
    let YOUTUBE_API_KEY = ""; 
    let GROUP_CONFIG = {};
    let memberData = [];
    let goodsData = [{ name: "Loading...", price: "-", img: "icon.png", link: "#" }]; 
    
    // 変数定義
    const fortuneTypes = ["大吉", "中吉", "小吉", "吉", "末吉"];
    let luckyItems = ["ゲーミングPC", "エナジードリンク", "マイク", "配信機材", "推し活グッズ", "唐揚げ", "ラーメン", "猫", "ヘッドホン", "サイリウム"];
    let fortuneComments = ["今日は最高の配信ができそう！", "ラッキーアイテムを持って待機してね！", "推しの配信を見ると運気アップ！", "今日はゆっくりアーカイブを見よう。", "SNSで推しを布教するといいことあるかも！"];
    let currentOmikujiResult = null; 
    let newsData = [], scheduleData = [], videoData = [], manualLiveData = [], memberVideoData = [];
    let radioBlogData = []; 
    let isMemberLoggedIn = false;
    let isOfficialAdmin = false;
    let currentUserData = null;
    let totalLikes = 0;
    let sessionLikes = 0;
    let likeSyncTimer = null;
    const secretCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
    let secretInput = [];
    let logoTapCount = 0;
    let secretTapCount = 0;   // これがないと入れません
    let secretTapTimer = null;
    let horrorAudio = {};     // これがないと音が鳴りません
    let secretData = {};      // 恐怖のテキストデータ

    // ▼ 初期化 ▼
    window.onload = function() { 
        const savedUser = localStorage.getItem('aoharu_user');
        if (savedUser) {
            currentUserData = JSON.parse(savedUser);
            isMemberLoggedIn = true;
            isOfficialAdmin = false; 
            const headerBtn = document.getElementById('headerLoginBtn');
            if(headerBtn) {
                headerBtn.innerText = currentUserData.name;
                headerBtn.classList.add('logged-in-user');
                headerBtn.onclick = () => showPage('mypage');
            }
        }
        const savedGraffiti = localStorage.getItem('aoharu_graffiti');
        if (savedGraffiti) {
            graffitiPosts = JSON.parse(savedGraffiti);
        }

        fetchSheetData().finally(() => {
            if(currentUserData && memberData.length > 0){
                 const matchedMember = memberData.find(m => m.name === currentUserData.name);
                 if (matchedMember) { isOfficialAdmin = true; }
            }
            renderStaticParts(); 
            setTimeout(checkLiveStatus, 500); 
            initCardMaker(); 
            renderRadioDiary(); 
            fetchLikes(); 
            initOmikuji(); 
            initEasterEgg(); 
            handleLocation(); 
            renderGraffitiList(); 
            initBackgroundShapes();
            renderThemeButtons();
            const loader = document.getElementById('loadingScreen');
            if(loader) {
                loader.classList.add('loaded');
                setTimeout(() => loader.remove(), 500); 
            }
        });
    };

    window.onpopstate = handleLocation;

    function handleLocation() {
        const hash = location.hash;
        if (hash.startsWith('#member_')) {
            const index = parseInt(hash.split('_')[1]);
            if(memberData.length > 0) openMemberDetail(index, false); 
        } else if (hash) {
            const id = hash.replace('#', '');
            if(document.getElementById(id)) showPage(id, null, false);
            else showPage('top', null, false);
        } else {
            showPage('top', null, false);
        }
    }

    function showPage(pageId, detailName = null, pushHistory = true) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        const target = document.getElementById(pageId);
        if(target) {
            target.classList.add('active');
            if (pageId === 'mypage' && currentUserData) {
                document.getElementById('myIconDisplay').src = currentUserData.icon || 'icon.png';
                document.getElementById('myNameDisplay').innerText = currentUserData.name;
                document.getElementById('myIdDisplay').innerText = 'ID: ' + currentUserData.id;
                document.getElementById('myNameInput').value = currentUserData.name;
                document.getElementById('myIconInput').value = currentUserData.icon;
                document.getElementById('myBioInput').value = currentUserData.bio;
                document.getElementById('myXInput').value = currentUserData.x;
                document.getElementById('myYtInput').value = currentUserData.yt;
            }
            if(pageId === 'rakugaki') { 
                setTimeout(() => {
                    initCanvas();
                    checkCanvasLock();    
                    renderGraffitiList(); 
                }, 300); 
            }
            if(pageId === 'studio') {
                setTimeout(initStudio, 100);
            } 
            if(pageId === 'skinviewer') {
                setTimeout(initSkinViewer, 100);
            }
        }
        if(document.getElementById('sideMenu').classList.contains('open')) toggleMenu(); 
        if(pushHistory) history.pushState(null, null, '#' + pageId);
        updateBreadcrumbs(pageId, detailName);
        window.scrollTo(0,0);
    }

    function updateBreadcrumbs(pageId, detailName) { 
        const container = document.getElementById('breadcrumbNav'); 
        let html = '<a href="javascript:void(0)" onclick="showPage(\'top\')" class="bc-item"><i class="fas fa-home bc-icon"></i></a>'; 
        if (pageId === 'top') { container.style.display = 'none'; return; } else { container.style.display = 'flex'; } 
        const sep = '<span class="bc-sep">▶</span>'; 
        const titles = {'news':'NEWS', 'member':'MEMBER', 'schedule':'SCHEDULE', 'goods':'GOODS', 'radio':'RADIO', 'guideline':'GUIDELINE', 'rakugaki':'GRAFFITI', 'mypage':'MY PAGE', 'studio':'STUDIO', 'skinviewer':'SKIN VIEWER'};
        if (pageId === 'memberDetail') {
             html += sep + '<a href="javascript:void(0)" onclick="showPage(\'member\')" class="bc-item">MEMBER</a>'; 
             html += sep + '<span class="bc-current">' + (detailName || 'DETAIL') + '</span>';
        } else {
             html += sep + '<span class="bc-current">' + (titles[pageId] || pageId.toUpperCase()) + '</span>';
        }
        container.innerHTML = html; 
    }

    // --- データ取得 ---
    async function fetchSheetData() {
        if (!GAS_API_URL || GAS_API_URL.indexOf("script.google.com") === -1) {
            console.error("GAS URL未設定"); return;
        }
        try {
            const res = await fetch(GAS_API_URL);
            const data = await res.json();
            if(data.secret) setSecretData(data);
            if (data.config) {
                const conf = {};
                data.config.forEach(row => { conf[row.key] = row.value; });
                if(conf.youtube_api_key) YOUTUBE_API_KEY = conf.youtube_api_key;
                if(conf.radio_theme_main) document.getElementById('radioThemeDisplay').innerText = conf.radio_theme_main;
                if(conf.radio_theme_sub) document.getElementById('radioThemeNote').innerText = conf.radio_theme_sub;
                GROUP_CONFIG.name = "あおはる⭐︎フレンズ";
                if(conf.group_logo_img) GROUP_CONFIG.img = conf.group_logo_img;
                if(conf.group_youtube_id) GROUP_CONFIG.youtubeChannelId = conf.group_youtube_id;
                if(conf.group_twitter_url) GROUP_CONFIG.twitterUrl = conf.group_twitter_url;
            }
            if (data.members) memberData = data.members;
            if (data.news) { newsData = data.news; renderNews(); }
            if (data.schedule) { scheduleData = data.schedule; renderSchedule(); }
            if (data.videos) { videoData = data.videos; renderVideos(); }
            if (data.live) { manualLiveData = data.live; } 
            if (data.member_videos) { memberVideoData = data.member_videos; renderMemberVideos(); }
            if (data.radio_diaries) { radioBlogData = data.radio_diaries; } 
            if (data.goods) {
                goodsData = data.goods;
                document.getElementById('goodsList').innerHTML = goodsData.map((g, i) => `<div class="goods-item" onclick="openGoodsModal(${i})"><img src="${g.img}" class="goods-img"><div class="goods-name">${g.name}</div><div class="goods-price">${g.price}</div></div>`).join('');
            }
            if (data.graffiti) {
                graffitiPosts = data.graffiti.map(g => ({
                    id: g.id, title: g.title, author: g.author, image: g.image, likes: g.likes || 0, comments: g.comments ? JSON.parse(g.comments) : [] 
                }));
                renderGraffitiList();
            }
　　　　　　// ▼▼▼ おみくじデータをスプシから反映 ▼▼▼
            if (data.omikuji_settings) {
                const newItems = [];
                const newComments = [];
                
                // スプシのデータを配列に入れる
                data.omikuji_settings.forEach(row => {
                    if (row.item) newItems.push(row.item);
                    if (row.comment) newComments.push(row.comment);
                });

                // データがあれば上書きする
                if (newItems.length > 0) luckyItems = newItems;
                if (newComments.length > 0) fortuneComments = newComments;
            }
        } catch (e) { 
            console.error("Data Error:", e); 
        }
    }
    
    // --- ★復活させた「いいね」機能（これが消えていました！） ---
    async function fetchLikes() { 
        if (!GAS_API_URL) return; 
        try { 
            const res = await fetch(`${GAS_API_URL}?action=get_likes`); 
            const json = await res.json(); 
            totalLikes = json.count || 0; 
            updateLikeDisplay(); 
        } catch (e) { console.error(e); } 
    }
    function updateLikeDisplay() { 
        const el = document.getElementById('totalLikeCount');
        if(el) el.innerText = totalLikes + sessionLikes; 
    }
    function spawnHeart() { 
        const heart = document.createElement('i'); 
        heart.className = 'fas fa-heart heart-particle'; 
        const colors = ['#ff9a9e', '#ff6b6b', '#feca57', '#48dbfb', '#ff9ff3']; 
        heart.style.color = colors[Math.floor(Math.random() * colors.length)]; 
        heart.style.left = (window.innerWidth - 80 + (Math.random() * 40)) + 'px'; 
        heart.style.bottom = '80px'; 
        document.body.appendChild(heart); 
        setTimeout(() => heart.remove(), 1500); 
        sessionLikes++; 
        updateLikeDisplay(); 
        clearTimeout(likeSyncTimer); 
        likeSyncTimer = setTimeout(syncLikes, 2000); 
    }
    async function syncLikes() { 
        if (sessionLikes === 0) return; 
        const countToSend = sessionLikes; 
        sessionLikes = 0; 
        totalLikes += countToSend; 
        updateLikeDisplay(); 
        if (!GAS_API_URL) return; 
        try { 
            const res = await fetch(`${GAS_API_URL}?action=add_likes&count=${countToSend}`); 
            const json = await res.json(); 
            if (json.total) { totalLikes = json.total; updateLikeDisplay(); } 
        } catch (e) { console.error("Like Sync Error", e); } 
    }

    // --- ライブ配信状況確認関数 ---
    // ▼▼▼ 自動配信チェック関数（複数人対応版） ▼▼▼
    async function checkLiveStatus() {
        const liveSection = document.getElementById('nowOnAirSection');
        const heroArea = document.getElementById('heroLiveArea');
        const subGrid = document.getElementById('subLiveGrid');
        
        // エリアをリセット
        heroArea.innerHTML = '';
        subGrid.innerHTML = '';
        liveSection.style.display = 'none';

        let liveVideos = [];

        // 1. 手動設定（スプレッドシートの「ライブ中設定」）を確認
        if (manualLiveData && manualLiveData.active) {
            liveVideos.push({
                videoId: manualLiveData.videoId,
                title: manualLiveData.title,
                channelTitle: "OFFICIAL / MANUAL",
                thumbnail: `https://img.youtube.com/vi/${manualLiveData.videoId}/mqdefault.jpg`
            });
        }

        // 2. 自動チェック（APIキーがある場合のみ）
        // ※注意：アクセスが多いとAPI制限(1日上限)にかかり、表示されなくなる場合があります
        if (YOUTUBE_API_KEY) {
            // チェックするIDのリストを作成（グループID + メンバー全員のID）
            let targetIds = [];
            if (GROUP_CONFIG.youtubeChannelId) targetIds.push(GROUP_CONFIG.youtubeChannelId);
            if (memberData && memberData.length > 0) {
                memberData.forEach(m => {
                    if (m.youtubeId) targetIds.push(m.youtubeId);
                });
            }

            // 重複を除去
            targetIds = [...new Set(targetIds)];

            // 全員分を並列でチェック（APIリクエスト）
            const promises = targetIds.map(async (id) => {
                try {
                    const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${id}&eventType=live&type=video&key=${YOUTUBE_API_KEY}`;
                    const res = await fetch(url);
                    const data = await res.json();
                    if (data.items && data.items.length > 0) {
                        return data.items[0]; // ヒットした配信情報を返す
                    }
                } catch (e) {
                    console.error("API Error for " + id, e);
                }
                return null;
            });

            // 全ての結果を待つ
            const results = await Promise.all(promises);
            
            // ヒットした動画をリストに追加
            results.forEach(video => {
                if (video) {
                    // 手動設定と重複していなければ追加
                    const isDuplicate = liveVideos.some(v => v.videoId === video.id.videoId);
                    if (!isDuplicate) {
                        liveVideos.push({
                            videoId: video.id.videoId,
                            title: video.snippet.title,
                            channelTitle: video.snippet.channelTitle,
                            thumbnail: video.snippet.thumbnails.high.url
                        });
                    }
                }
            });
        }

        // 3. 画面に表示
        if (liveVideos.length > 0) {
            liveSection.style.display = 'block';

            // 1つ目をメイン（大きく）表示
            const mainVideo = liveVideos[0];
            heroArea.innerHTML = `
                <div class="live-hero-wrapper">
                    <div class="live-iframe-box">
                        <iframe class="live-iframe" src="https://www.youtube.com/embed/${mainVideo.videoId}" frameborder="0" allowfullscreen></iframe>
                    </div>
                    <div class="live-info-bar">
                        <span class="live-status-badge">NOW ON AIR</span>
                        <div class="live-info-text">
                            <div class="live-info-name">${mainVideo.channelTitle}</div>
                            <div class="live-info-title">${mainVideo.title}</div>
                        </div>
                    </div>
                </div>`;

            // 2つ目以降があれば、下に小さく並べる（サブグリッド）
            if (liveVideos.length > 1) {
                let subHtml = '';
                for (let i = 1; i < liveVideos.length; i++) {
                    const sub = liveVideos[i];
                    subHtml += `
                    <div class="sub-live-card" onclick="window.open('https://www.youtube.com/watch?v=${sub.videoId}', '_blank')">
                        <div style="position:relative;">
                            <img src="${sub.thumbnail}" class="sub-live-thumb">
                            <div style="position:absolute; top:5px; left:5px; background:red; color:white; font-size:10px; padding:2px 5px; border-radius:3px; font-weight:bold;">LIVE</div>
                        </div>
                        <div class="sub-live-title">${sub.title}</div>
                    </div>`;
                }
                subGrid.innerHTML = subHtml;
                subGrid.style.display = 'flex';
            } else {
                subGrid.style.display = 'none';
            }
        }
    }

    // --- レンダリング関数 ---
    function renderNews() { 
        const newsHtmlTop = newsData.map((n, i) => { 
            const imgSrc = n.image ? n.image : "https://placehold.co/600x400/eee/333?text=NEWS"; 
            return `<div class="news-card" onclick="openNewsModal(${i})">
                        <div class="news-thumb-area"><span class="news-badge" style="background:${getTagColor(n.tag)}">${n.tag}</span><img src="${imgSrc}" class="news-img"></div>
                        <div class="news-content"><div class="news-date">${n.date}</div><div class="news-title">${n.title}</div><div class="news-check-btn">CHECK</div></div>
                    </div>`; 
        }).join(''); 
        const newsHtmlPage = newsData.map((n, i) => { 
            const imgSrc = n.image ? n.image : "https://placehold.co/600x400/eee/333?text=NEWS"; 
            return `<div class="news-card" onclick="updatePickupNews(${i})">
                        <div class="news-thumb-area"><span class="news-badge" style="background:${getTagColor(n.tag)}">${n.tag}</span><img src="${imgSrc}" class="news-img"></div>
                        <div class="news-content"><div class="news-date">${n.date}</div><div class="news-title">${n.title}</div><div class="news-check-btn">VIEW</div></div>
                    </div>`; 
        }).join(''); 

        const topList = document.getElementById('topNewsList'); const fullList = document.getElementById('fullNewsList'); 
        if(topList) topList.innerHTML = newsHtmlTop || "まだニュースはありません"; 
        if(fullList) fullList.innerHTML = newsHtmlPage || "まだニュースはありません"; 
    }

    function updatePickupNews(index) {
        const data = newsData[index];
        if(!data) return;
        
        const img = document.getElementById('pickupImg');
        const title = document.getElementById('pickupTitle');
        const badge = document.getElementById('pickupBadge');
        const detail = document.getElementById('pickupDetail');
        
        // 画像やテキストの更新
        img.src = data.image || "https://placehold.co/800x450/27C6F5/ffffff?text=NO+IMAGE";
        title.innerText = data.title;
        
        // バッジの更新と表示（閉じた後に再表示するため display を指定）
        badge.innerText = data.tag || 'NEWS';
        badge.style.background = getTagColor(data.tag);
        badge.style.display = "inline-block"; 
        
        if(detail) detail.innerText = data.detail || data.title;

        // ★追加：閉じるボタンを表示する
        const closeBtn = document.getElementById('pickupCloseBtn');
        if(closeBtn) closeBtn.style.display = "flex";
        
        // スクロール処理（変数の宣言はここ1回だけに統一）
        const pickupArea = document.querySelector('.news-pickup');
        if(pickupArea) pickupArea.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    function openNewsModal(index) { 
        const data = newsData[index]; 
        document.getElementById('modalDate').innerText = data.date; 
        const tagEl = document.getElementById('modalTag'); tagEl.innerText = data.tag; tagEl.style.background = getTagColor(data.tag); 
        document.getElementById('modalTitle').innerText = data.title; 
        document.getElementById('modalBody').innerText = data.detail || data.title; 
        const img = document.getElementById('modalImg');
        if (img && data.image && data.image !== "") { img.src = data.image; img.style.display = "block"; } else if (img) { img.style.display = "none"; }
        document.getElementById('newsModal').classList.add('open'); 
    }

function renderSchedule() {
        // ▼ TOPページ用カード（横スクロール）
        const topScheduleHtml = scheduleData.map((s, i) => {
            let bgHtml = '', boxClass = 'sch-thumb-box no-img';
            
            // 画像があれば表示（フィルターなし）
            if (s.img && s.img !== "") { 
                bgHtml = `<img src="${s.img}" class="sch-bg-img" style="width:100%; height:100%; object-fit:cover; position:absolute; inset:0; z-index:0;">`; 
                boxClass = 'sch-thumb-box'; 
            }
            
            // メンバーアイコン生成
            let memberIconsHtml = '';
            if (s.member) { 
                s.member.split(',').forEach(mem => { 
                    mem = mem.trim(); 
                    if(mem) {
                        memberIconsHtml += `<img src="icon_sch_${mem}.png" class="sch-mini-icon" style="width:30px; height:30px; border-radius:50%; border:2px solid white; object-fit:cover; background:white;" onerror="this.style.display='none'">`;
                    }
                }); 
            }
            
            return `
            <div class="schedule-card" onclick="openScheduleModal(${i})" style="cursor:pointer;">
                <div class="${boxClass}" style="position:relative; overflow:hidden;">
                    ${bgHtml}
                    <div class="sch-icons-overlay" style="position:absolute; bottom:5px; right:5px; z-index:3; display:flex; gap:3px;">
                        ${memberIconsHtml}
                    </div>
                </div>
                <div class="sch-info" style="text-align:left; padding:10px;">
                    <div style="display:flex; align-items:center; margin-bottom:5px;">
                        <span class="sch-badge-mini" style="margin-bottom:0; margin-right:8px; flex-shrink:0;">配信</span>
                        <span style="font-size:13px; font-weight:bold; color:#27C6F5; font-family:'Poppins', sans-serif;">${s.date} ${s.time}</span>
                    </div>
                    <div class="sch-title" style="margin:0;">${s.content}</div>
                </div>
            </div>`;
        }).join('');

        // ▼ 個別ページ用リスト（縦リスト・デザイン変更なし）
        const tlHtml = scheduleData.map((s, i) => {
            let thumbHtml = '';
            if (s.img && s.img !== "") {
                thumbHtml = `<img src="${s.img}" class="tl-thumb-img">`;
            }

            let platformIconsHtml = '';
            if (s.platform) {
                s.platform.split(',').forEach(pf => {
                    pf = pf.trim();
                    if (pf) {
                        platformIconsHtml += `<img src="icon_pf_${pf}.png" class="tl-platform-icon" title="${pf}" style="width:20px; height:20px; object-fit:contain;">`;
                    }
                });
            }
            
            let memberIconHtml = '';
            if (s.member) {
                s.member.split(',').forEach(mem => {
                    mem = mem.trim();
                    if (mem) {
                        memberIconHtml += `<img src="icon_sch_${mem}.png" class="tl-member-icon" title="${mem}" style="width:30px; height:30px; border-radius:50%; object-fit:cover;" onerror="this.style.display='none'">`;
                    }
                });
            }

            return `
            <div class="timeline-item" onclick="openScheduleModal(${i})" style="cursor:pointer;">
                <div class="tl-icon-box">
                    <div class="tl-icon"><i class="fas fa-video"></i></div>
                </div>
                <div class="tl-content">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <span class="tl-tag">配信</span>
                            <div class="tl-date">${s.date} <span style="font-size:14px; color:#888; margin-left:5px;">${s.time}</span></div>
                        </div>
                        <div class="tl-icons-row" style="margin-top:0; display:flex; align-items:center; gap:5px;">
                            ${platformIconsHtml}
                            ${memberIconHtml}
                        </div>
                    </div>
                    
                    <div class="tl-body-box" style="margin-top:0; display:flex; align-items:flex-start; gap:15px;">
                        ${thumbHtml}
                        <div class="tl-title">${s.content}</div>
                    </div>
                </div>
            </div>`;
        }).join('');

        const topList = document.getElementById('topScheduleList');
        if(topList) topList.innerHTML = topScheduleHtml || "予定はありません";
        const schList = document.getElementById('scheduleList');
        if(schList) schList.innerHTML = tlHtml;
    }
    function renderVideos() { const videoHtml = videoData.map(v => `<div class="video-card" onclick="window.open('https://www.youtube.com/watch?v=${v.id}', '_blank')"><div class="video-thumb-box"><img src="https://img.youtube.com/vi/${v.id}/mqdefault.jpg" class="video-thumb"><div class="play-icon">▶</div></div><div class="video-info"><div class="video-title">${v.title}</div><div class="video-date">${v.date}</div></div></div>`).join(''); const list = document.getElementById('topVideoList'); if(list) list.innerHTML = videoHtml || "動画はまだありません"; }
    function renderMemberVideos() { const container = document.getElementById('memberVideoList'); if(!memberVideoData.length) { container.innerHTML = "限定動画はまだありません"; return; } const html = memberVideoData.map(v => { const clickAction = isMemberLoggedIn ? `window.open('https://www.youtube.com/watch?v=${v.id}', '_blank')` : `openLoginModal()`; const lockedClass = isMemberLoggedIn ? 'unlocked' : 'mv-blur'; const lockOverlay = isMemberLoggedIn ? '' : `<div class="mv-lock-overlay"><div class="mv-lock-icon"><i class="fas fa-lock"></i></div><div class="mv-lock-text">MEMBER ONLY</div></div>`; return `<div class="member-video-card ${lockedClass}" onclick="${clickAction}">${lockOverlay}<div class="news-thumb-area"><img src="https://img.youtube.com/vi/${v.id}/mqdefault.jpg" class="news-img"></div><div class="news-content"><div class="news-date">${v.date}</div><div class="news-title">${v.title}</div><div class="news-check-btn">${isMemberLoggedIn ? 'PLAY' : 'LOCKED'}</div></div></div>`; }).join(''); container.innerHTML = html; }
    function renderRadioDiary() { const container = document.getElementById('radioDiaryList'); if (!radioBlogData || radioBlogData.length === 0) { container.innerHTML = '<p style="text-align:center;color:#888;">まだ日記はありません</p>'; return; } container.innerHTML = radioBlogData.map(d => { if (!isMemberLoggedIn) { return ` <div class="diary-card" onclick="openLoginModal()" style="cursor:pointer; position:relative; overflow:hidden;"> <div style="filter: blur(6px); opacity: 0.6; pointer-events: none;"> <div class="diary-icon" style="background:#ddd;"></div> <div class="diary-content"> <div class="diary-name">SECRET MEMBER</div> <div class="diary-text">このコンテンツは会員限定です。<br>ログインすると閲覧できます。</div> <div class="diary-date">----.--.--</div> </div> </div> <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center; width:100%; z-index:2;"> <i class="fas fa-lock" style="font-size:24px; color:#555; margin-bottom:5px;"></i> <div style="font-weight:bold; font-size:12px; color:#555;">MEMBER ONLY</div> </div> </div> `; } let iconSrc = "icon.png"; let imgPos = "top center"; if (memberData && memberData.length > 0) { const targetMember = memberData.find(m => m.name === d.name); if (targetMember) { if(targetMember.img) iconSrc = targetMember.img; } } if (d.img && d.img !== "") iconSrc = d.img; const voicePlayer = d.voice ? `<div class="diary-voice-player" onclick="playVoice(this, '${d.voice}')"> <i class="fas fa-play voice-icon"></i> <span class="voice-time">限定ボイス</span> </div>` : ''; return ` <div class="diary-card"> <div class="diary-icon" style="background-image: url('${iconSrc}'); background-position: ${imgPos};"></div> <div class="diary-content"> <div class="diary-name">${d.name}</div> <div class="diary-text">${d.text}</div> ${voicePlayer} <div class="diary-date">${d.date}</div> </div> </div> `; }).join(''); }
    function renderStaticParts() { const twLink = document.getElementById('groupTwitterLink'); const ytLink = document.getElementById('groupYoutubeLink'); const footerTwLink = document.getElementById('footerTwitterLink'); const footerYtLink = document.getElementById('footerYoutubeLink'); if(GROUP_CONFIG.twitterUrl) { twLink.href = GROUP_CONFIG.twitterUrl; footerTwLink.href = GROUP_CONFIG.twitterUrl; } if(GROUP_CONFIG.youtubeChannelId) { const ytUrl = `https://www.youtube.com/channel/${GROUP_CONFIG.youtubeChannelId}`; ytLink.href = ytUrl; footerYtLink.href = ytUrl; } if(memberData.length > 0) { const memberHtml = memberData.map((m, i) => `<div class="member-card-vertical" onclick="openMemberDetail(${i})" style="--member-color: ${m.color}; --member-bg: url('${m.bgImg}');"><div class="member-img-wrapper"><img src="${m.img}" class="member-img-tachie"></div><a href="javascript:void(0)" class="member-link-overlay"></a></div>`).join(''); document.getElementById('topMemberList').innerHTML = memberHtml; document.getElementById('memberGrid').innerHTML = memberHtml; } }

    // --- その他UI機能 ---
    let currentAudio = null; let currentBtn = null;
    function playVoice(btn, url) { if (currentBtn === btn && currentAudio) { currentAudio.pause(); resetPlayer(); return; } if (currentAudio) { currentAudio.pause(); resetPlayer(); } const audio = new Audio(url); audio.volume = 0.5; btn.classList.add('playing'); const icon = btn.querySelector('.voice-icon'); const label = btn.querySelector('.voice-time'); if(icon) icon.className = 'fas fa-stop voice-icon'; if(label) label.innerText = 'STOP'; audio.play().catch(e => { console.error("再生エラー", e); alert("音声ファイルが再生できませんでした"); resetPlayer(); }); audio.onended = resetPlayer; currentAudio = audio; currentBtn = btn; }
    function resetPlayer() { if (currentBtn) { currentBtn.classList.remove('playing'); const icon = currentBtn.querySelector('.voice-icon'); const label = currentBtn.querySelector('.voice-time'); if(icon) icon.className = 'fas fa-play voice-icon'; if(label) label.innerText = 'PLAY'; } currentAudio = null; currentBtn = null; }
    function closeNewsModal() { document.getElementById('newsModal').classList.remove('open'); }
    function openLoginModal() { document.getElementById('loginModal').classList.add('open'); }
    function closeLoginModal() { document.getElementById('loginModal').classList.remove('open'); }
    function openRegisterModal() { document.getElementById('registerModal').classList.add('open'); }
    function closeRegisterModal() { document.getElementById('registerModal').classList.remove('open'); }
    function switchToRegister() { closeLoginModal(); setTimeout(openRegisterModal, 300); }
    function switchToLogin() { closeRegisterModal(); setTimeout(openLoginModal, 300); }
    // ▼ タグの色を決める関数（色を増やしました！）
    function getTagColor(tag) {
        switch(tag) {
            case 'INFO': return '#27C6F5';      // 水色
            case 'VIDEO': return '#ff4757';     // 赤
            case 'GOODS': return '#f1c40f';     // 黄色
            case 'VOICE': return '#2ecc71';     // 緑
            case 'MUSIC': return '#9b59b6';     // 紫
            case 'COLLAB': return '#e67e22';    // オレンジ
            case 'CAMPAIGN': return '#e84393';  // ピンク
            case 'BIRTHDAY': return '#fdcb6e';  // ゴールド
            case 'MEMBER': return '#34495e';    // 紺色
            default: return '#ccc';             // その他はグレー
        }
    }
    function toggleMenu() { document.getElementById('sideMenu').classList.toggle('open'); document.getElementById('overlay').classList.toggle('open'); }
    function initCardMaker() { const today = new Date(); const dStr = `${today.getFullYear()}.${(today.getMonth()+1).toString().padStart(2,'0')}.${today.getDate().toString().padStart(2,'0')}`; const cardDateEl = document.getElementById('cardDate'); if(cardDateEl) cardDateEl.innerText = 'DATE: ' + dStr; const cardNoEl = document.getElementById('cardNo'); if(cardNoEl) cardNoEl.innerText = dStr.replace(/\./g,'') + '-' + (Math.floor(Math.random()*9000)+1000); const btnContainer = document.getElementById('oshiButtons'); if(btnContainer) { btnContainer.innerHTML = ''; memberData.forEach((m, i) => { const btn = document.createElement('div'); btn.className = 'oshi-btn'; btn.style.backgroundImage = `url('${m.img}')`; btn.onclick = () => selectOshi(i); btnContainer.appendChild(btn); }); if(memberData.length > 0) selectOshi(0); } }
    function selectOshi(index) { const m = memberData[index]; document.querySelectorAll('.oshi-btn').forEach((b, i) => b.classList.toggle('selected', i === index)); const card = document.getElementById('digitalCard'); if(card) { card.style.setProperty('--card-color', m.color); const bottom = m.card_bottom || "-20px"; const right = m.card_right || "-50px"; const width = m.card_width || "280px"; card.style.setProperty('--char-bottom', bottom); card.style.setProperty('--char-right', right); card.style.setProperty('--char-width', width); document.getElementById('cardOshiDisplay').innerText = m.name; document.getElementById('cardCharImg').src = m.img; } }
    function updateCard() { const val = document.getElementById('cardNameInput').value; const display = document.getElementById('cardNameDisplay'); if(display) display.innerText = val ? val : 'GUEST'; }
    function downloadCard() { const card = document.getElementById('digitalCard'); html2canvas(card, { scale: 3, backgroundColor: null, useCORS: true }).then(canvas => { const link = document.createElement('a'); link.download = 'aoharu_card.png'; link.href = canvas.toDataURL('image/png'); link.click(); }); }
    function openGoodsModal(index) { const g = goodsData[index]; document.getElementById('goodsModalImg').src = g.img; document.getElementById('goodsModalTitle').innerText = g.name; document.getElementById('goodsModalPrice').innerText = g.price; document.getElementById('goodsModalDesc').innerText = g.detail || "詳細情報はありません。"; document.getElementById('goodsModalLink').href = g.link || "#"; document.getElementById('goodsModal').classList.add('open'); }
    function closeGoodsModal() { document.getElementById('goodsModal').classList.remove('open'); }
    function initOmikuji() { const container = document.querySelector('#top .container'); if(container && !document.querySelector('.omikuji-area')) { const omikujiArea = document.createElement('div'); omikujiArea.className = 'omikuji-area'; omikujiArea.innerHTML = ` <div class="omi-deco d-1">✨</div> <div class="omi-deco d-2">💖</div> <div class="omi-title-ribbon">毎日1回運試し！</div> <div class="omi-main-text">あおはるおみくじ</div> <div class="omi-visual-box"><i class="fas fa-box-open"></i></div> <br> <button class="omikuji-btn" onclick="drawOmikuji()">おみくじを引く！</button> <p style="font-size:11px; color:#888; margin-top:15px; font-weight:bold;">※推しメンが出るかも…！？</p> `; const noaSection = document.getElementById('nowOnAirSection'); noaSection.parentNode.insertBefore(omikujiArea, noaSection.nextSibling); } }
    function drawOmikuji() { if(memberData.length === 0) return; const member = memberData[Math.floor(Math.random() * memberData.length)]; const fortune = fortuneTypes[Math.floor(Math.random() * fortuneTypes.length)]; const item = luckyItems[Math.floor(Math.random() * luckyItems.length)]; const comment = fortuneComments[Math.floor(Math.random() * fortuneComments.length)]; currentOmikujiResult = { member, fortune, item, comment }; const animModal = document.getElementById('omikujiAnimModal'); const box = document.getElementById('omiBox'); const slip = document.getElementById('omiSlip'); const particlesContainer = document.getElementById('omiParticles'); particlesContainer.innerHTML = ''; animModal.classList.add('open'); box.classList.add('shaking'); setTimeout(() => { box.classList.remove('shaking'); box.classList.add('pre-burst'); setTimeout(() => { box.classList.remove('pre-burst'); slip.classList.add('coming-out'); animModal.classList.add('burst'); if(typeof spawnConfetti === 'function') spawnConfetti(particlesContainer); setTimeout(() => { animModal.classList.remove('open'); animModal.classList.remove('burst'); slip.classList.remove('coming-out'); showOmikujiResult(); }, 1500); }, 500); }, 2500); }
    function spawnConfetti(container) { const colors = ['#FF512F', '#DD2476', '#FFD700', '#27C6F5', '#ffffff']; const icons = ['fa-star', 'fa-heart', 'fa-music', 'fa-bolt']; for (let i = 0; i < 50; i++) { const el = document.createElement('i'); el.className = `fas ${icons[Math.floor(Math.random() * icons.length)]} confetti`; el.style.color = colors[Math.floor(Math.random() * colors.length)]; el.style.left = '50%'; el.style.top = '50%'; const angle = Math.random() * 360; const dist = 150 + Math.random() * 200; el.style.setProperty('--tx', `${Math.cos(angle * Math.PI / 180) * dist}px`); el.style.setProperty('--ty', `${Math.sin(angle * Math.PI / 180) * dist}px`); el.style.setProperty('--r', `${Math.random() * 720 - 360}deg`); container.appendChild(el); } const shockwave = document.createElement('div'); shockwave.className = 'shockwave'; container.appendChild(shockwave); }
    function showOmikujiResult() { if(!currentOmikujiResult) return; document.getElementById('omiResultImg').src = currentOmikujiResult.member.img; document.getElementById('omiResultRank').innerText = currentOmikujiResult.fortune; document.getElementById('omiResultMsg').innerText = `${currentOmikujiResult.member.name}「${currentOmikujiResult.comment}」`; document.getElementById('omiResultItem').innerText = currentOmikujiResult.item; document.getElementById('omikujiModal').classList.add('open'); }
    function closeOmikujiModal() { document.getElementById('omikujiModal').classList.remove('open'); }
    function shareOmikuji() { if(!currentOmikujiResult) return; const text = `【あおはるおみくじ】\n今日の運勢は…「${currentOmikujiResult.fortune}」でした！\nラッキーアイテム：${currentOmikujiResult.item}\n${currentOmikujiResult.member.name}「${currentOmikujiResult.comment}」\n#あおはるフレンズ #あおはるおみくじ`; const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(location.href)}`; window.open(url, '_blank'); }
    function saveOmikuji() { const target = document.getElementById('omiCaptureArea'); html2canvas(target, { scale: 3, backgroundColor: null, useCORS: true }).then(canvas => { const link = document.createElement('a'); link.download = 'aoharu_omikuji.png'; link.href = canvas.toDataURL('image/png'); link.click(); }); }

    // --- 会員・非同期処理 ---
    async function registerUser() { const name = document.getElementById('regName').value; const email = document.getElementById('regEmail').value; const pass = document.getElementById('regPass').value; const btn = document.getElementById('regBtn'); if(!name || !email || !pass) { alert("全ての項目を入力してください"); return; } if(pass.length < 4) { alert("パスワードは4文字以上で設定してください"); return; } btn.innerText = "送信中..."; btn.disabled = true; try { const res = await fetch(`${GAS_API_URL}?action=register&name=${encodeURIComponent(name)}&email=${encodeURIComponent(email)}&pass=${encodeURIComponent(pass)}`); const json = await res.json(); if (json.status === 'success') { alert("登録完了！\n会員ID: " + json.id); closeRegisterModal(); } else { alert("登録エラー: " + json.message); } } catch (e) { alert("通信エラー"); } finally { btn.innerText = "会員登録する"; btn.disabled = false; } }
    async function loginUser() { const email = document.getElementById('loginEmail').value; const pass = document.getElementById('loginPass').value; const btn = document.getElementById('loginBtn'); if(!email || !pass) { alert("入力してください"); return; } btn.innerText = "確認中..."; btn.disabled = true; try { const res = await fetch(`${GAS_API_URL}?action=login&email=${encodeURIComponent(email)}&pass=${encodeURIComponent(pass)}`); const json = await res.json(); if (json.status === 'success') { alert("ログイン成功！"); closeLoginModal(); currentUserData = { id: json.id, name: json.name, icon: json.icon, bio: json.bio, x: json.x, yt: json.yt }; localStorage.setItem('aoharu_user', JSON.stringify(currentUserData)); isMemberLoggedIn = true; location.reload(); } else { alert("失敗: " + json.message); } } catch (e) { alert("通信エラー"); } finally { btn.innerText = "ログインする"; btn.disabled = false; } }
    async function saveProfile() { if (!currentUserData) return; const name = document.getElementById('myNameInput').value; const icon = document.getElementById('myIconInput').value; const bio = document.getElementById('myBioInput').value; const x = document.getElementById('myXInput').value; const yt = document.getElementById('myYtInput').value; const btn = document.querySelector('.save-btn'); btn.innerText = "保存中..."; btn.disabled = true; try { const url = `${GAS_API_URL}?action=update_profile` + `&id=${encodeURIComponent(currentUserData.id)}` + `&name=${encodeURIComponent(name)}` + `&icon=${encodeURIComponent(icon)}` + `&bio=${encodeURIComponent(bio)}` + `&x=${encodeURIComponent(x)}` + `&yt=${encodeURIComponent(yt)}`; const res = await fetch(url); const json = await res.json(); if (json.status === 'success') { alert("更新しました！"); currentUserData.name = name; currentUserData.icon = icon; currentUserData.bio = bio; currentUserData.x = x; currentUserData.yt = yt; localStorage.setItem('aoharu_user', JSON.stringify(currentUserData)); location.reload(); } else { alert("エラー: " + json.message); } } catch (e) { alert("通信エラー"); } finally { btn.innerText = "変更を保存する"; btn.disabled = false; } }
    function logoutUser() { if(confirm("ログアウトしますか？")) { localStorage.removeItem('aoharu_user'); location.reload(); } }
    async function openUserProfile(name, event) { if(event) event.stopPropagation(); document.getElementById('graffitiModal').classList.remove('open'); document.getElementById('userProfileModal').classList.remove('open'); const officialMember = memberData.find(m => m.name === name); if (officialMember) { const index = memberData.indexOf(officialMember); openMemberDetail(index); return; } document.getElementById('upName').innerText = "Loading..."; document.getElementById('upBio').innerText = "..."; document.getElementById('upIcon').src = "icon.png"; document.getElementById('upBadge').style.display = "none"; document.getElementById('upLinkX').style.display = "none"; document.getElementById('upLinkYt').style.display = "none"; document.getElementById('userProfileModal').classList.add('open'); try { const res = await fetch(`${GAS_API_URL}?action=get_user_profile&name=${encodeURIComponent(name)}`); const json = await res.json(); if (json.status === 'success') { document.getElementById('upName').innerText = json.name; document.getElementById('upIcon').src = json.icon || "icon.png"; document.getElementById('upBio').innerText = json.bio || ""; if (json.x) { document.getElementById('upLinkX').href = json.x; document.getElementById('upLinkX').style.display = "flex"; } if (json.yt) { document.getElementById('upLinkYt').href = json.yt; document.getElementById('upLinkYt').style.display = "flex"; } } } catch (e) { console.log(e); } }
    // ▼▼▼ メンバー詳細を表示する関数（Twitch追加版） ▼▼▼
    function openMemberDetail(index, pushHistory = true) { 
        const m = memberData[index]; 
        if(!m) return; 
        const detailPage = document.getElementById('memberDetail'); 
        
        // SNSボタンの生成
        let snsBtns = ''; 
        // YouTube
        if(m.youtubeId) snsBtns += `<a href="${m.youtubeId.startsWith('http')?m.youtubeId:'https://youtube.com/'+m.youtubeId}" target="_blank" class="p-btn yt"><i class="fab fa-youtube"></i> Channel</a>`; 
        
        // ★★★ 追加：Twitchボタン（ここを追加しました！） ★★★
        if(m.twitchId) snsBtns += `<a href="${m.twitchId.startsWith('http')?m.twitchId:'https://twitch.tv/'+m.twitchId}" target="_blank" class="p-btn tw"><i class="fab fa-twitch"></i> Twitch</a>`; 
        
        // X (Twitter)
        if(m.twitterId) snsBtns += `<a href="${m.twitterId.startsWith('http')?m.twitterId:'https://twitter.com/'+m.twitterId}" target="_blank" class="p-btn x"><i class="fab fa-x-twitter"></i> X</a>`; 
        
        // ボイスリストの生成
        let voiceHtml = ''; 
        const voices = [ {url: m.voice1, title: m.title1}, {url: m.voice2, title: m.title2}, {url: m.voice3, title: m.title3} ]; 
        let voiceItems = ''; 
        voices.forEach((v, i) => { if(v.url) voiceItems += `<div class="voice-card" onclick="playVoice(this, '${v.url}')"><i class="fas fa-play voice-icon"></i><div class="voice-title">${v.title||'Voice'}</div></div>`; }); 
        if(voiceItems) voiceHtml = `<div class="section-title"><span class="ja-title">VOICE</span></div><div class="voice-grid">${voiceItems}</div>`; 
        
        // 詳細データリスト
        const dataListHtml = `
            <div class="profile-data-list">
                <div class="p-data-item">
                    <span class="p-label">BIRTHDAY</span>
                    <span class="p-value">${m.birthday || '???'}</span>
                </div>
                <div class="p-data-item">
                    <span class="p-label">HEIGHT</span>
                    <span class="p-value">${m.height || '???'}</span>
                </div>
                <div class="p-data-item">
                    <span class="p-label">FAN NAME</span>
                    <span class="p-value">${m.fanName || '-'}</span>
                </div>
                <div class="p-data-item">
                    <span class="p-label">HASHTAG</span>
                    <span class="p-value">${m.hashTag || '#'}</span>
                </div>
            </div>
        `;

        // HTMLの組み立て
        const html = `
        <div class="profile-header-bg" style="background-image:linear-gradient(135deg, ${m.color}cc 0%, rgba(255,255,255,0.9) 100%), url('${m.img}'); background-size:cover;">
            <div class="profile-wrapper">
                <div class="profile-visual">
                    <img src="${m.img}" class="profile-tachie">
                </div>
                <div class="profile-info">
                    <div class="profile-en-name" style="color:${m.color}">${m.enName}</div>
                    <div class="profile-jp-name">${m.name}</div>
                    <div class="profile-catch" style="border-color:${m.color}">${m.catchphrase||''}</div>
                    
                    ${dataListHtml}
                    
                    <div class="profile-bio">${m.bio||''}</div>
                    <div class="profile-actions">${snsBtns}</div>
                    ${voiceHtml}
                    <div style="text-align:center;"><div class="back-link" onclick="showPage('member')">◀ 戻る</div></div>
                </div>
            </div>
        </div>`; 
        
        detailPage.innerHTML = html; 
        showPage('memberDetail', m.name, false); 
        if (pushHistory) history.pushState(null, null, '#member_' + index); 
        updateBreadcrumbs('memberDetail', m.name); 
    }
    function closeUserProfileModal() { document.getElementById('userProfileModal').classList.remove('open'); }
    function openForgotModal() { closeLoginModal(); document.getElementById('forgotModal').classList.add('open'); }
    function closeForgotModal() { document.getElementById('forgotModal').classList.remove('open'); }
    async function sendForgotRequest() { alert("管理者に問い合わせてください"); }

    // ▼▼▼ 落書き機能 (修正版：変数名衝突回避) ▼▼▼
    let graffitiCanvas, ctx, isDrawing = false, currentColor = "#ffffff", currentLineWidth = 3, graffitiPosts = [], currentViewingIndex = -1;
    function initCanvas() { const container = document.querySelector('.board-container'); graffitiCanvas = document.getElementById('drawCanvas'); if(!container || !graffitiCanvas) return; const rect = container.getBoundingClientRect(); graffitiCanvas.width = rect.width; graffitiCanvas.height = rect.height; ctx = graffitiCanvas.getContext('2d'); ctx.lineCap = 'round'; ctx.lineJoin = 'round'; ctx.strokeStyle = currentColor; ctx.lineWidth = currentLineWidth; graffitiCanvas.onmousedown = startDraw; graffitiCanvas.onmousemove = drawing; graffitiCanvas.onmouseup = endDraw; graffitiCanvas.onmouseout = endDraw; graffitiCanvas.ontouchstart = (e) => { e.preventDefault(); startDraw(e.touches[0]); }; graffitiCanvas.ontouchmove = (e) => { e.preventDefault(); drawing(e.touches[0]); }; graffitiCanvas.ontouchend = endDraw; }
    function startDraw(e) { isDrawing = true; ctx.beginPath(); const rect = graffitiCanvas.getBoundingClientRect(); ctx.moveTo((e.clientX||e.pageX)-rect.left, (e.clientY||e.pageY)-rect.top); }
    function drawing(e) { if (!isDrawing) return; const rect = graffitiCanvas.getBoundingClientRect(); ctx.lineTo((e.clientX||e.pageX)-rect.left, (e.clientY||e.pageY)-rect.top); ctx.stroke(); }
    function endDraw() { isDrawing = false; }
    function changeColor(btn, color) { currentColor = color; ctx.strokeStyle = color; ctx.lineWidth = 3; ctx.globalCompositeOperation = 'source-over'; document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }
    function setEraser() { ctx.lineWidth = 15; ctx.globalCompositeOperation = 'destination-out'; document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active')); }
    function clearCanvas() { if(confirm('消しますか？')) { ctx.clearRect(0, 0, graffitiCanvas.width, graffitiCanvas.height); } }
    function downloadGraffiti() { const temp = document.createElement('canvas'); temp.width = graffitiCanvas.width; temp.height = graffitiCanvas.height; const t = temp.getContext('2d'); t.fillStyle = "#2b4a3c"; t.fillRect(0,0,temp.width,temp.height); t.drawImage(graffitiCanvas,0,0); const link = document.createElement('a'); link.download = 'graffiti.png'; link.href = temp.toDataURL(); link.click(); }
    function checkCanvasLock() { const overlay = document.getElementById('canvasLockOverlay'); if (overlay) overlay.style.display = isMemberLoggedIn ? 'none' : 'flex'; }
    async function deleteGraffiti(event, id) { event.stopPropagation(); if (!isOfficialAdmin) return; if (!confirm("削除しますか？")) return; await fetch(GAS_API_URL, { method: 'POST', body: JSON.stringify({ type: 'delete', id: id }) }); location.reload(); }
    function renderGraffitiList() { const list = document.getElementById('graffitiList'); if (!isMemberLoggedIn) { list.innerHTML = "ログインしてください"; return; } list.innerHTML = graffitiPosts.map((p,i)=>`<div class="graffiti-card" onclick="openGraffitiDetail(${i})"><img src="${p.image}" class="g-img"><div class="g-title">${p.title}</div></div>`).join(''); }
    function openGraffitiDetail(i) { currentViewingIndex = i; document.getElementById('gDetailImg').src = graffitiPosts[i].image; document.getElementById('graffitiModal').classList.add('open'); }
    function closeGraffitiModal() { document.getElementById('graffitiModal').classList.remove('open'); }
    async function toggleGraffitiLike() { /* 簡略化 */ }
    async function submitGraffitiComment() { /* 簡略化 */ }

    // ▼▼▼ AOHARU STUDIO (統合版) ▼▼▼
    let studioViewers = [];
    let selectedActorIndex = -1; 
    function initStudio() {
        if(studioViewers.length > 0) return;
        const canvasIds = ['skin_member_1', 'skin_member_2', 'skin_user', 'skin_member_3', 'skin_member_4'];
        const defaultSkins = ["skin_iyo.png", "skin_taku.png", "skin_ao.png", "skin_yua.png", "skin_ao.png"];
        canvasIds.forEach((id, index) => {
            const canvas = document.getElementById(id);
            if(!canvas) return;
            const container = canvas.parentElement;
            makeDraggable(container);
            const rect = container.getBoundingClientRect();
            const viewer = new skinview3d.SkinViewer({
                canvas: canvas, width: rect.width, height: rect.height, skin: defaultSkins[index], preserveDrawingBuffer: true
            });
            viewer.fov = 50; viewer.zoom = 0.65; viewer.autoRotate = false; viewer.animation = new skinview3d.WalkingAnimation();
            studioViewers.push(viewer);
        });
    }
    function selectActor(index) { selectedActorIndex = index; const boxes = document.querySelectorAll('.actor-box'); boxes.forEach((b,i)=>b.classList.toggle('selected', i===index)); }
    function setStudioAnim(type) { studioViewers.forEach((v,i)=>{ if(selectedActorIndex===-1||selectedActorIndex===i) { if(type==='idle') v.animation = new skinview3d.IdleAnimation(); else if(type==='walk') v.animation = new skinview3d.WalkingAnimation(); else if(type==='run') v.animation = new skinview3d.RunningAnimation(); else if(type==='fly') v.animation = new skinview3d.FlyingAnimation(); v.playerObject.skin.head.rotation.z = 0; } }); }
    // 新しいポーズ関数
    function setPose(poseName) {
        studioViewers.forEach((v, i) => {
            if (selectedActorIndex === -1 || selectedActorIndex === i) {
                v.animation = null;
                resetPose(v);
                const skin = v.playerObject.skin;
                if (poseName === 'hug') { skin.rightArm.rotation.x = -1.5; skin.rightArm.rotation.z = 0.5; skin.leftArm.rotation.x = -1.5; skin.leftArm.rotation.z = -0.5; }
                else if (poseName === 'cheer') { skin.rightArm.rotation.z = 2.8; skin.leftArm.rotation.z = -2.8; }
                else if (poseName === 'point') { skin.rightArm.rotation.x = -1.5; skin.rightArm.rotation.y = -0.5; }
                else if (poseName === 'sit') { skin.rightLeg.rotation.x = -1.5; skin.leftLeg.rotation.x = -1.5; }
                else if (poseName === 'ninja') { skin.body.rotation.x = 0.5; skin.rightArm.rotation.x = 1.0; skin.leftArm.rotation.x = 1.0; }
                else if (poseName === 'zombie') { skin.rightArm.rotation.x = -1.5; skin.leftArm.rotation.x = -1.5; }
            }
        });
    }
    function resetPose(viewer) {
        const skin = viewer.playerObject.skin;
        skin.head.rotation.set(0,0,0); skin.leftArm.rotation.set(0,0,0); skin.rightArm.rotation.set(0,0,0);
        skin.leftLeg.rotation.set(0,0,0); skin.rightLeg.rotation.set(0,0,0); skin.body.rotation.set(0,0,0);
    }
    function toggleHeadTilt() { studioViewers.forEach((v,i)=>{ if(selectedActorIndex===-1||selectedActorIndex===i) v.playerObject.skin.head.rotation.z = (v.playerObject.skin.head.rotation.z===0 ? -0.5 : 0); }); }
    function toggleRotate() { studioViewers.forEach((v,i)=>{ if(selectedActorIndex===-1||selectedActorIndex===i) v.autoRotate = !v.autoRotate; }); }
    function changeStudioBg(val) { const bg=document.getElementById('studioBg'); if(val.includes('url')) { bg.style.backgroundImage=val; bg.style.backgroundColor='transparent'; } else { bg.style.backgroundImage='none'; bg.style.backgroundColor=val; } }
    function uploadUserSkin(input) { if(input.files[0]) { const r = new FileReader(); r.onload = (e) => studioViewers[2].loadSkin(e.target.result); r.readAsDataURL(input.files[0]); } }
    function changeActorSkin(skin) { if(studioViewers.length===0) return; if(selectedActorIndex===-1) { if(confirm("全員変えますか？")) studioViewers.forEach(v=>v.loadSkin(skin)); } else { studioViewers[selectedActorIndex].loadSkin(skin); } }
    function captureStudio() { html2canvas(document.getElementById('studioStage'), {scale:2, useCORS:true}).then(c=>{ const l=document.createElement('a'); l.download='studio.png'; l.href=c.toDataURL(); l.click(); }); }
    
    function addFreeMob(skin) { 
        const stage = document.getElementById('studioStage'); const box = document.createElement('div'); box.className = 'free-mob-box'; 
        box.style.top = '30%'; box.style.left = '40%';
        const cvs = document.createElement('canvas'); box.appendChild(cvs); 
        const handle = document.createElement('div'); handle.className = 'move-handle'; handle.innerHTML = '<i class="fas fa-arrows-alt"></i>'; box.appendChild(handle);
        const del = document.createElement('div'); del.className = 'mob-delete-btn'; del.innerText='×'; del.onclick=()=>box.remove(); box.appendChild(del);
        stage.appendChild(box);
        const v = new skinview3d.SkinViewer({ canvas: cvs, width: 100, height: 200, skin: skin, preserveDrawingBuffer: true });
        v.controls.enableRotate = true; v.controls.enableZoom = false;
        v.fov = 60; v.zoom = 0.9; v.animation = new skinview3d.WalkingAnimation(); v.autoRotate = true;
        makeDraggable(box, handle);
    }
    
    function makeDraggable(element, handle) {
        let isDragging=false, startX, startY, initLeft, initTop;
        const target = handle || element;
        target.addEventListener('mousedown', start); target.addEventListener('touchstart', start, {passive:false});
        function start(e) { e.preventDefault(); e.stopPropagation(); isDragging=true; const t = e.type==='touchstart'?e.touches[0]:e; startX=t.clientX; startY=t.clientY; initLeft=element.offsetLeft; initTop=element.offsetTop; element.style.bottom='auto'; element.style.right='auto'; element.style.left=initLeft+'px'; element.style.top=initTop+'px'; document.addEventListener('mousemove', move); document.addEventListener('touchmove', move, {passive:false}); document.addEventListener('mouseup', stop); document.addEventListener('touchend', stop); }
        function move(e) { if(!isDragging) return; e.preventDefault(); const t = e.type==='touchmove'?e.touches[0]:e; const dx=t.clientX-startX; const dy=t.clientY-startY; element.style.left=(initLeft+dx)+'px'; element.style.top=(initTop+dy)+'px'; }
        function stop() { isDragging=false; document.removeEventListener('mousemove', move); document.removeEventListener('touchmove', move); document.removeEventListener('mouseup', stop); document.removeEventListener('touchend', stop); }
    }

    // 1. SKIN VIEWER 制御（既存の1人用）
    let skinViewer;
    let skinAnimation;

    function initSkinViewer() {
        if(skinViewer) return; 
        const canvas = document.getElementById("skin_container");
        if(!canvas) return;

        skinViewer = new skinview3d.SkinViewer({
            canvas: canvas, width: 300, height: 400,
            skin: "skin_ao.png"
        });
        skinViewer.width = canvas.parentElement.clientWidth;
        skinViewer.height = canvas.parentElement.clientHeight;
        skinViewer.fov = 70; skinViewer.zoom = 0.9;
        skinViewer.autoRotate = true; skinViewer.autoRotateSpeed = 0.5;
        
        setSkinAnim('walk', document.querySelectorAll('.skin-btn')[1]);
        renderSkinButtons();
    }

    // ホラーモード
    function initEasterEgg() { window.addEventListener('keydown', (e) => { secretInput.push(e.key); if (secretInput.length > secretCode.length) secretInput.shift(); if (JSON.stringify(secretInput) === JSON.stringify(secretCode)) activateFeverMode(); }); const logo = document.getElementById('headerLogo'); if(logo) { logo.addEventListener('click', (e) => { e.preventDefault(); logoTapCount++; if(logoTapCount === 10) { activateFeverMode(); logoTapCount = 0; } setTimeout(() => logoTapCount = 0, 3000); }); } }
    function triggerSecretEvent() { secretTapCount++; if(secretTapCount === 5 || secretTapCount === 6) { const noise = document.getElementById('tvNoiseOverlay'); noise.classList.add('active'); setTimeout(() => { noise.classList.remove('active'); }, 200); } clearTimeout(secretTapTimer); secretTapTimer = setTimeout(() => { secretTapCount = 0; }, 2000); if (secretTapCount >= 7) { secretTapCount = 0; startHorrorMode(); } }
    function startHorrorMode() { if(!confirm("校舎の電気が消えました...\n様子を見に行きますか？")) return; document.querySelector('footer').style.display = 'none'; showPage('secretOldSchool', null, false); window.scrollTo(0,0); document.getElementById('secretGate').classList.remove('open'); document.getElementById('oldSchoolRoom').style.opacity = '0'; const flashlight = document.getElementById('flashlightOverlay'); flashlight.style.display = 'block'; setTimeout(() => { flashlight.classList.add('active'); }, 100); document.addEventListener('mousemove', moveFlashlight); document.addEventListener('touchmove', moveFlashlight, {passive: false}); }
    function openSecretGate() { if(!confirm("本当に...入りますか？\n（後戻りはできません）")) return; document.getElementById('secretGate').classList.add('open'); const flashlight = document.getElementById('flashlightOverlay'); flashlight.style.opacity = '0'; setTimeout(() => { flashlight.style.display = 'none'; flashlight.classList.remove('active'); }, 2000); setTimeout(() => { document.getElementById('oldSchoolRoom').style.opacity = '1'; if(secretData.bgm_url) { horrorAudio.bgm = new Audio(secretData.bgm_url); horrorAudio.bgm.volume = 0.1; horrorAudio.bgm.loop = true; horrorAudio.bgm.play().catch(e => console.log("BGM再生失敗")); } }, 1000); document.removeEventListener('mousemove', moveFlashlight); document.removeEventListener('touchmove', moveFlashlight); }
    function moveFlashlight(e) { const flashlight = document.getElementById('flashlightOverlay'); if (!flashlight.classList.contains('active')) return; let x, y; if (e.type === 'touchmove') { x = e.touches[0].clientX; y = e.touches[0].clientY; } else { x = e.clientX; y = e.clientY; } flashlight.style.setProperty('--cursor-x', x + 'px'); flashlight.style.setProperty('--cursor-y', y + 'px'); }
    function exitHorrorMode() { if(horrorAudio.bgm) horrorAudio.bgm.pause(); if(horrorAudio.radio) horrorAudio.radio.pause(); if(horrorAudio.scream) horrorAudio.scream.pause(); const flashlight = document.getElementById('flashlightOverlay'); flashlight.classList.remove('active'); flashlight.style.opacity = '0'; document.removeEventListener('mousemove', moveFlashlight); document.removeEventListener('touchmove', moveFlashlight); setTimeout(() => { flashlight.style.display = 'none'; showPage('top'); alert("...夢だったようだ。"); location.reload(); }, 2000); }
    function setSecretData(data) { if(data.secret) { secretData = data.secret; document.getElementById('noteContent').innerHTML = secretData.note_text || "文字が滲んで読めない..."; document.getElementById('bloodTextDisplay').innerText = secretData.blood_text || "見てるぞ..."; if(secretData.scream_img_url) document.getElementById('screamImg').src = secretData.scream_img_url; } }
    function openHorrorNote() { document.getElementById('noteModal').style.display = 'flex'; }
    function playHorrorRadio() { const btn = document.querySelector('.horror-item.radio'); if (horrorAudio.radio && !horrorAudio.radio.paused) { horrorAudio.radio.pause(); horrorAudio.radio.currentTime = 0; btn.classList.remove('playing'); } else { if(!secretData.radio_voice_url) { alert("...ザーッ...（電池切れのようだ）"); return; } horrorAudio.radio = new Audio(secretData.radio_voice_url); horrorAudio.radio.volume = 0.3; horrorAudio.radio.loop = true; horrorAudio.radio.play(); btn.classList.add('playing'); } }
    function triggerScream() { if(secretData.scream_voice_url) { horrorAudio.scream = new Audio(secretData.scream_voice_url); horrorAudio.scream.volume = 0.4; horrorAudio.scream.play(); } const overlay = document.getElementById('screamOverlay'); overlay.style.display = 'block'; setTimeout(() => { overlay.style.display = 'none'; }, 1500); }
    const inputField = document.getElementById('cursedInput'); if(inputField) { inputField.addEventListener('keypress', function (e) { if (e.key === 'Enter') { const text = this.value; this.value = ''; handleCursedWord(text); } }); }
    function handleCursedWord(word) { if (word.includes('あそぼ') || word.includes('遊ぼ')) { alert("...ケケケ...（どこからか笑い声が聞こえた）"); } else if (word.includes('うしろ') || word.includes('後ろ')) { const noise = document.getElementById('tvNoiseOverlay'); if(noise) { noise.classList.add('active'); setTimeout(() => noise.classList.remove('active'), 1000); } const label = document.querySelector('.cursed-label'); if(label) { label.innerText = "フリカエルナ！！"; label.style.color = "red"; } } else if (word.includes('助けて') || word.includes('たすけて')) { document.body.classList.add('red-flash'); setTimeout(() => document.body.classList.remove('red-flash'), 600); const input = document.getElementById('cursedInput'); setTimeout(() => { if(input) { input.value = "ムダダ"; input.style.color = "black"; } }, 500); } else if (word.includes('ごめんなさい') || word.includes('ゆるして')) { const input = document.getElementById('cursedInput'); if(input) { input.style.color = "#880000"; input.value = "ユルサナイユルサナイユルサナイ"; input.classList.add('shaking'); setTimeout(() => input.classList.remove('shaking'), 1000); } } else if (word.includes('みてる') || word.includes('見てる')) { for(let i=0; i<30; i++) { const eye = document.createElement('div'); eye.innerText = "👁️"; eye.style.position = "fixed"; eye.style.left = Math.random() * 100 + "vw"; eye.style.top = Math.random() * 100 + "vh"; eye.style.fontSize = (Math.random() * 50 + 20) + "px"; eye.style.zIndex = "30000"; eye.style.pointerEvents = "none"; document.body.appendChild(eye); setTimeout(() => eye.remove(), 1500); } alert("...キズイタカ..."); } else if (word.includes('おかしい') || word.includes('バグ')) { document.body.style.transition = "transform 2s"; document.body.style.transform = "rotate(3deg)"; alert("...オカシイノハ オマエダ..."); } else if (word.includes('あおはる') || word.includes('アオハル') || word.includes('フレンズ')) { const input = document.getElementById('cursedInput'); if(input) { input.value = ""; setTimeout(() => { input.value = "ソンナ ヤツハ イナイ"; input.style.color = "#555"; }, 300); } } }
    function activateFeverMode() { if(document.body.classList.contains('fever-mode')) return; document.body.classList.add('fever-mode'); const text = document.createElement('div'); text.className = 'fever-text'; text.innerText = "FEVER TIME!!"; document.body.appendChild(text); var duration = 5000; var end = Date.now() + duration; (function frame() { if(typeof confetti === 'function'){ confetti({ particleCount: 2, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#ff0000', '#00ff00', '#0000ff'] }); confetti({ particleCount: 2, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#ff0000', '#00ff00', '#0000ff'] }); } if (Date.now() < end) requestAnimationFrame(frame); else { document.body.classList.remove('fever-mode'); text.remove(); alert("祭りは終わった……"); } }()); }
    // ▼▼▼ キャラクター変身機能 ▼▼▼
    function changeActorSkin(skinFileName) {
        if (studioViewers.length === 0) return;

        // 「全員」が選択されている場合
        if (selectedActorIndex === -1) {
            if (!confirm("全員の姿を変更しますか？\n（元のスキンに戻すにはリロードが必要です）")) return;
            studioViewers.forEach(viewer => {
                viewer.loadSkin(skinFileName);
            });
        }
        // 特定のキャラが選択されている場合
        else {
            const viewer = studioViewers[selectedActorIndex];
            if (viewer) {
                viewer.loadSkin(skinFileName);
            }
        }
    }
// ▼ 閉じるボタンを押したときの処理
    function resetPickupNews() {
        // 画像を元の「PICK UP NEWS」に戻す
        document.getElementById('pickupImg').src = "https://placehold.co/800x450/27C6F5/ffffff?text=PICK+UP+NEWS";
        
        // タイトルとバッジを消す
        document.getElementById('pickupTitle').innerText = "";
        document.getElementById('pickupBadge').style.display = "none";
        
        // 詳細テキストを案内に戻す
        document.getElementById('pickupDetail').innerHTML = '<div style="text-align:center; color:#888;">▼ 下のリストからニュースをクリックすると、ここに詳細が表示されます ▼</div>';
        
        // 閉じるボタン自体を隠す
        document.getElementById('pickupCloseBtn').style.display = "none";
    }
// ▼ スケジュール詳細を開く関数（アイコン対応版）
    function openScheduleModal(index) {
        const s = scheduleData[index];
        if(!s) return;

        // 日付と時間をセット
        document.getElementById('schModalDate').innerText = s.date + ' ' + s.time;
        // タイトルをセット
        document.getElementById('schModalTitle').innerText = s.content;

        // 画像があれば表示、なければ隠す
        const img = document.getElementById('schModalImg');
        if (s.img && s.img !== "") {
            img.src = s.img;
            img.style.display = "block";
        } else {
            img.style.display = "none";
        }

        // ★追加：詳細画面にもアイコンを表示するための処理
        // (詳細画面にアイコン用のエリアがない場合は、タイトルの上に追加します)
        let iconsHtml = '';
        if (s.platform) {
            s.platform.split(',').forEach(pf => {
                pf = pf.trim();
                if(pf) iconsHtml += `<img src="icon_pf_${pf}.png" style="width:24px; height:24px; object-fit:contain; margin-right:5px;">`;
            });
        }
        if (s.member) {
            s.member.split(',').forEach(mem => {
                mem = mem.trim();
                if(mem) iconsHtml += `<img src="icon_sch_${mem}.png" style="width:30px; height:30px; border-radius:50%; object-fit:cover; margin-left:5px; border:1px solid #ccc;">`;
            });
        }

        // アイコンを表示する場所を作る（なければ作る）
        let iconContainer = document.getElementById('schModalIcons');
        if (!iconContainer) {
            iconContainer = document.createElement('div');
            iconContainer.id = 'schModalIcons';
            iconContainer.style.marginTop = '10px';
            iconContainer.style.display = 'flex';
            iconContainer.style.alignItems = 'center';
            // タイトルの手前に挿入
            const titleEl = document.getElementById('schModalTitle');
            titleEl.parentNode.insertBefore(iconContainer, titleEl);
        }
        iconContainer.innerHTML = iconsHtml;

        document.getElementById('scheduleModal').classList.add('open');
    }
    // ▼ スケジュール詳細を閉じる関数（これを追加！）
    function closeScheduleModal() {
        document.getElementById('scheduleModal').classList.remove('open');
    }
    // ▼▼▼ 追加：背景に幾何学模様を飛ばす関数 ▼▼▼
    function initBackgroundShapes() {
        const container = document.getElementById('bgShapes');
        if(!container) return;
        const colors = ['#27C6F5', '#ff4757', '#f1c40f', '#2ecc71', '#9b59b6']; // あおはるカラー
        const shapes = ['circle', 'triangle', 'square'];

        for (let i = 0; i < 15; i++) { // 図形の数
            const shape = document.createElement('div');
            shape.className = 'bg-shape';
            const size = Math.random() * 50 + 20; // 20~70px
            const type = shapes[Math.floor(Math.random() * shapes.length)];
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            shape.style.width = size + 'px';
            shape.style.height = size + 'px';
            shape.style.left = Math.random() * 100 + 'vw'; // 横位置ランダム
            
            // アニメーション時間をランダムに
            shape.style.animationDuration = (Math.random() * 15 + 15) + 's'; // 15~30秒
            shape.style.animationDelay = (Math.random() * 5) + 's';

            if (type === 'circle') {
                shape.style.borderRadius = '50%';
                shape.style.background = color;
            } else if (type === 'square') {
                shape.style.background = color;
                shape.style.transform = `rotate(${Math.random() * 360}deg)`;
            } else {
                // 三角形
                shape.style.width = '0'; shape.style.height = '0';
                shape.style.borderLeft = (size/2) + 'px solid transparent';
                shape.style.borderRight = (size/2) + 'px solid transparent';
                shape.style.borderBottom = size + 'px solid ' + color;
                shape.style.background = 'transparent';
                shape.style.transform = `rotate(${Math.random() * 360}deg)`;
            }
            container.appendChild(shape);
        }
    }
    // ▼▼▼ 追加：カラーチェンジ機能（ファイル名修正版） ▼▼▼
    function renderThemeButtons() {
        const container = document.getElementById('themeColorButtons');
        if(!container) return;
        
        let html = '';
        
        // 1. あおはる☆フレンズモード（デフォルト水色 #27C6F5）
        html += `<div class="theme-btn" style="background-image:url('icon.png');" onclick="changeTheme('#27C6F5')" title="あおはる☆フレンズ"></div>`;
        
        // 2. メンバー4人のモード
        if(memberData && memberData.length > 0) {
            memberData.forEach(m => {
                // ★修正：ファイル名を正しく生成するロジック
                let fileName = 'default';
                if (m.enName) {
                    let name = m.enName.toLowerCase(); // まず小文字にする
                    
                    // スペースがある場合（例: "Togami Yua"）→ 後ろの "yua" を使う
                    if (name.includes(' ')) {
                        name = name.split(' ').pop();
                    }
                    // ハイフンがある場合（例: "Taku-niichan"）→ 前の "taku" を使う
                    if (name.includes('-')) {
                        name = name.split('-')[0];
                    }
                    
                    fileName = name;
                }
                
                // 生成したファイル名（taku, yua, iyo, ao）を使用
                html += `<div class="theme-btn" style="background-image:url('icon_sch_${fileName}.png');" onclick="changeTheme('${m.color}')" title="${m.name}"></div>`;
            });
        }
        
        container.innerHTML = html;
    }

    function changeTheme(color) {
        // サイト全体のテーマカラー変数を書き換え
        document.documentElement.style.setProperty('--primary', color);
    }
    // ▼▼▼ 追加機能：ダークモード＆マウスストーカー ▼▼▼

    // 1. ダークモード切り替え機能
    function toggleDarkMode() {
        const body = document.body;
        const icon = document.getElementById('themeIcon');
        
        // クラスを付け外し（トグル）
        body.classList.toggle('dark-mode');
        
        // アイコンを太陽(sun)と月(moon)で切り替え
        if (body.classList.contains('dark-mode')) {
            icon.className = 'fas fa-moon';
        } else {
            icon.className = 'fas fa-sun';
        }
    }

    // 2. マウスストーカー（キラキラ演出）
    let isMouseMoving = false;
    
    document.addEventListener('mousemove', function(e) {
        // 処理を軽くするため、毎回生成せず間引く（フラグ管理などは簡易的に省略し、動きに合わせて生成）
        createParticle(e.clientX, e.clientY);
    });

    // タッチデバイス（スマホ）でも少しキラキラさせる
    document.addEventListener('touchmove', function(e) {
        const touch = e.touches[0];
        createParticle(touch.clientX, touch.clientY);
    }, {passive: true});

    function createParticle(x, y) {
        // パーティクル要素を作成
        const p = document.createElement('div');
        
        // 50%の確率で「星」か「光の点」にする
        if (Math.random() > 0.5) {
            p.className = 'mouse-particle star';
            // 色をランダムに（パステルカラー）
            const colors = ['#ff9a9e', '#feca57', '#48dbfb', '#ff9ff3', '#1dd1a1'];
            p.style.color = colors[Math.floor(Math.random() * colors.length)];
        } else {
            p.className = 'mouse-particle';
        }

        // 位置を設定
        p.style.left = x + 'px';
        p.style.top = y + 'px';
        
        // 少しランダムに位置をずらす（自然に見せるため）
        const randomX = (Math.random() - 0.5) * 20;
        const randomY = (Math.random() - 0.5) * 20;
        p.style.transform = `translate(calc(-50% + ${randomX}px), calc(-50% + ${randomY}px))`;

        document.body.appendChild(p);

        // 1秒後に要素を削除（ゴミが溜まらないように）
        setTimeout(() => {
            p.remove();
        }, 1000);
    }
</script>
</body>
</html>